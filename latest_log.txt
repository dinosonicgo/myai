### AI Lover Log - Last updated at 2025-09-23T23:28:26.902801 ###

2025-09-23 22:55:04 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 22:55:04 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 22:55:04 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 22:55:04 - [INFO] - Discord Bot is ready!
2025-09-23 22:55:07 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 22:55:07 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 22:55:08 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 22:55:40 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 22:55:40 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 22:55:40 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 22:55:40 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行一次性全量創始構建...
2025-09-23 22:55:40 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 2 條文檔用於創始構建。
2025-09-23 22:55:40 - [ERROR] - [512280345618546699] 配置前置資源時發生致命錯誤: name 'pickle' is not defined
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 247, in _save_bm25_corpus
    pickle.dump(self.bm25_corpus, f)
NameError: name 'pickle' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1508, in initialize
    await self._configure_pre_requisites()
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2308, in _configure_pre_requisites
    self.retriever = await self._load_or_build_rag_retriever()
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 340, in _load_or_build_rag_retriever
    self._save_bm25_corpus() # 將首次構建的結果持久化
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 248, in _save_bm25_corpus
    except (IOError, pickle.PicklingError) as e:
NameError: name 'pickle' is not defined
2025-09-23 22:55:40 - [WARNING] - 為使用者 512280345618546699 初始化 AI 實例失敗。
2025-09-23 23:01:02 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 23:01:02 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 23:01:03 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 23:01:03 - [INFO] - Discord Bot is ready!
2025-09-23 23:01:06 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 23:01:06 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 23:01:07 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 23:01:16 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 23:01:16 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 23:01:16 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 23:01:16 - [ERROR] - [512280345618546699] [RAG持久化] 加載 BM25 語料庫失敗: Ran out of input。將觸發全量重建。
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 260, in _load_bm25_corpus
    self.bm25_corpus = pickle.load(f)
EOFError: Ran out of input
2025-09-23 23:01:16 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行一次性全量創始構建...
2025-09-23 23:01:16 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 2 條文檔用於創始構建。
2025-09-23 23:01:16 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-23 23:01:16 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 23:01:16 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 23:01:16 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 23:01:16 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 7 條訊息。
2025-09-23 23:01:16 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-23 23:01:16 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-23 23:01:16 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-23 23:01:16 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-23 23:01:16 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 23:01:16 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:01:16 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-23 23:01:16 - [INFO] - [512280345618546699] (RAG Cache) 檢索到 2 份文檔，正在檢查淨化快取...
2025-09-23 23:01:16 - [INFO] - [512280345618546699] (RAG Summarizer) 成功淨化 1/2 份文檔，正在進行最終摘要...
2025-09-23 23:01:17 - [INFO] - [512280345618546699] 已成功將 RAG 上下文提煉為事實要點。
2025-09-23 23:01:17 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-23 23:01:17 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 84386 秒)。
2025-09-23 23:01:17 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 84391 秒)。
2025-09-23 23:01:17 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 84396 秒)。
2025-09-23 23:01:17 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 84401 秒)。
2025-09-23 23:01:17 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 84416 秒)。
2025-09-23 23:01:17 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 84381 秒)。
2025-09-23 23:01:17 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-23 23:01:17 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-23 23:01:17 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-23 23:01:34 - [WARNING] - [512280345618546699] 在LLM輸出中未找到 ´´´novel 分隔符，已將整個輸出視為小說。
2025-09-23 23:01:34 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-23 23:01:35 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-23 23:01:35 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-23 23:01:36 - [INFO] - [512280345618546699] [長期記憶寫入] 安全存檔已成功保存到 SQL 資料庫。
2025-09-23 23:01:36 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-23 23:01:40 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-23 23:01:42 - [INFO] - [512280345618546699] [事後處理-LORE保險] 提取到 1 條新LORE，準備執行擴展...
2025-09-23 23:01:42 - [WARNING] - [512280345618546699] [計畫淨化] 已攔截一個試圖對核心主角 '碧' 執行的非法 LORE 操作 (create_new_npc_profile)。
2025-09-23 23:01:42 - [INFO] - [512280345618546699] (LORE Executor) 計畫在淨化與修正後為空，无需执行。
2025-09-23 23:01:42 - [INFO] - [512280345618546699] (LORE Executor) 背景任务的工具上下文已清理。
2025-09-23 23:05:43 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 23:05:43 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 23:05:43 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 23:05:43 - [INFO] - Discord Bot is ready!
2025-09-23 23:05:46 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 23:05:46 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 23:05:47 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 23:05:58 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 23:05:58 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 23:05:58 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 23:05:58 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 2 條文檔到 RAG 語料庫。
2025-09-23 23:05:58 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-23 23:05:58 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 23:05:58 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 23:05:58 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 23:05:58 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 9 條訊息。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 23:05:59 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-23 23:05:59 - [INFO] - [512280345618546699] (RAG Cache) 檢索到 2 份文檔，正在檢查淨化快取...
2025-09-23 23:05:59 - [INFO] - [512280345618546699] (RAG Summarizer) 成功淨化 1/2 份文檔，正在進行最終摘要...
2025-09-23 23:05:59 - [INFO] - [512280345618546699] 已成功將 RAG 上下文提煉為事實要點。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 84104 秒)。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 84109 秒)。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 84113 秒)。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 84119 秒)。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 84134 秒)。
2025-09-23 23:05:59 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 84099 秒)。
2025-09-23 23:05:59 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-23 23:05:59 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-23 23:05:59 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-23 23:06:12 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-23 23:06:12 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-23 23:06:12 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-23 23:06:13 - [INFO] - [512280345618546699] [長期記憶寫入] 安全存檔已成功保存到 SQL 資料庫。
2025-09-23 23:06:13 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-23 23:06:17 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-23 23:06:19 - [INFO] - [512280345618546699] [事後處理-LORE保險] 提取到 1 條新LORE，準備執行擴展...
2025-09-23 23:06:19 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 1 個修正後的LORE任务 ---
2025-09-23 23:06:19 - [WARNING] - [512280345618546699] [自動修正-邏輯] AI 試圖更新一個不存在的NPC (key: None)。已自動將操作轉換為創建新NPC。
2025-09-23 23:06:19 - [INFO] - [512280345618546699] [自動修正-邏輯] 已為新NPC '碧' 動態生成 lore_key: '艾瑞亞大陸 > 寂靜之森 > 月光溪谷的隱士小屋 > 碧'
2025-09-23 23:06:19 - [INFO] - [512280345618546699] [RAG增量更新] 已成功 添加 LORE '艾瑞亞大陸 > 寂靜之森 > 月光溪谷的隱士小屋 > 碧' 到 RAG 索引。當前總文檔數: 3
2025-09-23 23:06:19 - [INFO] - [512280345618546699] (LORE Executor) 任務成功: 已成功為新 NPC '碧' 創建了檔案 (主鍵: '艾瑞亞大陸 > 寂靜之森 > 月光溪谷的隱士小屋 > 碧')，地點: '艾瑞亞大陸 > 寂靜之森 > 月光溪谷的隱士小屋'。
2025-09-23 23:06:19 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-09-23 23:06:19 - [INFO] - [512280345618546699] (LORE Executor) 背景任务的工具上下文已清理。
2025-09-23 23:11:13 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 23:11:13 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 23:11:13 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 23:11:13 - [INFO] - Discord Bot is ready!
2025-09-23 23:11:16 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 23:11:16 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 23:11:17 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 23:11:27 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-23 23:11:27 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 23:11:27 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 23:11:27 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 23:11:27 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 3 條文檔到 RAG 語料庫。
2025-09-23 23:11:27 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-23 23:11:27 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 23:11:27 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 23:11:27 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 23:11:27 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 11 條訊息。
2025-09-23 23:11:27 - [INFO] - [512280345618546699] 正在關閉 AI 實例並釋放資源...
2025-09-23 23:11:28 - [INFO] - [512280345618546699] AI 實例資源已釋放。
2025-09-23 23:11:30 - [INFO] - [512280345618546699] 正在清除所有短期場景記憶...
2025-09-23 23:11:30 - [INFO] - [512280345618546699] 已成功從資料庫中刪除 11 條場景歷史記錄。
2025-09-23 23:11:33 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-09-23 23:11:37 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-09-23 23:11:37 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 23:11:37 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-09-23 23:11:37 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 23:11:37 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 23:11:37 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行一次性全量創始構建...
2025-09-23 23:11:37 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 0 條文檔用於創始構建。
2025-09-23 23:11:37 - [INFO] - [512280345618546699] (Retriever Builder) 知識庫為空，創始構建為空。
2025-09-23 23:11:37 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 23:11:37 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-09-23 23:11:37 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-09-23 23:11:38 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:11:40 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-09-23 23:12:31 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-09-23 23:12:31 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-09-23 23:12:33 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:12:35 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-09-23 23:12:47 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-09-23 23:12:47 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-09-23 23:12:47 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:12:50 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToCanonSetupView' finalize button clicked.
2025-09-23 23:12:50 - [INFO] - [512280345618546699] (UI Event) finalize_setup 被觸發。Canon provided: False
2025-09-23 23:12:50 - [INFO] - [512280345618546699] [/start 流程 1/4] 正在處理世界聖經...
2025-09-23 23:12:50 - [INFO] - [512280345618546699] [/start] 未提供世界聖經文本，跳過處理。
2025-09-23 23:12:52 - [INFO] - [512280345618546699] [/start 流程 2/4] 正在補完角色檔案...
2025-09-23 23:12:58 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-09-23 23:12:58 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:13:00 - [INFO] - [512280345618546699] [/start 流程 3/4] 正在生成世界創世資訊...
2025-09-23 23:13:04 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 23:13:04 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:13:04 - [INFO] - [512280345618546699] [/start] 初始地點 '艾瑟瑞亞大陸 > 靜謐森林 > 月語者小屋' 已成功生成並存入LORE。
2025-09-23 23:13:06 - [INFO] - [512280345618546699] [/start 流程 4/4] 正在生成開場白...
2025-09-23 23:13:06 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 83687 秒)。
2025-09-23 23:13:06 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 83692 秒)。
2025-09-23 23:13:06 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 83707 秒)。
2025-09-23 23:13:06 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 83673 秒)。
2025-09-23 23:13:06 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 83677 秒)。
2025-09-23 23:13:06 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 83682 秒)。
2025-09-23 23:13:06 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-23 23:13:06 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-23 23:13:06 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-23 23:13:32 - [INFO] - [512280345618546699] [/start 流程 4/4] 開場白生成完畢。
2025-09-23 23:13:32 - [INFO] - [512280345618546699] 開場白已成功作為第一條AI訊息存入場景 '512280345618546699_local_艾瑟瑞亞大陸_靜謐森林_月語者小屋' 的歷史記錄並持久化。
2025-09-23 23:13:32 - [INFO] - [512280345618546699] /start 流程：正在向使用者私訊發送開場白...
2025-09-23 23:13:33 - [INFO] - [512280345618546699] /start 流程：開場白發送完畢。設定流程成功結束。
2025-09-23 23:14:18 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-23 23:14:18 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 23:14:18 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:14:18 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 83620 秒)。
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 83635 秒)。
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 83601 秒)。
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 83605 秒)。
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 83610 秒)。
2025-09-23 23:14:18 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 83615 秒)。
2025-09-23 23:14:18 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-23 23:14:18 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-23 23:14:18 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-23 23:14:25 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-23 23:14:26 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-23 23:14:26 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-23 23:14:26 - [INFO] - [512280345618546699] [長期記憶寫入] 安全存檔已成功保存到 SQL 資料庫。
2025-09-23 23:14:26 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-23 23:14:31 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-23 23:14:32 - [INFO] - [512280345618546699] [事後處理-LORE保險] 提取到 1 條新LORE，準備執行擴展...
2025-09-23 23:14:32 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 1 個修正後的LORE任务 ---
2025-09-23 23:14:32 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for add_or_update_location_info: 1 validation error for AddOrUpdateLocationInfoArgs
lore_key
  Field required [type=missing, input_value={'location_name': '月語...', '月語者小屋']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1760, in _execute_tool_call_plan
    validated_args = tool_to_execute.args_schema.model_validate(call.parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for AddOrUpdateLocationInfoArgs
lore_key
  Field required [type=missing, input_value={'location_name': '月語...', '月語者小屋']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-23 23:14:32 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-09-23 23:14:32 - [INFO] - [512280345618546699] (LORE Executor) 背景任务的工具上下文已清理。
2025-09-23 23:17:18 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 23:17:18 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 23:17:19 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 23:17:19 - [INFO] - Discord Bot is ready!
2025-09-23 23:17:22 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 23:17:22 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 23:17:22 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 23:25:05 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 23:25:05 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 23:25:06 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 23:25:06 - [INFO] - Discord Bot is ready!
2025-09-23 23:25:09 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 23:25:09 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 23:25:09 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 23:25:19 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 23:25:19 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 23:25:19 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 23:25:19 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行一次性全量創始構建...
2025-09-23 23:25:19 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 2 條文檔用於創始構建。
2025-09-23 23:25:19 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-23 23:25:19 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 23:25:19 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 23:25:19 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 23:25:19 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 3 條訊息。
2025-09-23 23:25:19 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-23 23:25:19 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-23 23:25:19 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-23 23:25:19 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-23 23:25:19 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 23:25:19 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 23:25:19 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-23 23:25:19 - [INFO] - [512280345618546699] [微任務檢測] 已注入上下文: 臨時短期任務：或者……您有什麼新的指令要吩咐碧去完成 (狀態：進行中)
2025-09-23 23:25:19 - [INFO] - [512280345618546699] (RAG Cache) 檢索到 2 份文檔，正在檢查淨化快取...
2025-09-23 23:25:19 - [INFO] - [512280345618546699] (RAG Summarizer) 成功淨化 1/2 份文檔，正在進行最終摘要...
2025-09-23 23:25:20 - [INFO] - [512280345618546699] 已成功將 RAG 上下文提煉為事實要點。
2025-09-23 23:25:20 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-23 23:25:20 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 82943 秒)。
2025-09-23 23:25:20 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 82948 秒)。
2025-09-23 23:25:20 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 82952 秒)。
2025-09-23 23:25:20 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 82958 秒)。
2025-09-23 23:25:20 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 82973 秒)。
2025-09-23 23:25:20 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 82938 秒)。
2025-09-23 23:25:20 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-23 23:25:20 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-23 23:25:20 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-23 23:25:28 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-23 23:25:29 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-23 23:25:29 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-23 23:25:29 - [INFO] - [512280345618546699] [長期記憶寫入] 安全存檔已成功保存到 SQL 資料庫。
2025-09-23 23:25:29 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-23 23:25:34 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-23 23:25:34 - [INFO] - [512280345618546699] [事後處理-LORE保險] AI分析後判斷最終回應中不包含新的LORE可供提取。
2025-09-23 23:28:12 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 23:28:12 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 23:28:13 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 23:28:13 - [INFO] - Discord Bot is ready!
2025-09-23 23:28:15 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 23:28:15 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 23:28:16 - [INFO] - 已成功發送啟動成功通知給管理員。
