### AI Lover Log - Last updated at 2025-09-24T22:15:50.334085 ###

2025-09-24 16:22:27 - [INFO] - [512280345618546699] [LORE解析階段 4/4] 開始應用所有數據庫更新...
2025-09-24 16:22:38 - [INFO] - [512280345618546699] [LORE解析階段 4/4] 所有數據庫更新已應用。世界聖經解析流程完成。
2025-09-24 16:22:38 - [INFO] - [512280345618546699] 正在為世界聖經觸發一次性的 RAG 知識庫全量重建...
2025-09-24 16:22:38 - [INFO] - [512280345618546699] (Retriever Builder) 強制重建觸發，正在從資料庫執行全量創始構建...
2025-09-24 16:22:38 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 138 條文檔用於創始構建。
2025-09-24 16:22:38 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-24 16:22:38 - [INFO] - [512280345618546699] RAG 知識庫已成功重建。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-24 16:43:49 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-24 16:43:49 - [INFO] - [512280345618546699] (RAG Cache) 檢索到 15 份文檔，正在檢查淨化快取...
2025-09-24 16:43:49 - [WARNING] - [512280345618546699] (RAG Sanitizer) 所有檢索到的文檔都未能成功淨化。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 30625 秒)。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 30972 秒)。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 30393 秒)。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 30976 秒)。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 30615 秒)。
2025-09-24 16:43:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 30620 秒)。
2025-09-24 16:43:49 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-24 16:43:49 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-24 16:43:49 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-24 16:43:58 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash' with API Key #3.
2025-09-24 16:43:58 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-24 16:43:59 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-24 16:44:04 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-24 16:44:05 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-24 16:44:05 - [INFO] - [512280345618546699] [事後處理-LORE保險] AI分析後判斷最終回應中不包含新的LORE可供提取。
2025-09-24 17:35:34 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-24 17:35:34 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-24 17:35:34 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-24 17:35:34 - [INFO] - Discord Bot is ready!
2025-09-24 17:35:37 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-24 17:35:37 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-24 17:35:37 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-24 18:26:25 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-24 18:26:25 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-24 18:26:26 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-24 18:26:26 - [INFO] - Discord Bot is ready!
2025-09-24 18:26:28 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-24 18:26:28 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-24 18:26:29 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-24 18:28:42 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-24 18:28:42 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-24 18:28:42 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-24 18:28:42 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 138 條文檔到 RAG 語料庫。
2025-09-24 18:28:42 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-24 18:28:42 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-24 18:28:42 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-24 18:28:42 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-24 18:28:42 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 3 條訊息。
2025-09-24 18:28:42 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-24 18:28:42 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-24 18:28:42 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-24 18:28:42 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-24 18:28:42 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-24 18:28:42 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-24 18:28:42 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-24 18:28:42 - [INFO] - [512280345618546699] [微任務檢測] 已注入上下文: 臨時短期任務：她是您過去的故人，還是我們即將遇到的新朋友嗎 (狀態：進行中)
2025-09-24 18:28:42 - [INFO] - [512280345618546699] (RAG Summarizer) 檢索到 15 份原始文檔，正在直接進行摘要...
2025-09-24 18:28:47 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-24 18:28:47 - [INFO] - [512280345618546699] 已成功將 RAG 原始上下文提煉為事實要點。
2025-09-24 18:28:47 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-24 18:28:47 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 24317 秒)。
2025-09-24 18:28:47 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 24322 秒)。
2025-09-24 18:28:47 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 24327 秒)。
2025-09-24 18:28:47 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 24674 秒)。
2025-09-24 18:28:47 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 24095 秒)。
2025-09-24 18:28:47 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 24678 秒)。
2025-09-24 18:28:47 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-24 18:28:47 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-24 18:28:47 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-24 18:29:37 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash' with API Key #1.
2025-09-24 18:29:37 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-24 18:29:38 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-24 18:29:38 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-24 18:29:38 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-09-24 18:29:38 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-24 18:29:43 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-24 18:29:44 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-09-24 18:29:44 - [INFO] - [512280345618546699] [事後處理-LORE保險] 提取到 4 條新LORE，準備執行擴展...
2025-09-24 18:29:44 - [INFO] - [512280345618546699] [自動修正-參數] 為 '米婭' 動態生成缺失的 lore_key: '星語森林 > 月光溪谷 > 静谧小屋 > 米婭'
2025-09-24 18:29:44 - [INFO] - [512280345618546699] [自動修正-參數] 為 '聖露修道院' 動態生成缺失的 lore_key: '星語森林 > 月光溪谷 > 静谧小屋 > 聖露修道院'
2025-09-24 18:29:44 - [INFO] - [512280345618546699] [自動修正-參數] 為 '貧民窟' 動態生成缺失的 lore_key: '星語森林 > 月光溪谷 > 静谧小屋 > 貧民窟'
2025-09-24 18:29:44 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 4 個修正後的LORE任务 ---
2025-09-24 18:29:44 - [WARNING] - [512280345618546699] [抗幻覺] 檢測到對不存在NPC '米婭' 的更新。啟動事實查核...
2025-09-24 18:29:47 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #3.
2025-09-24 18:29:47 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #3) 遭遇解析或驗證錯誤: ValidationError。
2025-09-24 18:29:47 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for update_npc_profile: 1 validation error for EntityValidationResult
reasoning
  Field required [type=missing, input_value={'decision': 'CREATE', 'm...些豐富的資訊。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1947, in _execute_tool_call_plan
    validation_result = await self.ainvoke_with_rotation(validation_prompt, output_schema=EntityValidationResult, retry_strategy='none')
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 731, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 714, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for EntityValidationResult
reasoning
  Field required [type=missing, input_value={'decision': 'CREATE', 'm...些豐富的資訊。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-24 18:29:47 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for add_or_update_world_lore: 1 validation error for AddOrUpdateWorldLoreArgs
lore_key
  Field required [type=missing, input_value={'lore_name': '第二次...谷', '静谧小屋']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1966, in _execute_tool_call_plan
    validated_args = tool_to_execute.args_schema.model_validate(call.parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for AddOrUpdateWorldLoreArgs
lore_key
  Field required [type=missing, input_value={'lore_name': '第二次...谷', '静谧小屋']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-24 18:29:47 - [INFO] - [512280345618546699] [RAG增量更新] 已成功 添加 LORE '星語森林 > 月光溪谷 > 静谧小屋 > 聖露修道院' 到 RAG 索引。當前總文檔數: 139
2025-09-24 18:29:47 - [INFO] - [512280345618546699] (LORE Executor) 任務成功: 已成功為地點 '聖露修道院' 記錄了資訊。
2025-09-24 18:29:47 - [INFO] - [512280345618546699] [RAG增量更新] 已成功 添加 LORE '星語森林 > 月光溪谷 > 静谧小屋 > 貧民窟' 到 RAG 索引。當前總文檔數: 140
2025-09-24 18:29:47 - [INFO] - [512280345618546699] (LORE Executor) 任務成功: 已成功為地點 '貧民窟' 記錄了資訊。
2025-09-24 18:29:47 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-09-24 18:29:47 - [INFO] - [512280345618546699] (LORE Executor) 背景任务的工具上下文已清理。
2025-09-24 18:59:16 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-24 18:59:16 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-24 18:59:16 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-24 18:59:16 - [INFO] - [512280345618546699] [導演視角] 檢測到描述性指令，視角從 'local' 切換到 'remote'。
2025-09-24 18:59:16 - [INFO] - [512280345618546699] [導演視角] 遠程觀察目標設定為: ['米婭現在在維利爾斯宅邸，遇到維利爾斯', '時候', '情況']
2025-09-24 18:59:16 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-24 18:59:17 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-24 18:59:17 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-24 18:59:17 - [INFO] - [512280345618546699] (RAG Summarizer) 檢索到 15 份原始文檔，正在直接進行摘要...
2025-09-24 18:59:19 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-24 18:59:19 - [INFO] - [512280345618546699] 已成功將 RAG 原始上下文提煉為事實要點。
2025-09-24 18:59:19 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-24 18:59:19 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 22263 秒)。
2025-09-24 18:59:19 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 22846 秒)。
2025-09-24 18:59:19 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 22485 秒)。
2025-09-24 18:59:19 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 22490 秒)。
2025-09-24 18:59:19 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 22495 秒)。
2025-09-24 18:59:19 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 22841 秒)。
2025-09-24 18:59:19 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-24 18:59:19 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-24 18:59:19 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-24 18:59:34 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash' with API Key #5.
2025-09-24 18:59:35 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-24 18:59:35 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-24 18:59:35 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-24 18:59:35 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-09-24 18:59:35 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-24 18:59:40 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-24 18:59:42 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-24 18:59:42 - [INFO] - [512280345618546699] [事後處理-LORE保險] 提取到 4 條新LORE，準備執行擴展...
2025-09-24 18:59:42 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 4 個修正後的LORE任务 ---
2025-09-24 18:59:42 - [WARNING] - [512280345618546699] [抗幻覺] 檢測到對不存在NPC '未知實體' 的更新。啟動事實查核...
2025-09-24 18:59:43 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-09-24 18:59:43 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇解析或驗證錯誤: ValidationError。
2025-09-24 18:59:44 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for update_npc_profile: 1 validation error for EntityValidationResult
reasoning
  Field required [type=missing, input_value={'decision': 'CREATE', 'm...條目進行關聯。"}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1947, in _execute_tool_call_plan
    validation_result = await self.ainvoke_with_rotation(validation_prompt, output_schema=EntityValidationResult, retry_strategy='none')
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 731, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 714, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for EntityValidationResult
reasoning
  Field required [type=missing, input_value={'decision': 'CREATE', 'm...條目進行關聯。"}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-24 18:59:44 - [WARNING] - [512280345618546699] [抗幻覺] 檢測到對不存在NPC '未知實體' 的更新。啟動事實查核...
2025-09-24 18:59:45 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-09-24 18:59:45 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #2) 遭遇解析或驗證錯誤: ValidationError。
2025-09-24 18:59:45 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for update_npc_profile: 1 validation error for EntityValidationResult
reasoning
  Field required [type=missing, input_value={'decision': 'CREATE', 'r...', 'matched_key': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1947, in _execute_tool_call_plan
    validation_result = await self.ainvoke_with_rotation(validation_prompt, output_schema=EntityValidationResult, retry_strategy='none')
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 731, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 714, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for EntityValidationResult
reasoning
  Field required [type=missing, input_value={'decision': 'CREATE', 'r...', 'matched_key': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-24 18:59:45 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for add_or_update_location_info: 1 validation error for AddOrUpdateLocationInfoArgs
lore_key
  Field required [type=missing, input_value={'name': '維利爾斯宅...', '時候', '情況']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1966, in _execute_tool_call_plan
    validated_args = tool_to_execute.args_schema.model_validate(call.parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for AddOrUpdateLocationInfoArgs
lore_key
  Field required [type=missing, input_value={'name': '維利爾斯宅...', '時候', '情況']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-24 18:59:45 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for add_or_update_world_lore: 1 validation error for AddOrUpdateWorldLoreArgs
lore_key
  Field required [type=missing, input_value={'name': '聖戰', 'descr...', '時候', '情況']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1966, in _execute_tool_call_plan
    validated_args = tool_to_execute.args_schema.model_validate(call.parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for AddOrUpdateWorldLoreArgs
lore_key
  Field required [type=missing, input_value={'name': '聖戰', 'descr...', '時候', '情況']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-24 18:59:45 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-09-24 18:59:45 - [INFO] - [512280345618546699] (LORE Executor) 背景任务的工具上下文已清理。
2025-09-24 19:52:33 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-24 19:52:33 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-24 19:52:34 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-24 19:52:34 - [INFO] - Discord Bot is ready!
2025-09-24 19:52:37 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-24 19:52:37 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-24 19:52:37 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-24 19:57:49 - [ERROR] - 發送更新成功通知給管理員時發生未知錯誤: Server disconnected
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1581, in _perform_update_and_restart
    await admin_user.send("✅ **系統更新成功！** 機器人即將重啟。")
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\discord\abc.py", line 1644, in send
    data = await state.http.send_message(channel.id, params=params)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\discord\http.py", line 642, in request
    async with self.__session.request(method, url, **kwargs) as response:
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiohttp\client.py", line 1482, in __aenter__
    self._resp: _RetType = await self._coro
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiohttp\client.py", line 770, in _request
    resp = await handler(req)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiohttp\client.py", line 748, in _connect_and_send_request
    await resp.start(conn)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiohttp\client_reqrep.py", line 532, in start
    message, payload = await protocol.read()  # type: ignore[union-attr]
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiohttp\streams.py", line 672, in read
    await self._waiter
aiohttp.client_exceptions.ServerDisconnectedError: Server disconnected
2025-09-24 21:37:56 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-24 21:37:56 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-24 21:37:57 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-24 21:37:57 - [INFO] - Discord Bot is ready!
2025-09-24 21:37:59 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-24 21:37:59 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-24 21:38:00 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-24 21:56:25 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-24 21:56:25 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-24 21:56:25 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-24 21:56:25 - [INFO] - Discord Bot is ready!
2025-09-24 21:56:28 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-24 21:56:28 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-24 21:56:29 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-24 21:57:48 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-24 21:57:48 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-24 21:57:48 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-24 21:57:48 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 140 條文檔到 RAG 語料庫。
2025-09-24 21:57:48 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-24 21:57:48 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-24 21:57:48 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-24 21:57:48 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-24 21:57:48 - [INFO] - [512280345618546699] 成功恢復了 2 個場景的對話歷史，總計 7 條訊息。
2025-09-24 21:57:48 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-24 21:57:49 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-24 21:57:49 - [INFO] - [512280345618546699] [LORE解析 1/4] 正在嘗試【理想方案：直接全文解析】...
2025-09-24 21:57:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 12136 秒)。
2025-09-24 21:57:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 11775 秒)。
2025-09-24 21:57:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 11780 秒)。
2025-09-24 21:57:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #3 (針對模型 gemini-2.5-pro，剩餘 11785 秒)。
2025-09-24 21:57:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #4 (針對模型 gemini-2.5-pro，剩餘 12131 秒)。
2025-09-24 21:57:49 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #5 (針對模型 gemini-2.5-pro，剩餘 11553 秒)。
2025-09-24 21:57:49 - [WARNING] - [512280345618546699] [API 警告] 針對模型 'gemini-2.5-pro'，所有 API 金鑰當前都處於冷卻期。
2025-09-24 21:57:49 - [WARNING] - [512280345618546699] 在模型 'gemini-2.5-pro' 的嘗試中，所有 API 金鑰均處於長期冷卻期。
2025-09-24 21:57:49 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-24 22:00:49 - [WARNING] - [512280345618546699] Key #0 (模型: gemini-2.5-flash) 遭遇臨時性 API 錯誤 (TimeoutError)。將在 1.11 秒後進行第 2 次嘗試...
2025-09-24 22:03:50 - [WARNING] - [512280345618546699] Key #0 (模型: gemini-2.5-flash) 遭遇臨時性 API 錯誤 (TimeoutError)。將在 2.44 秒後進行第 3 次嘗試...
2025-09-24 22:06:53 - [ERROR] - [512280345618546699] Key #0 (模型: gemini-2.5-flash) 在 3 次內部重試後仍然失敗 (TimeoutError)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-24 22:09:53 - [WARNING] - [512280345618546699] Key #1 (模型: gemini-2.5-flash) 遭遇臨時性 API 錯誤 (TimeoutError)。將在 1.45 秒後進行第 2 次嘗試...
2025-09-24 22:12:54 - [WARNING] - [512280345618546699] Key #1 (模型: gemini-2.5-flash) 遭遇臨時性 API 錯誤 (TimeoutError)。將在 2.13 秒後進行第 3 次嘗試...
2025-09-24 22:15:36 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-24 22:15:36 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-24 22:15:36 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-24 22:15:36 - [INFO] - Discord Bot is ready!
2025-09-24 22:15:39 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-24 22:15:39 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-24 22:15:40 - [INFO] - 已成功發送啟動成功通知給管理員。
