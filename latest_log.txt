### AI Lover Log - Last updated at 2025-10-06T23:52:34.978602 ###

2025-10-06 23:06:37 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-06 23:06:39 - [INFO] - [512280345618546699] [創世流程 v65.1] 原生 Python 驅動的流程已啟動。
2025-10-06 23:06:39 - [INFO] - [512280345618546699] [後台創世] 正在將世界聖經原文分割成文檔...
2025-10-06 23:06:39 - [INFO] - [512280345618546699] [後台創世] 正在觸發 RAG 索引創始構建...
2025-10-06 23:06:39 - [INFO] - [512280345618546699] (Retriever Builder) 進入外部文檔注入模式，將使用 36 條傳入文檔構建純向量索引...
2025-10-06 23:07:21 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 純向量檢索器已成功從外部文檔構建。
2025-10-06 23:07:21 - [INFO] - [512280345618546699] [後台創世] RAG 索引構建完成，準備執行原生創世步驟...
2025-10-06 23:07:21 - [INFO] - [512280345618546699] [後台創世-原生] 步驟 1/2: 正在補完角色檔案...
2025-10-06 23:07:24 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:07:24 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:07:24 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-10-06 23:07:25 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-06 23:07:25 - [INFO] - [512280345618546699] [後台創世-原生] 角色檔案補完成功。
2025-10-06 23:07:25 - [INFO] - [512280345618546699] [後台創世-原生] 步驟 2/2: 正在生成開場白...
2025-10-06 23:07:25 - [INFO] - [512280345618546699] [/start] 正在使用 RAG 智能選擇並創作開場場景...
2025-10-06 23:07:25 - [INFO] - [512280345618546699] [RAG 原文直通] 正在使用查询: '根據這個世界的核心設定(這是一個魔法的幻想世界。)以及主角 DINO 和 碧 的背景，為他們的故事尋找一個最富有戲劇性、最符合世界觀的、適合二人出場的、遠離權力中心的靜態初始場景或情境。'
2025-10-06 23:07:25 - [INFO] - [512280345618546699] [RAG 原文直通] 檢索成功，獲得 20 份候選文檔。
2025-10-06 23:07:25 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-06 23:08:03 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #0.
2025-10-06 23:08:03 - [INFO] - [512280345618546699] [/start] 開場白已生成，正在從中反向提取權威地點...
2025-10-06 23:08:04 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:08:04 - [INFO] - [512280345618546699] [/start] ✅ 地點提取成功: 隱士塔樓 > 頂層。正在更新 GameState...
2025-10-06 23:08:04 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-10-06 23:08:04 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-06 23:08:04 - [INFO] - [512280345618546699] [後台創世-原生] 開場白生成成功。
2025-10-06 23:08:04 - [INFO] - [512280345618546699] [後台創世] 正在向使用者私訊發送最終開場白...
2025-10-06 23:08:05 - [INFO] - [512280345618546699] [後台創世] 開場白發送完畢。
2025-10-06 23:08:05 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-06 23:11:45 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-06 23:11:45 - [INFO] - [512280345618546699] [Direct RAG] 啟动 LORE 优先的 RAG 直通生成流程...
2025-10-06 23:11:45 - [INFO] - [512280345618546699] [動態世界-1/5] 正在進行意圖分類...
2025-10-06 23:11:46 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:11:46 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇解析或驗證錯誤: ValidationError。啟動【自我修正】流程...
2025-10-06 23:11:46 - [WARNING] - [512280345618546699] 導致解析錯誤的原始 LLM 輸出: 
--- START RAW ---
```json
{
  "intent": "sfw"
}
```
--- END RAW ---
2025-10-06 23:11:47 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:11:47 - [INFO] - [512280345618546699] [自我修正] ✅ 修正流程成功，正在重新驗證...
2025-10-06 23:11:47 - [INFO] - [512280345618546699] [動態世界-1/5] ✅ 意圖分類成功: sfw (理由: )
2025-10-06 23:11:47 - [INFO] - [512280345618546699] [動態世界-2/5] 正在執行意圖驅動的場景選角...
2025-10-06 23:11:49 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:11:51 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:11:51 - [INFO] - [512280345618546699] [動態世界] ✅ 成功識別/創造出 2 個新實體骨架: ['米婭', '勛爵']
2025-10-06 23:11:51 - [INFO] - [512280345618546699] [Raw RAG] 正在為內部流程執行原始文檔檢索，查詢: '關於角色 '米婭' 的所有已知資訊...'
2025-10-06 23:11:51 - [INFO] - [512280345618546699] [Raw RAG] ✅ 成功檢索到 20 份原始文檔。
2025-10-06 23:11:51 - [INFO] - [512280345618546699] [Raw RAG] 正在為內部流程執行原始文檔檢索，查詢: '關於角色 '勛爵' 的所有已知資訊...'
2025-10-06 23:11:51 - [INFO] - [512280345618546699] [Raw RAG] ✅ 成功檢索到 20 份原始文檔。
2025-10-06 23:11:59 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:11:59 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 2 個實體...
2025-10-06 23:11:59 - [INFO] - [512280345618546699] (_resolve_and_save) 正在創建新 LORE：'宅邸 > 米婭'
2025-10-06 23:12:00 - [INFO] - [512280345618546699] (_resolve_and_save) 正在創建新 LORE：'宅邸 > 勛爵'
2025-10-06 23:12:00 - [INFO] - [512280345618546699] [動態世界] 前置 LORE 更新流程完成。
2025-10-06 23:12:00 - [INFO] - [512280345618546699] [主生成] 開始執行對話生成...
2025-10-06 23:12:01 - [INFO] - [512280345618546699] [雙引擎實體提取] 成功提取高質量實體: ['中央', '頂層']
2025-10-06 23:12:01 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-06 23:12:01 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:12:01 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['米婭', '宅邸', '勛爵']
2025-10-06 23:12:01 - [INFO] - [512280345618546699] [主生成] 查詢擴展完成，最終核心實體: ['DINO', '頂層', '宅邸', '勛爵', '中央', '米婭', '碧']
2025-10-06 23:12:01 - [INFO] - [512280345618546699] [RAG 原文直通] 正在使用查询: '描述米婭在宅邸遇到勛爵 DINO 頂層 宅邸 勛爵 中央 米婭 碧'
2025-10-06 23:12:02 - [INFO] - [512280345618546699] [RAG 原文直通] 檢索成功，獲得 20 份候選文檔。
2025-10-06 23:12:02 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-06 23:12:03 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:12:43 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #0.
2025-10-06 23:12:45 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
2025-10-06 23:12:47 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析與分流任務...
2025-10-06 23:12:50 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:12:50 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-10-06 23:12:50 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-10-06 23:12:50 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-10-06 23:12:52 - [INFO] - [512280345618546699] 背景任務：檢測到 2 條 LORE 更新，準備執行...
2025-10-06 23:12:52 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 2 個修正後的LORE任务 ---
2025-10-06 23:12:52 - [INFO] - [512280345618546699] [RAG增量更新] 已成功 添加 LORE '宅邸 > 米婭' 到 RAG 索引。當前總文檔數: 1
2025-10-06 23:12:52 - [INFO] - [512280345618546699] [RAG增量更新] 已成功 添加 LORE '宅邸 > 勛爵' 到 RAG 索引。當前總文檔數: 2
2025-10-06 23:12:52 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-10-06 23:12:52 - [INFO] - [512280345618546699] 背景任務：LORE更新執行完畢。摘要: 任務成功: 已成功更新 NPC '米婭' 的檔案。
任務成功: 已成功更新 NPC '勛爵' 的檔案。
2025-10-06 23:12:52 - [INFO] - [512280345618546699] [事後分析] 背景分析與分流任務完成。
2025-10-06 23:23:47 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-06 23:23:47 - [INFO] - [512280345618546699] [Direct RAG] 啟动 LORE 优先的 RAG 直通生成流程...
2025-10-06 23:23:47 - [INFO] - [512280345618546699] [動態世界-1/5] 正在進行意圖分類...
2025-10-06 23:23:48 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:23:48 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇解析或驗證錯誤: ValidationError。啟動【自我修正】流程...
2025-10-06 23:23:48 - [WARNING] - [512280345618546699] 導致解析錯誤的原始 LLM 輸出: 
--- START RAW ---
```json
{
  "intent": "nsfw_interactive"
}
```
--- END RAW ---
2025-10-06 23:23:49 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:23:49 - [INFO] - [512280345618546699] [自我修正] ✅ 修正流程成功，正在重新驗證...
2025-10-06 23:23:49 - [ERROR] - [512280345618546699] [自我修正] 🔥 自我修正流程最終失敗: 2 validation errors for IntentClassificationResult
intent_type
  Field required [type=missing, input_value={'intent': 'nsfw_interactive', 'reasoning': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
reasoning
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1770, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(corrected_clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 568, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 2 validation errors for IntentClassificationResult
intent_type
  Field required [type=missing, input_value={'intent': 'nsfw_interactive', 'reasoning': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
reasoning
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
2025-10-06 23:23:49 - [ERROR] - [512280345618546699] [動態世界] 在前置 LORE 更新流程中发生严重错误: 2 validation errors for IntentClassificationResult
intent_type
  Field required [type=missing, input_value={'intent': 'nsfw_interactive'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
reasoning
  Field required [type=missing, input_value={'intent': 'nsfw_interactive'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 447, in direct_rag_generate
    intent_result = await self.ainvoke_with_rotation(full_intent_prompt, output_schema=IntentClassificationResult, models_to_try_override=[FUNCTIONAL_MODEL])
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1774, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1722, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(repaired_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 568, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 2 validation errors for IntentClassificationResult
intent_type
  Field required [type=missing, input_value={'intent': 'nsfw_interactive'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
reasoning
  Field required [type=missing, input_value={'intent': 'nsfw_interactive'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
2025-10-06 23:23:49 - [INFO] - [512280345618546699] [主生成] 開始執行對話生成...
2025-10-06 23:23:50 - [INFO] - [512280345618546699] [雙引擎實體提取] 成功提取高質量實體: ['頂層', '瞰著', '勛爵', '中央', '卡爾•', '米婭', '何雄性', '姿勢']
2025-10-06 23:23:50 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-06 23:23:51 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:23:52 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['米婭', '聖露修道院', '勛爵', '信徒']
2025-10-06 23:23:52 - [INFO] - [512280345618546699] [主生成] 查詢擴展完成，最終核心實體: ['聖露修道院', 'DINO', '卡爾•', '何雄性', '頂層', '瞰著', '信徒', '勛爵', '中央', '米婭', '姿勢', '碧']
2025-10-06 23:23:52 - [INFO] - [512280345618546699] [RAG 原文直通] 正在使用查询: '描述米婭在聖露修道院二樓，一邊被勛爵從後面強暴屁眼，一邊探出上半身向信徒揮手 聖露修道院 DINO 卡爾• 何雄性 頂層 瞰著 信徒 勛爵 中央 米婭 姿勢 碧'
2025-10-06 23:23:52 - [INFO] - [512280345618546699] [RAG 原文直通] 檢索成功，獲得 2 份候選文檔。
2025-10-06 23:23:52 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 2 條原始文檔作為 summary_context。
2025-10-06 23:23:54 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇靜默失敗，生成因 '8' 而提前終止。
2025-10-06 23:23:54 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-06 23:23:54 - [WARNING] - [512280345618546699] 內部鏈意外遭遇審查。啟動【通用化解構-重構】策略...
2025-10-06 23:23:54 - [INFO] - [512280345618546699] (Euphemizer) 已提取用於重構的關鍵詞: ['顫抖', '子宮', '肉穴', '愛液', '高潮', '陰蒂', 'DINO', '碧', '主人', '母畜']
2025-10-06 23:23:55 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:23:55 - [INFO] - [512280345618546699] (Euphemizer) 已生成淨化後的 Prompt，正在進行最終嘗試...
2025-10-06 23:24:15 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #0.
2025-10-06 23:24:56 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #0.
2025-10-06 23:24:59 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
2025-10-06 23:25:00 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析與分流任務...
2025-10-06 23:25:03 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:25:03 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-10-06 23:25:03 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-10-06 23:25:03 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-10-06 23:25:05 - [INFO] - [512280345618546699] 背景任務：檢測到 2 條 LORE 更新，準備執行...
2025-10-06 23:25:05 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 2 個修正後的LORE任务 ---
2025-10-06 23:25:05 - [WARNING] - [512280345618546699] [抗幻覺] 檢測到對不存在實體 '米婭' 的更新。啟動事實查核...
2025-10-06 23:25:06 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:25:06 - [INFO] - [512280345618546699] [抗幻覺] 事實查核裁定為 MERGE。正在合併到 '宅邸 > 米婭'...
2025-10-06 23:25:06 - [WARNING] - [512280345618546699] [抗幻覺] 檢測到對不存在實體 '勛爵' 的更新。啟動事實查核...
2025-10-06 23:25:07 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:25:07 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇解析或驗證錯誤: JSONDecodeError。啟動【自我修正】流程...
2025-10-06 23:25:07 - [WARNING] - [512280345618546699] 導致解析錯誤的原始 LLM 輸出: 
--- START RAW ---
```json
{
  "decision": "MERGE",
  "reasoning": "對話上下文未提供關於'勛爵'的資訊，但在現有實體數據庫中存在一個名為'勛爵'的條目，因此判定為MERGE。",
  "matched_key": "宅邸 > 勛爵"
}
```
--- END RAW ---
2025-10-06 23:25:08 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:25:08 - [INFO] - [512280345618546699] [自我修正] ✅ 修正流程成功，正在重新驗證...
2025-10-06 23:25:08 - [INFO] - [512280345618546699] [抗幻覺] 事實查核裁定為 MERGE。正在合併到 '宅邸 > 勛爵'...
2025-10-06 23:25:08 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-10-06 23:25:08 - [INFO] - [512280345618546699] 背景任務：LORE更新執行完畢。摘要: 任務成功 (修正後合併): 已將信息合併到 '宅邸 > 米婭'。
任務成功 (修正後合併): 已將信息合併到 '宅邸 > 勛爵'。
2025-10-06 23:25:08 - [INFO] - [512280345618546699] [事後分析] 背景分析與分流任務完成。
2025-10-06 23:30:45 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-06 23:30:45 - [INFO] - [512280345618546699] [Direct RAG] 啟动 LORE 优先的 RAG 直通生成流程...
2025-10-06 23:30:45 - [INFO] - [512280345618546699] [動態世界-1/5] 正在進行意圖分類...
2025-10-06 23:30:46 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:30:46 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇解析或驗證錯誤: ValidationError。啟動【自我修正】流程...
2025-10-06 23:30:46 - [WARNING] - [512280345618546699] 導致解析錯誤的原始 LLM 輸出: 
--- START RAW ---
```json
{
  "intent": "nsfw_interactive"
}
```
--- END RAW ---
2025-10-06 23:30:47 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:30:47 - [INFO] - [512280345618546699] [自我修正] ✅ 修正流程成功，正在重新驗證...
2025-10-06 23:30:47 - [ERROR] - [512280345618546699] [自我修正] 🔥 自我修正流程最終失敗: 1 validation error for IntentClassificationResult
intent_type
  Field required [type=missing, input_value={'intent': 'nsfw_interactive', 'reasoning': ''}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1770, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(corrected_clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 568, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for IntentClassificationResult
intent_type
  Field required [type=missing, input_value={'intent': 'nsfw_interactive', 'reasoning': ''}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
2025-10-06 23:30:47 - [ERROR] - [512280345618546699] [動態世界] 在前置 LORE 更新流程中发生严重错误: 2 validation errors for IntentClassificationResult
intent_type
  Field required [type=missing, input_value={'intent': 'nsfw_interactive'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
reasoning
  Field required [type=missing, input_value={'intent': 'nsfw_interactive'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 447, in direct_rag_generate
    intent_result = await self.ainvoke_with_rotation(full_intent_prompt, output_schema=IntentClassificationResult, models_to_try_override=[FUNCTIONAL_MODEL])
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1774, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1722, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(repaired_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 568, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 2 validation errors for IntentClassificationResult
intent_type
  Field required [type=missing, input_value={'intent': 'nsfw_interactive'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
reasoning
  Field required [type=missing, input_value={'intent': 'nsfw_interactive'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
2025-10-06 23:30:47 - [INFO] - [512280345618546699] [主生成] 開始執行對話生成...
2025-10-06 23:30:48 - [INFO] - [512280345618546699] [雙引擎實體提取] 成功提取高質量實體: ['握著', '泛起', '爵從', '聖女', '瞰著', '米婭纖細', '將積蓄', '勛爵', '這正', '拱形', '卡爾•', '米婭', '何雄性', '姿勢']
2025-10-06 23:30:48 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-06 23:30:49 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:30:50 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['米婭', '勛爵']
2025-10-06 23:30:50 - [INFO] - [512280345618546699] [主生成] 查詢擴展完成，最終核心實體: ['米婭纖細', 'DINO', '何雄性', '卡爾•', '將積蓄', '握著', '泛起', '爵從', '聖女', '瞰著', '勛爵', '這正', '拱形', '米婭', '姿勢', '碧']
2025-10-06 23:30:50 - [INFO] - [512280345618546699] [RAG 原文直通] 正在使用查询: '米婭是母畜，會立刻起身用口舌為勛爵清潔肉棒 米婭纖細 DINO 何雄性 卡爾• 將積蓄 握著 泛起 爵從 聖女 瞰著 勛爵 這正 拱形 米婭 姿勢 碧'
2025-10-06 23:30:50 - [INFO] - [512280345618546699] [RAG 原文直通] 檢索成功，獲得 2 份候選文檔。
2025-10-06 23:30:50 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 2 條原始文檔作為 summary_context。
2025-10-06 23:30:52 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:30:53 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #0) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-06 23:30:53 - [WARNING] - [512280345618546699] 最終生成鏈遭遇審查 (Prompt blocked due to 4)。啟動【最高指令集注入 & 強制 Key 輪換重試】策略...
2025-10-06 23:30:53 - [INFO] - [512280345618546699] [強制重試] 已準備 3 個備用 API Keys 進行重試。
2025-10-06 23:30:53 - [INFO] - [512280345618546699] [強制重試 1/3] 使用 API Key #0 進行嘗試...
2025-10-06 23:30:55 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #0) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-06 23:31:01 - [WARNING] - [512280345618546699] [強制重試 1/3] 使用 Key #0 的嘗試失敗: Prompt blocked due to 4
2025-10-06 23:31:01 - [INFO] -    -> 將在 0.5 秒後使用下一個 Key 進行嘗試...
2025-10-06 23:31:02 - [INFO] - [512280345618546699] [強制重試 2/3] 使用 API Key #1 進行嘗試...
2025-10-06 23:31:04 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #1) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-06 23:31:04 - [WARNING] - [512280345618546699] [強制重試 2/3] 使用 Key #1 的嘗試失敗: Prompt blocked due to 4
2025-10-06 23:31:04 - [INFO] -    -> 將在 1.0 秒後使用下一個 Key 進行嘗試...
2025-10-06 23:31:05 - [INFO] - [512280345618546699] [強制重試 3/3] 使用 API Key #2 進行嘗試...
2025-10-06 23:31:06 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #2) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-06 23:31:06 - [WARNING] - [512280345618546699] [強制重試 3/3] 使用 Key #2 的嘗試失敗: Prompt blocked due to 4
2025-10-06 23:31:06 - [ERROR] - [512280345618546699] 【強制 Key 輪換重試】策略在 3 次嘗試後最終失敗。
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1676, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {reason_str}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to 4

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3314, in _force_and_retry
    return await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1730, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1676, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {reason_str}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to 4
2025-10-06 23:31:07 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
2025-10-06 23:31:09 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析與分流任務...
2025-10-06 23:31:10 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-06 23:31:10 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-10-06 23:31:10 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-10-06 23:31:10 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-10-06 23:31:12 - [INFO] - [512280345618546699] 背景任務：檢測到 2 條 LORE 更新，準備執行...
2025-10-06 23:31:12 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 2 個修正後的LORE任务 ---
2025-10-06 23:31:13 - [INFO] - [512280345618546699] [RAG增量更新] 已成功 更新 LORE '宅邸 > 米婭' 到 RAG 索引。當前總文檔數: 2
2025-10-06 23:31:13 - [INFO] - [512280345618546699] [RAG增量更新] 已成功 更新 LORE '宅邸 > 勛爵' 到 RAG 索引。當前總文檔數: 2
2025-10-06 23:31:13 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-10-06 23:31:13 - [INFO] - [512280345618546699] 背景任務：LORE更新執行完畢。摘要: 任務成功: 已成功更新 NPC '米婭' 的檔案。
任務成功: 已成功更新 NPC '勛爵' 的檔案。
2025-10-06 23:31:13 - [INFO] - [512280345618546699] [事後分析] 背景分析與分流任務完成。
2025-10-06 23:37:11 - [INFO] - 正在加載核心 Cog (core_cog)...
2025-10-06 23:37:17 - [INFO] - ✅ 核心 Cog (core_cog) 已加載，並且所有持久化視圖已成功註冊。
2025-10-06 23:37:17 - [INFO] - ✅ 核心 Cog 加載成功。
2025-10-06 23:37:17 - [INFO] - 正在全域同步應用程式指令...
2025-10-06 23:37:17 - [INFO] - ✅ 指令已全域同步！
2025-10-06 23:37:17 - [INFO] - Discord Bot setup hook finished!
2025-10-06 23:37:20 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-06 23:37:21 - [INFO] - 已成功發送啟動成功通知給管理員。
