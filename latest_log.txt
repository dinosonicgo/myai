### AI Lover Log - Last updated at 2025-09-21T23:43:19.403153 ###

2025-09-21 23:26:51 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-21 23:26:51 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-21 23:26:51 - [INFO] - [512280345618546699] 核心協議模板 '00_supreme_directive.txt' 已成功加載並設置。
2025-09-21 23:26:51 - [INFO] - [512280345618546699] 正在創建 Embedding 模型實例 (API Key index: 0)
2025-09-21 23:26:51 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 加載 0 條記憶。
2025-09-21 23:26:51 - [INFO] - [512280345618546699] (Retriever Builder) 記憶庫為空，BM25 備援檢索器為空。
2025-09-21 23:26:51 - [INFO] - [512280345618546699] (Retriever Builder) ChromaDB 主要檢索器構建成功。
2025-09-21 23:26:51 - [INFO] - [512280345618546699] (Retriever Builder) 混合檢索器構建成功。
2025-09-21 23:26:51 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-21 23:26:51 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-21 23:26:52 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-21 23:26:52 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-21 23:26:52 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-21 23:26:52 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-21 23:26:52 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-21 23:26:52 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-21 23:26:52 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-21 23:26:52 - [WARNING] - [512280345618546699] (RAG Executor) 主記憶系統 (Embedding) 失敗: GoogleGenerativeAIError
2025-09-21 23:26:52 - [INFO] - [512280345618546699] (RAG Executor) [備援觸發] 正在啟動備援記憶系統 (BM25)...
2025-09-21 23:26:52 - [INFO] - [512280345618546699] (RAG Executor) [備援成功] 備援記憶系統 (BM25) 檢索成功。
2025-09-21 23:26:52 - [INFO] - [512280345618546699] [上下文篩選] 核心目標: [], 背景角色: ['艾莉亞', '老樹根']
2025-09-21 23:26:52 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-21 23:27:21 - [WARNING] - [512280345618546699] Key #1 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.25 秒後進行第 2 次嘗試...
2025-09-21 23:27:22 - [WARNING] - [512280345618546699] Key #1 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.18 秒後進行第 3 次嘗試...
2025-09-21 23:27:25 - [ERROR] - [512280345618546699] Key #1 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-21 23:28:03 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-21 23:28:03 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-21 23:28:08 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-21 23:28:10 - [INFO] - [512280345618546699] [事後處理-LORE保險] 提取到 3 條新LORE，準備執行擴展...
2025-09-21 23:28:10 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 3 個LORE任务 ---
2025-09-21 23:28:14 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for add_or_update_item_info: 'AILover' object has no attribute 'add_lore_to_rag'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 997, in _execute_tool_call_plan
    result = await tool_to_execute.ainvoke(validated_args.model_dump())
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\structured.py", line 66, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\base.py", line 609, in ainvoke
    return await self.arun(tool_input, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\base.py", line 996, in arun
    raise error_to_raise
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\base.py", line 965, in arun
    response = await coro_with_context(coro, context)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\structured.py", line 110, in _arun
    return await self.coroutine(*args, **kwargs)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\lore_tools.py", line 163, in add_or_update_item_info
    asyncio.create_task(ai_core.add_lore_to_rag(new_lore))
AttributeError: 'AILover' object has no attribute 'add_lore_to_rag'
2025-09-21 23:28:18 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for add_or_update_item_info: 1 validation error for AddOrUpdateItemInfoArgs
standardized_name
  Field required [type=missing, input_value={'lore_key': 'red_berries...脈', '月光溪谷']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 996, in _execute_tool_call_plan
    validated_args = tool_to_execute.args_schema.model_validate(call.parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for AddOrUpdateItemInfoArgs
standardized_name
  Field required [type=missing, input_value={'lore_key': 'red_berries...脈', '月光溪谷']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-21 23:28:22 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for create_new_npc_profile: 'AILover' object has no attribute 'add_lore_to_rag'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 997, in _execute_tool_call_plan
    result = await tool_to_execute.ainvoke(validated_args.model_dump())
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\structured.py", line 66, in ainvoke
    return await super().ainvoke(input, config, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\base.py", line 609, in ainvoke
    return await self.arun(tool_input, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\base.py", line 996, in arun
    raise error_to_raise
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\base.py", line 965, in arun
    response = await coro_with_context(coro, context)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\tools\structured.py", line 110, in _arun
    return await self.coroutine(*args, **kwargs)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\lore_tools.py", line 71, in create_new_npc_profile
    asyncio.create_task(ai_core.add_lore_to_rag(new_lore))
AttributeError: 'AILover' object has no attribute 'add_lore_to_rag'
2025-09-21 23:28:22 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-09-21 23:28:22 - [INFO] - [512280345618546699] (LORE Executor) 背景任务的工具上下文已清理。
2025-09-21 23:37:02 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-21 23:37:02 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-21 23:37:03 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-21 23:37:03 - [INFO] - Discord Bot is ready!
2025-09-21 23:37:05 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-21 23:37:05 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-21 23:37:06 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-21 23:42:28 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-21 23:42:28 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-21 23:42:29 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-21 23:42:29 - [INFO] - Discord Bot is ready!
2025-09-21 23:42:31 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-21 23:42:31 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-21 23:42:32 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-21 23:43:05 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-21 23:43:05 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-21 23:43:05 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-21 23:43:05 - [INFO] - Discord Bot is ready!
2025-09-21 23:43:08 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-21 23:43:08 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-21 23:43:08 - [INFO] - 已成功發送啟動成功通知給管理員。
