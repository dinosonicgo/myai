### AI Lover Log - Last updated at 2025-10-04T19:51:14.643821 ###

  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #2 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #3 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #3 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #3 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #4 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #4 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #4 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #5 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #5 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] 創建 ChatGoogleGenerativeAI 實例時發生錯誤: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 346, in _get_langchain_llm
    return ChatGoogleGenerativeAI(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\load\serializable.py", line 113, in __init__
    super().__init__(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\v1\main.py", line 341, in __init__
    raise validation_error
pydantic.v1.error_wrappers.ValidationError: 1 validation error for ChatGoogleGenerativeAI
safety_settings -> __key__
  value is not a valid integer (type=type_error.integer)
2025-10-04 18:24:55 - [WARNING] - [512280345618546699] 無法為 Key #5 創建 LLM 實例，跳過。
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] [Final Failure] 所有模型和金鑰均最終失敗。最後的錯誤是: None
2025-10-04 18:24:55 - [ERROR] - [512280345618546699] (Setup Graph|4/4) Node: generate_opening_scene -> 執行時發生嚴重錯誤: ainvoke_with_rotation failed without a specific exception.
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\graph.py", line 633, in generate_opening_scene_node
    opening_scene = await ai_core.generate_opening_scene(canon_text=canon_text)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2908, in generate_opening_scene
    opening_scene = await self.ainvoke_with_rotation(full_prompt, retry_strategy='force', use_degradation=True)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1408, in ainvoke_with_rotation
    raise last_exception if last_exception else Exception("ainvoke_with_rotation failed without a specific exception.")
Exception: ainvoke_with_rotation failed without a specific exception.
2025-10-04 18:24:55 - [INFO] - [512280345618546699] [後台創世] 正在向使用者私訊發送最終開場白...
2025-10-04 18:24:55 - [INFO] - [512280345618546699] [後台創世] 開場白發送完畢。
2025-10-04 18:24:55 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-04 18:30:09 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-04 18:30:09 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-04 18:30:09 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-04 18:30:09 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-04 18:30:09 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-04 18:30:09 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-04 18:30:09 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-04 18:30:09 - [INFO] - Discord Bot is ready!
2025-10-04 18:30:12 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-04 18:30:12 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-04 18:30:12 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-04 18:30:18 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-04 18:30:18 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-04 18:30:18 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-04 18:30:19 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-04 18:30:19 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-04 18:30:19 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-04 18:30:21 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-04 18:30:26 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-04 18:30:27 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-04 18:30:27 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-04 18:30:27 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-04 18:30:27 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-04 18:30:27 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-04 18:30:29 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-04 18:30:29 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-04 18:30:29 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-04 18:30:29 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-04 18:30:29 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-04 18:30:35 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-04 18:30:42 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-04 18:30:43 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-04 18:30:43 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-04 18:30:44 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-04 18:30:54 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-10-04 18:30:54 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-10-04 18:30:54 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-04 18:30:56 - [INFO] - [512280345618546699] [創世流程] 檔案上傳開始，已設定 active_setups 狀態鎖。
2025-10-04 18:31:00 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-04 18:31:03 - [INFO] - [512280345618546699] [創世流程 v64.0] Graph 驅動的流程已啟動。
2025-10-04 18:31:03 - [INFO] - [512280345618546699] [後台創世] 正在將世界聖經原文分割成文檔...
2025-10-04 18:31:03 - [INFO] - [512280345618546699] [後台創世] 正在觸發 RAG 索引創始構建...
2025-10-04 18:31:03 - [INFO] - [512280345618546699] (Retriever Builder) 進入外部文檔注入模式，將使用 34 條傳入文檔構建純向量索引...
2025-10-04 18:31:43 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 純向量檢索器已成功從外部文檔構建。
2025-10-04 18:31:43 - [INFO] - [512280345618546699] [後台創世] RAG 索引構建完成，準備執行創世圖...
2025-10-04 18:31:43 - [INFO] - [512280345618546699] (Setup Graph|2/4) Node: complete_profiles_node -> 節點已啟動，準備補完角色檔案...
2025-10-04 18:31:43 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:31:43 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:31:46 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 18:31:46 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 18:31:46 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-10-04 18:31:47 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-04 18:31:47 - [INFO] - [512280345618546699] (Setup Graph|2/4) Node: complete_profiles_node -> 節點執行成功。
2025-10-04 18:31:47 - [INFO] - [512280345618546699] (Setup Graph|4/4) Node: generate_opening_scene -> 節點已啟動...
2025-10-04 18:31:47 - [INFO] - [512280345618546699] [/start] 正在使用 RAG 智能選擇並創作開場場景...
2025-10-04 18:31:47 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '根據這個世界的核心設定(這是一個魔法的幻想世界。)以及主角 DINO 和 碧 的背景，為他們的故事尋...' 中分析實體...
2025-10-04 18:31:47 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-04 18:31:47 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:31:47 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 18:31:47 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['DINO', '碧']
2025-10-04 18:31:47 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-04 18:31:47 - [INFO] - [512280345618546699] [RAG 原文直通] 查詢已擴展為: '的背景，為他們的故事尋找一個最富有戲劇性、最符合世界觀的、適合二人出場的、遠離權力中心的靜態初始場景或情境。 根據這個世界的核心設定(這是一個魔法的幻想世界。)以及主角 DINO 和 碧'
2025-10-04 18:31:48 - [INFO] - [512280345618546699] [RAG 原文直通] 粗略檢索成功，獲得 20 份候選文檔。
2025-10-04 18:31:48 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-04 18:31:48 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-pro' 實例 (API Key index: provided)
2025-10-04 18:32:19 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #0.
2025-10-04 18:32:19 - [INFO] - [512280345618546699] [/start] 開場白已生成，正在從中反向提取權威地點...
2025-10-04 18:32:19 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 18:32:20 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 18:32:20 - [INFO] - [512280345618546699] [/start] ✅ 地點提取成功: 聖凱瑟琳學院 > 高塔書房。正在更新 GameState...
2025-10-04 18:32:20 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-10-04 18:32:21 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-04 18:32:21 - [INFO] - [512280345618546699] (Setup Graph|4/4) Node: generate_opening_scene -> 節點執行成功。
2025-10-04 18:32:21 - [INFO] - [512280345618546699] [後台創世] 正在向使用者私訊發送最終開場白...
2025-10-04 18:32:21 - [INFO] - [512280345618546699] [後台創世] 開場白發送完畢。
2025-10-04 18:32:21 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-04 19:42:59 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-04 19:42:59 - [INFO] - [512280345618546699] [Direct RAG] 啟動 LORE 優先的 RAG 直通生成流程...
2025-10-04 19:42:59 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '抓住碧的頭髮，讓她為我口交...' 中分析實體...
2025-10-04 19:42:59 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-04 19:42:59 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 19:42:59 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 19:42:59 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['碧']
2025-10-04 19:42:59 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-04 19:42:59 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '抓住碧的頭髮，讓她為我口交...' 中分析實體...
2025-10-04 19:42:59 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-04 19:42:59 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 19:43:00 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 19:43:00 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['碧']
2025-10-04 19:43:00 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-04 19:43:00 - [INFO] - [512280345618546699] [RAG 原文直通] 查詢已擴展為: '抓住碧的頭髮，讓她為我口交 DINO 碧'
2025-10-04 19:43:00 - [INFO] - [512280345618546699] [RAG 原文直通] 粗略檢索成功，獲得 20 份候選文檔。
2025-10-04 19:43:00 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-04 19:43:00 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-flash-lite' 實例 (API Key index: provided)
2025-10-04 19:43:01 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 19:43:01 - [INFO] - [512280345618546699] 正在創建 LangChain 模型 'gemini-2.5-pro' 實例 (API Key index: provided)
2025-10-04 19:43:36 - [ERROR] - [512280345618546699] 在 ainvoke 期間發生未知錯誤 (模型: gemini-2.5-pro): 'int' object has no attribute 'name'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1292, in ainvoke_with_rotation
    response = await asyncio.wait_for(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 445, in wait_for
    return fut.result()
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\language_models\chat_models.py", line 298, in ainvoke
    llm_result = await self.agenerate_prompt(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\language_models\chat_models.py", line 787, in agenerate_prompt
    return await self.agenerate(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\language_models\chat_models.py", line 747, in agenerate
    raise exceptions[0]
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\language_models\chat_models.py", line 923, in _agenerate_with_cache
    result = await self._agenerate(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_google_genai\chat_models.py", line 809, in _agenerate
    return _response_to_result(response)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_google_genai\chat_models.py", line 558, in _response_to_result
    generation_info["finish_reason"] = candidate.finish_reason.name
AttributeError: 'int' object has no attribute 'name'
2025-10-04 19:43:36 - [ERROR] - 處理使用者 512280345618546699 的 RAG 直通流程時發生異常: 'int' object has no attribute 'name'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1354, in on_message
    final_response = await ai_instance.direct_rag_generate(user_input)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 519, in direct_rag_generate
    final_response = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1404, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1292, in ainvoke_with_rotation
    response = await asyncio.wait_for(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 445, in wait_for
    return fut.result()
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\language_models\chat_models.py", line 298, in ainvoke
    llm_result = await self.agenerate_prompt(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\language_models\chat_models.py", line 787, in agenerate_prompt
    return await self.agenerate(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\language_models\chat_models.py", line 747, in agenerate
    raise exceptions[0]
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\language_models\chat_models.py", line 923, in _agenerate_with_cache
    result = await self._agenerate(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_google_genai\chat_models.py", line 809, in _agenerate
    return _response_to_result(response)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_google_genai\chat_models.py", line 558, in _response_to_result
    generation_info["finish_reason"] = candidate.finish_reason.name
AttributeError: 'int' object has no attribute 'name'
