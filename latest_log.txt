### AI Lover Log - Last updated at 2025-09-26T00:09:37.388688 ###

2025-09-25 20:26:37 - [INFO] - [512280345618546699] [后台创世] 开场白发送完毕。
2025-09-25 20:26:37 - [INFO] - [512280345618546699] 后台创世流程结束，状态锁已释放。
2025-09-25 20:33:50 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-25 20:33:50 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-25 20:33:50 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-25 20:33:50 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-25 20:33:50 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-25 20:33:50 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-25 20:33:50 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-25 20:33:50 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-25 20:34:27 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #4.
2025-09-25 20:34:28 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-25 20:34:28 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-25 20:34:28 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-25 20:34:28 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-09-25 20:34:28 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-25 20:34:33 - [INFO] - [512280345618546699] [對話後 LORE 擴展] 正在啟動多層降級解析管線...
2025-09-25 20:34:33 - [INFO] - [512280345618546699] [LORE 解析 1/4] 正在嘗試【理想方案：原文宏觀解析】...
2025-09-25 20:34:36 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-09-25 20:34:36 - [INFO] - [512280345618546699] [LORE 解析 1/4] ✅ 成功！正在儲存結果...
2025-09-25 20:34:36 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 1 個實體...
2025-09-25 20:34:43 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #0.
2025-09-25 20:34:43 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 1 條決策。
2025-09-25 20:34:43 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'item_info' 類別處理 2 個實體...
2025-09-25 20:34:43 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 1 個實體...
2025-09-25 20:34:43 - [INFO] - [512280345618546699] [對話後 LORE 擴展] 管線成功完成。
2025-09-25 20:51:32 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-25 20:51:32 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-25 20:51:33 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-25 20:51:33 - [INFO] - Discord Bot is ready!
2025-09-25 20:51:35 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-25 20:51:35 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-25 20:51:36 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-25 20:52:21 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-25 20:52:21 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-25 20:52:21 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-25 20:52:21 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行全量創始構建...
2025-09-25 20:52:21 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 6 條文檔用於創始構建。
2025-09-25 20:52:21 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-25 20:52:21 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-25 20:52:21 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-25 20:52:21 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-25 20:52:21 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 3 條訊息。
2025-09-25 20:52:21 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-25 20:52:21 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-25 20:52:21 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-25 20:52:21 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-25 20:52:21 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-25 20:52:21 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-25 20:52:21 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-25 20:52:21 - [INFO] - [512280345618546699] (RAG Summarizer) 檢索到 6 份原始文檔，正在直接進行摘要...
2025-09-25 20:52:23 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-25 20:52:23 - [INFO] - [512280345618546699] 已成功將 RAG 原始上下文提煉為事實要點。
2025-09-25 20:52:23 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-25 20:52:55 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #1.
2025-09-25 20:52:55 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-25 20:52:56 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-25 20:52:56 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-25 20:52:56 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-09-25 20:52:56 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-25 20:53:01 - [INFO] - [512280345618546699] [對話後 LORE 擴展] 正在啟動多層降級解析管線...
2025-09-25 20:53:01 - [INFO] - [512280345618546699] [LORE 解析 1/4] 正在嘗試【理想方案：原文宏觀解析】...
2025-09-25 20:53:03 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-09-25 20:53:03 - [INFO] - [512280345618546699] [LORE 解析 1/4] ✅ 成功！正在儲存結果...
2025-09-25 20:53:03 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 1 個實體...
2025-09-25 20:53:14 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-25 20:53:14 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 1 條決策。
2025-09-25 20:53:14 - [INFO] - [512280345618546699] [LORE合併] 正在為 1 個NPC執行批量描述合成...
2025-09-25 20:53:25 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #4.
2025-09-25 20:53:25 - [INFO] - [512280345618546699] [LORE合併] 批量合成成功，收到 1 條新描述。
2025-09-25 20:53:26 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 1 個實體...
2025-09-25 20:53:26 - [INFO] - [512280345618546699] [對話後 LORE 擴展] 管線成功完成。
2025-09-25 20:56:40 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-25 20:56:40 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-25 20:56:41 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-25 20:56:41 - [INFO] - Discord Bot is ready!
2025-09-25 20:56:43 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-25 20:56:43 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-25 20:56:44 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-25 23:22:28 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-25 23:22:28 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-25 23:22:29 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-25 23:22:29 - [INFO] - Discord Bot is ready!
2025-09-25 23:22:32 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-25 23:22:32 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-25 23:22:32 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-25 23:22:47 - [ERROR] - 處理上傳的世界聖經檔案時發生錯誤: 'BotCog' object has no attribute 'setup_locks'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1647, in set_canon_file
    is_currently_in_setup = user_id in self.setup_locks
AttributeError: 'BotCog' object has no attribute 'setup_locks'
2025-09-25 23:30:08 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-25 23:30:08 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-25 23:30:08 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-25 23:30:08 - [INFO] - Discord Bot is ready!
2025-09-25 23:30:11 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-25 23:30:11 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-25 23:30:11 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-25 23:30:28 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-25 23:30:28 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-25 23:30:28 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-25 23:30:28 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 6 條文檔到 RAG 語料庫。
2025-09-25 23:30:28 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-25 23:30:28 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-25 23:30:28 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-25 23:30:28 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-25 23:30:28 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 5 條訊息。
2025-09-25 23:30:29 - [INFO] - [512280345618546699] (Canon Processor) 所有 32 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-25 23:30:29 - [INFO] - [512280345618546699] [創世 LORE 解析] 正在啟動多層降級解析管線...
2025-09-25 23:30:29 - [INFO] - [512280345618546699] [LORE 解析 1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-09-25 23:31:24 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-25 23:31:24 - [INFO] - [512280345618546699] [LORE 解析 1/5] ✅ 成功！正在儲存結果...
2025-09-25 23:31:24 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 36 個實體...
2025-09-25 23:31:34 - [WARNING] - [512280345618546699] Key #1 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.17 秒後進行第 2 次嘗試...
2025-09-25 23:31:36 - [WARNING] - [512280345618546699] Key #1 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.28 秒後進行第 3 次嘗試...
2025-09-25 23:31:38 - [ERROR] - [512280345618546699] Key #1 (模型: gemini-2.5-pro) 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-25 23:31:38 - [CRITICAL] - [512280345618546699] [持久化冷卻] API Key #1 (模型: gemini-2.5-pro) 已被置入冷卻狀態，持續 24 小時。
2025-09-25 23:33:47 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-09-25 23:33:47 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 36 條決策。
2025-09-25 23:33:52 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 7 個實體...
2025-09-25 23:33:52 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 21 個實體...
2025-09-25 23:33:54 - [INFO] - [512280345618546699] [創世 LORE 解析] 管線成功完成。正在觸發 RAG 全量重建...
2025-09-25 23:33:54 - [INFO] - [512280345618546699] (Retriever Builder) 強制重建觸發，正在從資料庫執行全量創始構建...
2025-09-25 23:33:54 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 104 條文檔用於創始構建。
2025-09-25 23:33:54 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-25 23:33:54 - [INFO] - [512280345618546699] [創世 LORE 解析] RAG 索引全量重建完成。
2025-09-25 23:37:45 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-25 23:37:45 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-25 23:37:45 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-25 23:37:45 - [INFO] - [512280345618546699] [導演視角] 檢測到描述性指令，視角從 'local' 切換到 'remote'。
2025-09-25 23:37:45 - [INFO] - [512280345618546699] [導演視角] 遠程觀察目標設定為: ['米婭在維利爾斯宅邸遇到維利爾斯勛爵']
2025-09-25 23:37:45 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-25 23:37:47 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-25 23:37:47 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-25 23:37:47 - [INFO] - [512280345618546699] (RAG Summarizer) 檢索到 15 份原始文檔，正在直接進行摘要...
2025-09-25 23:37:55 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #3.
2025-09-25 23:37:55 - [INFO] - [512280345618546699] 已成功將 RAG 原始上下文提煉為事實要點。
2025-09-25 23:37:55 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-25 23:37:57 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #4) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-25 23:37:57 - [ERROR] - 處理使用者 512280345618546699 的「生成即摘要」流程時發生異常: AILover._force_and_retry() takes 3 positional arguments but 4 were given
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 709, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1308, in on_message
    final_response, summary_data = await ai_instance.preprocess_and_generate(input_data)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2729, in preprocess_and_generate
    raw_dual_output = await self.ainvoke_with_rotation(full_prompt, retry_strategy='force', use_degradation=True)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 739, in ainvoke_with_rotation
    return await self._force_and_retry(full_prompt, output_schema, e)
TypeError: AILover._force_and_retry() takes 3 positional arguments but 4 were given
2025-09-25 23:40:44 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-25 23:40:44 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-25 23:40:44 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-25 23:40:44 - [INFO] - Discord Bot is ready!
2025-09-25 23:40:47 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-25 23:40:47 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-25 23:40:48 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-25 23:41:27 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-25 23:41:27 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-25 23:41:27 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-25 23:41:27 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 104 條文檔到 RAG 語料庫。
2025-09-25 23:41:27 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-25 23:41:27 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-25 23:41:27 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-25 23:41:27 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-25 23:41:27 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 5 條訊息。
2025-09-25 23:41:28 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-25 23:41:28 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-25 23:41:28 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'remote'
2025-09-25 23:41:28 - [INFO] - [512280345618546699] [導演視角] 無本地信號，視角保持在 'remote'。
2025-09-25 23:41:28 - [INFO] - [512280345618546699] [導演視角] 遠程觀察目標更新為: ['米婭在維利爾斯宅邸遇到維利爾斯勛爵']
2025-09-25 23:41:28 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-25 23:41:28 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-25 23:41:28 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-25 23:41:28 - [INFO] - [512280345618546699] (RAG Summarizer) 檢索到 15 份原始文檔，正在直接進行摘要...
2025-09-25 23:41:33 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-25 23:41:33 - [INFO] - [512280345618546699] 已成功將 RAG 原始上下文提煉為事實要點。
2025-09-25 23:41:33 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-25 23:41:33 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 85806 秒)。
2025-09-25 23:42:10 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-09-25 23:42:10 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-25 23:42:10 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-25 23:42:10 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-25 23:42:11 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-09-25 23:42:11 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-25 23:42:15 - [INFO] - [512280345618546699] [對話後 LORE 擴展] 正在啟動多層降級解析管線...
2025-09-25 23:42:15 - [INFO] - [512280345618546699] [LORE 解析 1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-09-25 23:42:19 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #3.
2025-09-25 23:42:19 - [INFO] - [512280345618546699] [LORE 解析 1/5] ✅ 成功！正在儲存結果...
2025-09-25 23:42:19 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 3 個實體...
2025-09-25 23:42:32 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #4.
2025-09-25 23:42:32 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 3 條決策。
2025-09-25 23:42:33 - [INFO] - [512280345618546699] [LORE合併] 正在為 3 個NPC執行批量描述合成...
2025-09-25 23:43:08 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #5.
2025-09-25 23:43:11 - [INFO] - [512280345618546699] [LORE合併] 批量合成成功，收到 3 條新描述。
2025-09-25 23:43:12 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-25 23:43:12 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 1 個實體...
2025-09-25 23:43:12 - [INFO] - [512280345618546699] [對話後 LORE 擴展] 管線成功完成。
2025-09-25 23:51:10 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-25 23:51:10 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-25 23:51:11 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-25 23:51:11 - [INFO] - Discord Bot is ready!
2025-09-25 23:51:14 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-25 23:51:14 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-25 23:51:15 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-25 23:51:31 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-25 23:51:31 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-25 23:51:31 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-25 23:51:31 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 104 條文檔到 RAG 語料庫。
2025-09-25 23:51:31 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-25 23:51:31 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-25 23:51:31 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-25 23:51:31 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-25 23:51:31 - [INFO] - [512280345618546699] 成功恢復了 2 個場景的對話歷史，總計 7 條訊息。
2025-09-25 23:51:31 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-25 23:51:31 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-25 23:51:31 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'remote'
2025-09-25 23:51:31 - [INFO] - [512280345618546699] [導演視角] 無本地信號，視角保持在 'remote'。
2025-09-25 23:51:31 - [INFO] - [512280345618546699] [導演視角] 遠程觀察目標更新為: ['卡蓮在維利爾斯宅邸遇到維利爾斯勛爵']
2025-09-25 23:51:31 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-25 23:51:32 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-25 23:51:32 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-25 23:51:32 - [INFO] - [512280345618546699] (RAG Summarizer) 檢索到 15 份原始文檔，正在直接進行摘要...
2025-09-25 23:51:36 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-25 23:51:36 - [INFO] - [512280345618546699] 已成功將 RAG 原始上下文提煉為事實要點。
2025-09-25 23:51:36 - [INFO] - [512280345618546699] [上下文篩選] 核心目標: ['DINO', '碧'], 背景角色: []
2025-09-25 23:51:36 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-25 23:51:36 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 85202 秒)。
2025-09-25 23:51:44 - [WARNING] - [512280345618546699] Key #2 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.27 秒後進行第 2 次嘗試...
2025-09-25 23:51:45 - [WARNING] - [512280345618546699] Key #2 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.21 秒後進行第 3 次嘗試...
2025-09-25 23:51:48 - [ERROR] - [512280345618546699] Key #2 (模型: gemini-2.5-pro) 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-25 23:51:48 - [CRITICAL] - [512280345618546699] [持久化冷卻] API Key #2 (模型: gemini-2.5-pro) 已被置入冷卻狀態，持續 24 小時。
2025-09-25 23:52:25 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-25 23:52:25 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-25 23:52:27 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-25 23:52:27 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-25 23:52:27 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-09-25 23:52:27 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-25 23:52:32 - [INFO] - [512280345618546699] [對話後 LORE 擴展] 正在啟動多層降級解析管線...
2025-09-25 23:52:32 - [INFO] - [512280345618546699] [LORE 解析 1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-09-25 23:52:36 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-25 23:52:36 - [INFO] - [512280345618546699] [LORE 解析 1/5] ✅ 成功！正在儲存結果...
2025-09-25 23:52:36 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 4 個實體...
2025-09-25 23:52:54 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #5.
2025-09-25 23:52:54 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 4 條決策。
2025-09-25 23:52:55 - [INFO] - [512280345618546699] [LORE合併] 正在為 4 個NPC執行批量描述合成...
2025-09-25 23:53:25 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #0.
2025-09-25 23:53:25 - [INFO] - [512280345618546699] [LORE合併] 批量合成成功，收到 4 條新描述。
2025-09-25 23:53:26 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-25 23:53:26 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'item_info' 類別處理 1 個實體...
2025-09-25 23:53:26 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'quest' 類別處理 1 個實體...
2025-09-25 23:53:26 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-25 23:53:26 - [INFO] - [512280345618546699] [對話後 LORE 擴展] 管線成功完成。
2025-09-26 00:04:54 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 00:04:54 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 00:04:55 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 00:04:55 - [INFO] - Discord Bot is ready!
2025-09-26 00:04:57 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 00:04:57 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 00:04:58 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 00:05:27 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-26 00:05:27 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-26 00:05:27 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-26 00:05:27 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 104 條文檔到 RAG 語料庫。
2025-09-26 00:05:27 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-26 00:05:27 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-26 00:05:27 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-26 00:05:27 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-26 00:05:27 - [INFO] - [512280345618546699] 成功恢復了 3 個場景的對話歷史，總計 9 條訊息。
2025-09-26 00:05:27 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-26 00:05:27 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-26 00:05:27 - [INFO] - [512280345618546699] [指令實體提取] 通過 LORE 字典找到實體: {'維利爾斯宅邸', '諾拉'}
2025-09-26 00:05:27 - [INFO] - [512280345618546699] [LORE注入] 正在為指令中提及的 ['維利爾斯宅邸', '諾拉'] 強制查找LORE檔案...
2025-09-26 00:05:27 - [ERROR] - 處理使用者 512280345618546699 的「生成即摘要」流程時發生異常: 1 validation error for CharacterProfile
name
  Field required [type=missing, input_value={'title': '碧的順從..., 'template_keys': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1308, in on_message
    final_response, summary_data = await ai_instance.preprocess_and_generate(input_data)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2562, in preprocess_and_generate
    profile = CharacterProfile.model_validate(lore.content)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for CharacterProfile
name
  Field required [type=missing, input_value={'title': '碧的順從..., 'template_keys': None}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-26 00:09:23 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 00:09:23 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 00:09:23 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 00:09:23 - [INFO] - Discord Bot is ready!
2025-09-26 00:09:26 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 00:09:26 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 00:09:27 - [INFO] - 已成功發送啟動成功通知給管理員。
