### AI Lover Log - Last updated at 2025-10-03T15:57:13.583186 ###

name
  Field required [type=missing, input_value={'title': '城鎮區與...的分裂與混亂。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
2025-10-03 07:36:23 - [WARNING] - [512280345618546699] [LORE精煉-L3] L1和L2均失敗。啟動雲端『分治法』數據搶救...
2025-10-03 07:36:23 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-03 07:36:23 - [WARNING] - [512280345618546699] 內部鏈意外遭遇審查。啟動【通用化解構-重構】策略...
2025-10-03 07:36:23 - [ERROR] - [512280345618546699] (Euphemizer) 在失敗的 Prompt 中找不到任何可供消毒的已知內容標記，無法執行委婉化。
2025-10-03 07:36:26 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-10-03 07:36:26 - [INFO] - [512280345618546699] [LORE精煉-L3] ✅ 成功搶救 'description' 數據。
2025-10-03 07:36:26 - [INFO] - [512280345618546699] [單體精煉] ✅ 驗證通過，成功為角色 '米婭' 生成精煉檔案。
2025-10-03 07:36:27 - [INFO] - [512280345618546699] [LORE精煉-背景] ✅ 已成功在後台精煉並更新角色 '米婭' 的檔案。
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [單體精煉 v11.0] 正在為角色 '卡爾•維利爾斯勳爵' 啟動三層降級精煉流程...
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19193
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19193
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19055
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19233
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19096
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [LORE精煉-L1] 正在嘗試使用雲端模型 (gemini-2.5-flash-lite) 進行完整精煉...
2025-10-03 07:36:34 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-10-03 07:36:34 - [INFO] - [512280345618546699] [單體精煉] ✅ 驗證通過，成功為角色 '卡爾•維利爾斯勳爵' 生成精煉檔案。
2025-10-03 07:36:34 - [INFO] - [512280345618546699] [LORE精煉-背景] ✅ 已成功在後台精煉並更新角色 '卡爾•維利爾斯勳爵' 的檔案。
2025-10-03 07:36:36 - [INFO] - [512280345618546699] [LORE精煉 v7.1] 所有 2 個背景精煉任務已全部完成。
2025-10-03 09:11:57 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 09:11:57 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 09:11:57 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 09:11:57 - [INFO] - Discord Bot is ready!
2025-10-03 09:12:00 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 09:12:00 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 09:12:00 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 09:12:32 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 09:12:32 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 09:12:32 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 09:12:32 - [INFO] - Discord Bot is ready!
2025-10-03 09:12:35 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 09:12:35 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 09:12:36 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 11:50:19 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 11:50:19 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 11:50:20 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 11:50:20 - [INFO] - Discord Bot is ready!
2025-10-03 11:50:22 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 11:50:22 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 11:50:23 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 12:31:26 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 12:31:26 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 12:31:26 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 12:31:26 - [INFO] - Discord Bot is ready!
2025-10-03 12:31:29 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 12:31:29 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 12:31:29 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 13:56:05 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-03 13:56:05 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-03 13:56:05 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-03 13:56:07 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-03 13:56:07 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-03 13:56:07 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-03 13:56:08 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-03 13:56:13 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-03 13:56:14 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-03 13:56:14 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-03 13:56:14 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-03 13:56:14 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-03 13:56:14 - [INFO] - [512280345618546699] 正在創建本地 Embedding 模型 'infgrad/stella-base-zh-v2' 實例...
2025-10-03 13:56:28 - [INFO] - [512280345618546699] ✅ 本地 Embedding 模型實例創建成功。
2025-10-03 13:56:28 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-03 13:56:28 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-03 13:56:28 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-03 13:56:28 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:56:30 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-03 13:56:40 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-03 13:56:40 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-03 13:56:41 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:56:42 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-03 13:56:52 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-10-03 13:56:52 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-10-03 13:56:52 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:56:54 - [INFO] - [512280345618546699] [創世流程] 檔案上傳開始，已設定 active_setups 狀態鎖。
2025-10-03 13:57:03 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-03 13:57:05 - [INFO] - [512280345618546699] [創世流程 v63.0] 純向量RAG簡化版流程已啟動。
2025-10-03 13:57:05 - [INFO] - [512280345618546699] [後台創世 1/4] 正在補完角色檔案...
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-03 13:57:08 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-10-03 13:57:08 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [後台創世 2/4] 正在將世界聖經原文分割成文檔...
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [後台創世 2/4] 世界聖經已分割為 34 個文檔。
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [後台創世 3/4] 正在觸發 RAG 索引純向量創始構建...
2025-10-03 13:57:08 - [INFO] - [512280345618546699] (Retriever Builder) 進入外部文檔注入模式，將使用 34 條傳入文檔構建純向量索引...
2025-10-03 13:57:47 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 純向量檢索器已成功從外部文檔構建。
2025-10-03 13:57:47 - [INFO] - [512280345618546699] [後台創世 3/4] 純向量 RAG 索引構建完成。
2025-10-03 13:57:47 - [INFO] - [512280345618546699] [後台創世 4/4] 正在生成 RAG 驅動的智能開場白...
2025-10-03 13:57:47 - [INFO] - [512280345618546699] [/start] 正在使用 RAG 智能選擇開場場景...
2025-10-03 13:57:47 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 13:57:47 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 13:57:47 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 13:57:47 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 13:57:47 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 13:57:47 - [INFO] -   [最終 summary_context 長度]: 19014
2025-10-03 13:57:47 - [INFO] - --- RAG 流程結束 ---
2025-10-03 13:58:19 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-10-03 13:58:19 - [INFO] - [512280345618546699] [後台創世 4/4] 開場白生成完畢。
2025-10-03 13:58:19 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-10-03 13:58:19 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:58:19 - [INFO] - [512280345618546699] [後台創世] 正在向使用者私訊發送最終開場白...
2025-10-03 13:58:20 - [INFO] - [512280345618546699] [後台創世] 開場白發送完畢。
2025-10-03 13:58:20 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-03 13:59:03 - [INFO] - [512280345618546699] 啟動 Graph-based 對話流程...
2025-10-03 13:59:03 - [ERROR] - 處理使用者 512280345618546699 的 Graph 流程時發生異常: 'AILoverBot' object has no attribute 'main_graph'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1361, in on_message
    if not self.bot.main_graph:
AttributeError: 'AILoverBot' object has no attribute 'main_graph'
2025-10-03 15:29:34 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 15:29:34 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 15:29:34 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 15:29:34 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 15:29:34 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 15:29:34 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 15:29:35 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 15:29:35 - [INFO] - Discord Bot is ready!
2025-10-03 15:29:37 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 15:29:37 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 15:29:38 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 15:35:19 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 15:35:19 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 15:35:19 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 15:35:19 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 15:35:19 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 15:35:19 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 15:35:19 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 15:35:19 - [INFO] - Discord Bot is ready!
2025-10-03 15:35:22 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 15:35:22 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 15:35:23 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 15:37:48 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-03 15:37:48 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-10-03 15:37:48 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-03 15:37:48 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-03 15:37:48 - [INFO] - [512280345618546699] 正在創建本地 Embedding 模型 'infgrad/stella-base-zh-v2' 實例...
2025-10-03 15:37:53 - [INFO] - [512280345618546699] ✅ 本地 Embedding 模型實例創建成功。
2025-10-03 15:37:53 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-03 15:37:53 - [INFO] - [512280345618546699] (Retriever Builder) 檢測到現有 RAG 索引，正在加載...
2025-10-03 15:37:53 - [WARNING] - [512280345618546699] (Retriever Builder) BM25 持久化檔案不存在或加載失敗，將從 ChromaDB 中恢復 BM25 專用語料庫。
2025-10-03 15:37:53 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 混合檢索器已成功從持久化索引加載。
2025-10-03 15:37:53 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-10-03 15:37:53 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-10-03 15:37:54 - [INFO] - [512280345618546699] 啟動 Graph-based 對話流程...
2025-10-03 15:37:54 - [INFO] - [512280345618546699] (Graph|1) Node: perceive_scene -> 正在感知场景与恢复上下文...
2025-10-03 15:37:54 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-03 15:37:54 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇解析或驗證錯誤: ValidationError。
2025-10-03 15:37:54 - [WARNING] - [512280345618546699] (Graph|1) 地點推斷鏈失敗: 1 validation error for SceneLocationExtraction
has_explicit_location
  Field required [type=missing, input_value={'location_path': ['宅邸']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing，將回退到基本邏輯。
2025-10-03 15:37:54 - [INFO] - [512280345618546699] (Graph|2) Node: retrieve_and_query -> 正在檢索記憶與查詢LORE...
2025-10-03 15:37:56 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-10-03 15:37:56 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇解析或驗證錯誤: OutputParserException。
2025-10-03 15:37:56 - [WARNING] - [512280345618546699] (Graph|2) 源頭清洗失敗，將使用原始輸入進行查詢。
2025-10-03 15:37:57 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 21 條文檔 ---
2025-10-03 15:37:57 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 21 條原始文檔 ---
2025-10-03 15:37:57 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 21 條原始文檔作為 summary_context。
2025-10-03 15:37:57 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 15:37:57 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 15:37:57 - [INFO] -   [最終 summary_context 長度]: 20025
2025-10-03 15:37:57 - [INFO] - --- RAG 流程結束 ---
2025-10-03 15:37:57 - [ERROR] - 處理使用者 512280345618546699 的 Graph 流程時發生異常: 'AILover' object has no attribute '_query_lore_from_entities'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1368, in on_message
    final_state = await self.bot.main_graph.ainvoke(initial_state)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langgraph\pregel\main.py", line 3088, in ainvoke
    async for chunk in self.astream(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langgraph\pregel\main.py", line 2926, in astream
    async for _ in runner.atick(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langgraph\pregel\_runner.py", line 295, in atick
    await arun_with_retry(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langgraph\pregel\_retry.py", line 137, in arun_with_retry
    return await task.proc.ainvoke(task.input, config)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langgraph\_internal\_runnable.py", line 693, in ainvoke
    input = await step.ainvoke(input, config, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langgraph\_internal\_runnable.py", line 457, in ainvoke
    ret = await self.afunc(*args, **kwargs)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\graph.py", line 171, in retrieve_and_query_node
    final_lores = await ai_core._query_lore_from_entities(sanitized_query, is_remote_scene=is_remote)
AttributeError: 'AILover' object has no attribute '_query_lore_from_entities'
2025-10-03 15:46:10 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 15:46:10 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 15:46:10 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 15:46:10 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 15:46:10 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 15:46:10 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 15:46:10 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 15:46:10 - [INFO] - Discord Bot is ready!
2025-10-03 15:46:14 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 15:46:14 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 15:46:16 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 15:51:56 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 15:51:56 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 15:51:56 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 15:51:56 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 15:51:56 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 15:51:56 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 15:51:56 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 15:51:56 - [INFO] - Discord Bot is ready!
2025-10-03 15:51:59 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 15:51:59 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 15:52:02 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 15:53:47 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-03 15:53:47 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-03 15:53:47 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-03 15:53:49 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-03 15:53:49 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-03 15:53:49 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-03 15:53:51 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-03 15:53:58 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-03 15:53:58 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-03 15:53:58 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-03 15:53:58 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-03 15:53:58 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-03 15:53:58 - [INFO] - [512280345618546699] 正在創建本地 Embedding 模型 'infgrad/stella-base-zh-v2' 實例...
2025-10-03 15:54:02 - [INFO] - [512280345618546699] ✅ 本地 Embedding 模型實例創建成功。
2025-10-03 15:54:02 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-03 15:54:02 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-03 15:54:02 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-03 15:54:02 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 15:54:04 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-03 15:54:14 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-03 15:54:14 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-03 15:54:14 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 15:54:15 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-03 15:54:25 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-10-03 15:54:26 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-10-03 15:54:26 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 15:54:27 - [INFO] - [512280345618546699] [創世流程] 檔案上傳開始，已設定 active_setups 狀態鎖。
2025-10-03 15:54:37 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-03 15:54:39 - [INFO] - [512280345618546699] [創世流程 v64.0] Graph 驅動的流程已啟動。
2025-10-03 15:54:39 - [INFO] - [512280345618546699] [後台創世] 正在將世界聖經原文分割成文檔...
2025-10-03 15:54:39 - [INFO] - [512280345618546699] [後台創世] 正在觸發 RAG 索引創始構建...
2025-10-03 15:54:39 - [INFO] - [512280345618546699] (Retriever Builder) 進入外部文檔注入模式，將使用 34 條傳入文檔構建純向量索引...
2025-10-03 15:55:18 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 純向量檢索器已成功從外部文檔構建。
2025-10-03 15:55:18 - [INFO] - [512280345618546699] [後台創世] RAG 索引構建完成，準備執行創世圖...
2025-10-03 15:55:18 - [INFO] - [512280345618546699] (Setup Graph|1/4) Node: process_canon -> 節點已啟動。
2025-10-03 15:55:18 - [INFO] - [512280345618546699] (Setup Graph|1/4) 檢測到世界聖經文本 (長度: 27258)，開始處理...
2025-10-03 15:55:18 - [INFO] - [512280345618546699] [數據入口-軌道B] 正在啟動 LORE 解析管線...
2025-10-03 15:55:18 - [INFO] - [512280345618546699] [LORE 解析] 已將世界聖經原文分割成 8 個文本塊進行處理。
2025-10-03 15:55:18 - [INFO] - [512280345618546699] [LORE 解析] 正在處理文本塊 1/8...
2025-10-03 15:55:18 - [INFO] - [512280345618546699] [LORE 解析 1-1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-10-03 15:55:33 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-03 15:55:33 - [INFO] - [512280345618546699] [LORE 解析 1-1/5] ✅ 成功！
2025-10-03 15:55:33 - [INFO] - [512280345618546699] [LORE 解析] 正在處理文本塊 2/8...
2025-10-03 15:55:33 - [INFO] - [512280345618546699] [LORE 解析 2-1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-10-03 15:55:54 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-10-03 15:55:54 - [INFO] - [512280345618546699] [LORE 解析 2-1/5] ✅ 成功！
2025-10-03 15:55:54 - [INFO] - [512280345618546699] [LORE 解析] 正在處理文本塊 3/8...
2025-10-03 15:55:54 - [INFO] - [512280345618546699] [LORE 解析 3-1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-10-03 15:56:07 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-10-03 15:56:07 - [INFO] - [512280345618546699] [LORE 解析 3-1/5] ✅ 成功！
2025-10-03 15:56:07 - [INFO] - [512280345618546699] [LORE 解析] 正在處理文本塊 4/8...
2025-10-03 15:56:07 - [INFO] - [512280345618546699] [LORE 解析 4-1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-10-03 15:56:26 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #3.
2025-10-03 15:56:26 - [INFO] - [512280345618546699] [LORE 解析 4-1/5] ✅ 成功！
2025-10-03 15:56:26 - [INFO] - [512280345618546699] [LORE 解析] 正在處理文本塊 5/8...
2025-10-03 15:56:26 - [INFO] - [512280345618546699] [LORE 解析 5-1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-10-03 15:56:41 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-10-03 15:56:41 - [INFO] - [512280345618546699] [LORE 解析 5-1/5] ✅ 成功！
2025-10-03 15:56:41 - [INFO] - [512280345618546699] [LORE 解析] 正在處理文本塊 6/8...
2025-10-03 15:56:41 - [INFO] - [512280345618546699] [LORE 解析 6-1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-10-03 15:56:59 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-10-03 15:56:59 - [INFO] - [512280345618546699] [LORE 解析 6-1/5] ✅ 成功！
2025-10-03 15:56:59 - [INFO] - [512280345618546699] [LORE 解析] 正在處理文本塊 7/8...
2025-10-03 15:56:59 - [INFO] - [512280345618546699] [LORE 解析 7-1/5] 正在嘗試【理想方案：雲端宏觀解析】...
