### AI Lover Log - Last updated at 2025-09-23T22:35:45.403467 ###

2025-09-23 21:49:57 - [INFO] - [512280345618546699] 正在處理文本塊 5/7...
2025-09-23 21:50:17 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 21:50:17 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 3 個實體...
2025-09-23 21:50:17 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 13 個實體...
2025-09-23 21:50:19 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '克拉拉' (Key: 聖凱瑟琳學院 > 克拉拉)。正在合併信息...
2025-09-23 21:50:20 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '高爾' (Key: 聖凱瑟琳學院 > 高爾)。正在合併信息...
2025-09-23 21:50:22 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '翠絲' (Key: 聖凱瑟琳學院 > 翠絲)。正在合併信息...
2025-09-23 21:50:23 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '迪茜' (Key: 聖凱瑟琳學院 > 迪茜)。正在合併信息...
2025-09-23 21:50:24 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '亞瑟' (Key: 聖凱瑟琳學院 > 亞瑟)。正在合併信息...
2025-09-23 21:50:25 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '馬丁' (Key: 聖凱瑟琳學院 > 馬丁)。正在合併信息...
2025-09-23 21:50:26 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '費奇' (Key: 城鎮市集區 > 費奇)。正在合併信息...
2025-09-23 21:50:27 - [INFO] - [512280345618546699] 文本塊 5 的 LORE 已成功儲存。
2025-09-23 21:50:27 - [INFO] - [512280345618546699] 正在處理文本塊 6/7...
2025-09-23 21:50:27 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #4) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 21:50:27 - [WARNING] - [512280345618546699] 文本塊 6 遭遇內容審查 (BlockedPromptException)。啟動【終極解構-重構】策略...
2025-09-23 21:50:28 - [INFO] - [512280345618546699] [解構成功] 已提取情報關鍵詞: ['米婭', '瑪倫', '卡蓮', '凱爾', '費奇', '湯瑪斯', '馬克', '瓦勒留斯', '里斯', '艾拉', '莉莉絲', '湯姆', 'ROLE-D', '老高', '愛蓮娜', 'ACTION-E', '老羅']
2025-09-23 21:50:35 - [WARNING] - [512280345618546699] Key #5 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.17 秒後進行第 2 次嘗試...
2025-09-23 21:50:36 - [WARNING] - [512280345618546699] Key #5 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.49 秒後進行第 3 次嘗試...
2025-09-23 21:50:39 - [ERROR] - [512280345618546699] Key #5 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 21:50:47 - [WARNING] - [512280345618546699] Key #0 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.42 秒後進行第 2 次嘗試...
2025-09-23 21:50:49 - [WARNING] - [512280345618546699] Key #0 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.15 秒後進行第 3 次嘗試...
2025-09-23 21:50:52 - [ERROR] - [512280345618546699] Key #0 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 21:51:00 - [WARNING] - [512280345618546699] Key #1 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.34 秒後進行第 2 次嘗試...
2025-09-23 21:51:08 - [WARNING] - [512280345618546699] Key #1 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.35 秒後進行第 3 次嘗試...
2025-09-23 21:51:10 - [ERROR] - [512280345618546699] Key #1 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 21:52:13 - [WARNING] - [512280345618546699] Key #2 遭遇臨時性 API 錯誤 (InternalServerError)。將在 1.16 秒後進行第 2 次嘗試...
2025-09-23 21:52:15 - [WARNING] - [512280345618546699] Key #2 遭遇臨時性 API 錯誤 (InternalServerError)。將在 2.13 秒後進行第 3 次嘗試...
2025-09-23 21:52:17 - [ERROR] - [512280345618546699] Key #2 在 3 次內部重試後仍然失敗 (InternalServerError)。將輪換到下一個金鑰。
2025-09-23 21:52:20 - [WARNING] - [512280345618546699] Key #3 遭遇臨時性 API 錯誤 (InternalServerError)。將在 1.41 秒後進行第 2 次嘗試...
2025-09-23 21:52:24 - [WARNING] - [512280345618546699] Key #3 遭遇臨時性 API 錯誤 (InternalServerError)。將在 2.12 秒後進行第 3 次嘗試...
2025-09-23 21:52:29 - [ERROR] - [512280345618546699] Key #3 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 21:53:36 - [INFO] - [512280345618546699] [重構成功] 已成功根據關鍵詞還原出 LORE。
2025-09-23 21:53:36 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 15 個實體...
2025-09-23 21:53:36 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 21:53:36 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '米婭' (Key: 米婭)。正在合併信息...
2025-09-23 21:53:38 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '瑪倫' (Key: 貧民窟 > 瑪倫)。正在合併信息...
2025-09-23 21:53:39 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '卡蓮' (Key: 貧民窟 > 聖露修道院 > 卡蓮)。正在合併信息...
2025-09-23 21:53:40 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '凱爾' (Key: 貧民窟 > 聖露修道院 > 凱爾)。正在合併信息...
2025-09-23 21:53:41 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '費奇' (Key: 城鎮市集區 > 費奇)。正在合併信息...
2025-09-23 21:53:42 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '湯瑪斯' (Key: 城鎮市集區 > 湯瑪斯)。正在合併信息...
2025-09-23 21:53:43 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '馬克' (Key: 城鎮市集區 > 馬克)。正在合併信息...
2025-09-23 21:53:44 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '瓦勒留斯' (Key: 聖光明教會 > 貧民窟 > 瓦勒留斯)。正在合併信息...
2025-09-23 21:53:45 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '里斯' (Key: 貧民窟 > 里斯)。正在合併信息...
2025-09-23 21:53:46 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '艾拉' (Key: 貧民窟 > 聖露修道院 > 艾拉)。正在合併信息...
2025-09-23 21:53:47 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '莉莉絲' (Key: 聖凱瑟琳學院 > 莉莉絲)。正在合併信息...
2025-09-23 21:53:48 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #3) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 21:53:48 - [ERROR] - [512280345618546699] (_resolve_and_save) 在儲存 '莉莉絲' 到 LORE 時發生錯誤: Prompt blocked due to PROHIBITED_CONTENT
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 888, in _resolve_and_save
    synthesized_description = await self.ainvoke_with_rotation(synthesis_prompt, retry_strategy='none')
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 351, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 323, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
2025-09-23 21:53:48 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '湯姆' (Key: 貧民窟 > 湯姆)。正在合併信息...
2025-09-23 21:53:49 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '老高' (Key: 維利爾斯莊園 > 聖凱瑟琳學院 > 老高)。正在合併信息...
2025-09-23 21:53:50 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '愛蓮娜' (Key: 城鎮市集區 > 愛蓮娜)。正在合併信息...
2025-09-23 21:53:51 - [INFO] - [512280345618546699] [LORE合併] 檢測到已存在的NPC '老羅' (Key: 城鎮市集區 > 老羅)。正在合併信息...
2025-09-23 21:53:52 - [INFO] - [512280345618546699] 文本塊 6 的 LORE 已成功儲存。
2025-09-23 21:53:52 - [INFO] - [512280345618546699] 正在處理文本塊 7/7...
2025-09-23 21:53:53 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #2) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 21:53:53 - [WARNING] - [512280345618546699] 文本塊 7 遭遇內容審查 (BlockedPromptException)。啟動【終極解構-重構】策略...
2025-09-23 21:53:53 - [INFO] - [512280345618546699] [解構成功] 已提取情報關鍵詞: ['STATE-A', '米婭', 'ROLE-D', 'ACTION-B', 'CODE-F-GEN-A', '艾莉諾', '卡蓮', '菲利普', 'ACTION-E', '薩格納', '瓦勒留斯', 'CODE-M-GEN-A']
2025-09-23 21:53:55 - [WARNING] - [512280345618546699] Key #3 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.21 秒後進行第 2 次嘗試...
2025-09-23 21:53:57 - [WARNING] - [512280345618546699] Key #3 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.32 秒後進行第 3 次嘗試...
2025-09-23 21:53:59 - [ERROR] - [512280345618546699] Key #3 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 21:54:22 - [WARNING] - [512280345618546699] Key #4 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.22 秒後進行第 2 次嘗試...
2025-09-23 21:54:23 - [WARNING] - [512280345618546699] Key #4 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.42 秒後進行第 3 次嘗試...
2025-09-23 21:54:26 - [ERROR] - [512280345618546699] Key #4 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:03:49 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 22:03:49 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 22:03:50 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 22:03:50 - [INFO] - Discord Bot is ready!
2025-09-23 22:03:52 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 22:03:52 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 22:03:53 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 22:04:00 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-23 22:04:00 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 22:04:00 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 22:04:00 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 22:04:00 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 112 條文檔用於構建 BM25。
2025-09-23 22:04:00 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 22:04:00 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 22:04:00 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 22:04:00 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 22:04:00 - [INFO] - [512280345618546699] 資料庫中沒有找到歷史場景記憶。
2025-09-23 22:04:00 - [INFO] - [512280345618546699] 正在關閉 AI 實例並釋放資源...
2025-09-23 22:04:01 - [INFO] - [512280345618546699] AI 實例資源已釋放。
2025-09-23 22:04:02 - [INFO] - [512280345618546699] 正在清除所有短期場景記憶...
2025-09-23 22:04:02 - [INFO] - [512280345618546699] 已成功從資料庫中刪除 0 條場景歷史記錄。
2025-09-23 22:04:04 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-09-23 22:04:08 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-09-23 22:04:09 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 22:04:09 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-09-23 22:04:09 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 22:04:09 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 22:04:09 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 0 條文檔用於構建 BM25。
2025-09-23 22:04:09 - [INFO] - [512280345618546699] (Retriever Builder) 知識庫為空，BM25 檢索器為空。
2025-09-23 22:04:09 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 22:04:09 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-09-23 22:04:09 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-09-23 22:04:09 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:04:11 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-09-23 22:04:20 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-09-23 22:04:20 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-09-23 22:04:20 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:04:21 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-09-23 22:04:34 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-09-23 22:04:35 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-09-23 22:04:35 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:04:37 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToCanonSetupView' finalize button clicked.
2025-09-23 22:04:38 - [INFO] - [512280345618546699] (UI Event) finalize_setup 被觸發。Canon provided: False
2025-09-23 22:04:38 - [INFO] - [512280345618546699] [/start 流程 1/4] 正在處理世界聖經...
2025-09-23 22:04:38 - [INFO] - [512280345618546699] [/start] 未提供世界聖經文本，跳過處理。
2025-09-23 22:04:40 - [INFO] - [512280345618546699] [/start 流程 2/4] 正在補完角色檔案...
2025-09-23 22:04:43 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-09-23 22:04:44 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:04:46 - [INFO] - [512280345618546699] [/start 流程 3/4] 正在生成世界創世資訊...
2025-09-23 22:04:49 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 22:04:49 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:04:49 - [INFO] - [512280345618546699] [/start] 初始地點 '艾瑞亞大陸 > 寂靜之森 > 月光溪谷的隱士小屋' 已成功生成並存入LORE。
2025-09-23 22:04:51 - [INFO] - [512280345618546699] [/start 流程 4/4] 正在生成開場白...
2025-09-23 22:04:52 - [WARNING] - [512280345618546699] Key #3 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.50 秒後進行第 2 次嘗試...
2025-09-23 22:04:54 - [WARNING] - [512280345618546699] Key #3 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.24 秒後進行第 3 次嘗試...
2025-09-23 22:04:56 - [ERROR] - [512280345618546699] Key #3 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:05:05 - [WARNING] - [512280345618546699] Key #4 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.30 秒後進行第 2 次嘗試...
2025-09-23 22:05:07 - [WARNING] - [512280345618546699] Key #4 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.47 秒後進行第 3 次嘗試...
2025-09-23 22:05:09 - [ERROR] - [512280345618546699] Key #4 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:05:18 - [WARNING] - [512280345618546699] Key #5 遭遇臨時性 API 錯誤 (InternalServerError)。將在 1.36 秒後進行第 2 次嘗試...
2025-09-23 22:05:20 - [WARNING] - [512280345618546699] Key #5 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.46 秒後進行第 3 次嘗試...
2025-09-23 22:05:22 - [ERROR] - [512280345618546699] Key #5 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:05:40 - [WARNING] - [512280345618546699] Key #0 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.32 秒後進行第 2 次嘗試...
2025-09-23 22:05:49 - [WARNING] - [512280345618546699] Key #0 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.45 秒後進行第 3 次嘗試...
2025-09-23 22:05:52 - [ERROR] - [512280345618546699] Key #0 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:05:57 - [WARNING] - [512280345618546699] Key #1 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.46 秒後進行第 2 次嘗試...
2025-09-23 22:05:59 - [WARNING] - [512280345618546699] Key #1 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.35 秒後進行第 3 次嘗試...
2025-09-23 22:06:01 - [ERROR] - [512280345618546699] Key #1 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:06:10 - [WARNING] - [512280345618546699] Key #2 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.45 秒後進行第 2 次嘗試...
2025-09-23 22:06:12 - [WARNING] - [512280345618546699] Key #2 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.28 秒後進行第 3 次嘗試...
2025-09-23 22:06:14 - [ERROR] - [512280345618546699] Key #2 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:06:14 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-23 22:06:35 - [INFO] - [512280345618546699] [/start 流程 4/4] 開場白生成完畢。
2025-09-23 22:06:35 - [INFO] - [512280345618546699] 開場白已成功作為第一條AI訊息存入場景 '512280345618546699_local_艾瑞亞大陸_寂靜之森_月光溪谷的隱士小屋' 的歷史記錄並持久化。
2025-09-23 22:06:35 - [INFO] - [512280345618546699] /start 流程：正在向使用者私訊發送開場白...
2025-09-23 22:06:36 - [INFO] - [512280345618546699] /start 流程：開場白發送完畢。設定流程成功結束。
2025-09-23 22:07:14 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-23 22:07:14 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-23 22:07:14 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-23 22:07:14 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-23 22:07:14 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 22:07:14 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:07:14 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-23 22:07:14 - [INFO] - [512280345618546699] (RAG Executor) [備援觸發] 正在啟動備援記憶系統 (BM25)...
2025-09-23 22:07:14 - [INFO] - [512280345618546699] (RAG Executor) [備援成功] 備援記憶系統 (BM25) 檢索成功。
2025-09-23 22:07:14 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-23 22:07:16 - [WARNING] - [512280345618546699] Key #4 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.26 秒後進行第 2 次嘗試...
2025-09-23 22:07:18 - [WARNING] - [512280345618546699] Key #4 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.45 秒後進行第 3 次嘗試...
2025-09-23 22:07:20 - [ERROR] - [512280345618546699] Key #4 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:07:30 - [WARNING] - [512280345618546699] Key #5 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.45 秒後進行第 2 次嘗試...
2025-09-23 22:07:32 - [WARNING] - [512280345618546699] Key #5 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.15 秒後進行第 3 次嘗試...
2025-09-23 22:07:34 - [ERROR] - [512280345618546699] Key #5 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:07:42 - [WARNING] - [512280345618546699] Key #0 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.24 秒後進行第 2 次嘗試...
2025-09-23 22:07:45 - [WARNING] - [512280345618546699] Key #0 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.15 秒後進行第 3 次嘗試...
2025-09-23 22:07:47 - [ERROR] - [512280345618546699] Key #0 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:07:50 - [WARNING] - [512280345618546699] Key #1 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.29 秒後進行第 2 次嘗試...
2025-09-23 22:07:52 - [WARNING] - [512280345618546699] Key #1 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.13 秒後進行第 3 次嘗試...
2025-09-23 22:07:55 - [ERROR] - [512280345618546699] Key #1 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:07:55 - [WARNING] - [512280345618546699] Key #2 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.46 秒後進行第 2 次嘗試...
2025-09-23 22:07:57 - [WARNING] - [512280345618546699] Key #2 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.32 秒後進行第 3 次嘗試...
2025-09-23 22:08:00 - [ERROR] - [512280345618546699] Key #2 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:08:00 - [WARNING] - [512280345618546699] Key #3 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.42 秒後進行第 2 次嘗試...
2025-09-23 22:08:02 - [WARNING] - [512280345618546699] Key #3 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.16 秒後進行第 3 次嘗試...
2025-09-23 22:08:04 - [ERROR] - [512280345618546699] Key #3 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰。
2025-09-23 22:08:04 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-23 22:08:14 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-23 22:08:14 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-23 22:08:19 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-23 22:08:19 - [ERROR] - [512280345618546699] [事後處理-LORE保險] 背景LORE提取與擴展任務執行時發生未預期的異常: 'AILover' object has no attribute 'get_lore_extraction_chain'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 620, in _background_lore_extraction
    prompt_template = self.get_lore_extraction_chain()
AttributeError: 'AILover' object has no attribute 'get_lore_extraction_chain'. Did you mean: 'lore_extraction_chain'?
2025-09-23 22:13:04 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 22:13:04 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 22:13:05 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 22:13:05 - [INFO] - Discord Bot is ready!
2025-09-23 22:13:07 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 22:13:07 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 22:13:08 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 22:23:18 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 22:23:18 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 22:23:18 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 22:23:18 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 1 條文檔用於構建 BM25。
2025-09-23 22:23:18 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 22:23:18 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 22:23:18 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 22:23:18 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 22:23:18 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 3 條訊息。
2025-09-23 22:23:32 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['response_style_prompt']
2025-09-23 22:23:33 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:23:40 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-23 22:23:40 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-23 22:23:40 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-23 22:23:40 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-23 22:23:40 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 22:23:40 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:23:40 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-23 22:23:40 - [INFO] - [512280345618546699] (RAG Cache) 檢索到 1 份文檔，正在檢查淨化快取...
2025-09-23 22:23:40 - [WARNING] - [512280345618546699] (RAG Sanitizer) 所有檢索到的文檔都未能成功淨化。
2025-09-23 22:23:40 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-23 22:23:40 - [ERROR] - 處理使用者 512280345618546699 的「生成即摘要」流程時發生異常: AILover._get_next_available_key() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1073, in on_message
    final_response, summary_data = await ai_instance.preprocess_and_generate(input_data)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1955, in preprocess_and_generate
    raw_dual_output = await self.ainvoke_with_rotation(full_prompt, retry_strategy='force', use_degradation=True)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 358, in ainvoke_with_rotation
    key_info = self._get_next_available_key(model_name)
TypeError: AILover._get_next_available_key() takes 1 positional argument but 2 were given
2025-09-23 22:27:17 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 22:27:17 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 22:27:18 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 22:27:18 - [INFO] - Discord Bot is ready!
2025-09-23 22:27:20 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 22:27:20 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 22:27:21 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 22:27:22 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 22:27:22 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 1 條文檔用於構建 BM25。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 22:27:22 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 22:27:22 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 3 條訊息。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] 啟動「生成即摘要」對話流程...
2025-09-23 22:27:22 - [INFO] - [512280345618546699] [預處理-生成即摘要] 正在準備上下文...
2025-09-23 22:27:22 - [INFO] - [512280345618546699] [導演視角] 當前錨定模式: 'local'
2025-09-23 22:27:22 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令，視角保持 'local'。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-23 22:27:22 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] 正在組合混合記憶...
2025-09-23 22:27:22 - [INFO] - [512280345618546699] (RAG Cache) 檢索到 1 份文檔，正在檢查淨化快取...
2025-09-23 22:27:22 - [WARNING] - [512280345618546699] (RAG Sanitizer) 所有檢索到的文檔都未能成功淨化。
2025-09-23 22:27:22 - [INFO] - [512280345618546699] [生成即摘要] 正在執行雙重輸出生成...
2025-09-23 22:27:34 - [WARNING] - [512280345618546699] Key #0 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.39 秒後進行第 2 次嘗試...
2025-09-23 22:27:36 - [WARNING] - [512280345618546699] Key #0 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.18 秒後進行第 3 次嘗試...
2025-09-23 22:27:39 - [ERROR] - [512280345618546699] Key #0 (模型: gemini-2.5-pro) 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-23 22:27:39 - [CRITICAL] - [512280345618546699] [持久化冷卻] API Key #0 (模型: gemini-2.5-pro) 已被置入冷卻狀態，持續 24 小時。
2025-09-23 22:27:39 - [WARNING] - [512280345618546699] Key #1 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.18 秒後進行第 2 次嘗試...
2025-09-23 22:27:41 - [WARNING] - [512280345618546699] Key #1 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.31 秒後進行第 3 次嘗試...
2025-09-23 22:27:43 - [ERROR] - [512280345618546699] Key #1 (模型: gemini-2.5-pro) 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-23 22:27:43 - [CRITICAL] - [512280345618546699] [持久化冷卻] API Key #1 (模型: gemini-2.5-pro) 已被置入冷卻狀態，持續 24 小時。
2025-09-23 22:27:44 - [WARNING] - [512280345618546699] Key #2 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.22 秒後進行第 2 次嘗試...
2025-09-23 22:27:45 - [WARNING] - [512280345618546699] Key #2 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.41 秒後進行第 3 次嘗試...
2025-09-23 22:27:48 - [ERROR] - [512280345618546699] Key #2 (模型: gemini-2.5-pro) 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-23 22:27:48 - [CRITICAL] - [512280345618546699] [持久化冷卻] API Key #2 (模型: gemini-2.5-pro) 已被置入冷卻狀態，持續 24 小時。
2025-09-23 22:27:49 - [WARNING] - [512280345618546699] Key #3 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.19 秒後進行第 2 次嘗試...
2025-09-23 22:27:50 - [WARNING] - [512280345618546699] Key #3 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.25 秒後進行第 3 次嘗試...
2025-09-23 22:27:53 - [ERROR] - [512280345618546699] Key #3 (模型: gemini-2.5-pro) 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-23 22:27:53 - [CRITICAL] - [512280345618546699] [持久化冷卻] API Key #3 (模型: gemini-2.5-pro) 已被置入冷卻狀態，持續 24 小時。
2025-09-23 22:27:53 - [WARNING] - [512280345618546699] Key #4 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 1.48 秒後進行第 2 次嘗試...
2025-09-23 22:27:55 - [WARNING] - [512280345618546699] Key #4 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.38 秒後進行第 3 次嘗試...
2025-09-23 22:27:58 - [ERROR] - [512280345618546699] Key #4 (模型: gemini-2.5-pro) 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-23 22:27:58 - [CRITICAL] - [512280345618546699] [持久化冷卻] API Key #4 (模型: gemini-2.5-pro) 已被置入冷卻狀態，持續 24 小時。
2025-09-23 22:28:09 - [WARNING] - [512280345618546699] Key #5 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (InternalServerError)。將在 1.11 秒後進行第 2 次嘗試...
2025-09-23 22:28:10 - [WARNING] - [512280345618546699] Key #5 (模型: gemini-2.5-pro) 遭遇臨時性 API 錯誤 (ResourceExhausted)。將在 2.37 秒後進行第 3 次嘗試...
2025-09-23 22:28:13 - [ERROR] - [512280345618546699] Key #5 (模型: gemini-2.5-pro) 在 3 次內部重試後仍然失敗 (ResourceExhausted)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-23 22:28:13 - [CRITICAL] - [512280345618546699] [持久化冷卻] API Key #5 (模型: gemini-2.5-pro) 已被置入冷卻狀態，持續 24 小時。
2025-09-23 22:28:13 - [WARNING] - [512280345618546699] [Model Degradation] 模型 'gemini-2.5-pro' 的所有金鑰均嘗試失敗。正在降級到下一個模型...
2025-09-23 22:28:23 - [ERROR] - [512280345618546699] 解析 ´´´summary JSON 時失敗。內容: ```json
{
  "地點": "艾瑞亞大陸 > 寂靜之森 > 月光溪谷的隱士小屋",
  "角色互動": {
    "DINO": "命令碧拍手，被碧溫順地執行。",
    "碧": "輕柔地拍手，發出清脆聲響，並以順從、討好的語氣詢問DINO是否滿意，表達對DINO命令的遵從與渴望被認可。"
  },
  "環境描寫": "小屋內壁爐微光、寂靜、蛇尾鱗片在光下流轉。",
  "情感描寫": {
    "碧": "期待、順從、討好、渴望被認可的熱情、謹慎、恭敬。"
  },
  "關鍵字": ["拍手", "順從", "蛇人女奴", "溫順", "討好"]
}
```
2025-09-23 22:28:23 - [INFO] - [512280345618546699] [生成即摘要] 雙重輸出解析成功。
2025-09-23 22:28:24 - [INFO] - [512280345618546699] 回應已發送。正在啟動事後處理任務...
2025-09-23 22:28:29 - [INFO] - [512280345618546699] [事後處理-LORE保險] 獨立的背景LORE提取器已啟動...
2025-09-23 22:28:29 - [ERROR] - [512280345618546699] [事後處理-LORE保險] 背景LORE提取與擴展任務執行時發生未預期的異常: '"plan"'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 697, in _background_lore_extraction
    full_prompt = prompt_template.format(**extraction_params)
KeyError: '"plan"'
2025-09-23 22:35:31 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 22:35:31 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 22:35:31 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 22:35:31 - [INFO] - Discord Bot is ready!
2025-09-23 22:35:34 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 22:35:34 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 22:35:34 - [INFO] - 已成功發送啟動成功通知給管理員。
