### AI Lover Log - Last updated at 2025-09-26T21:46:34.356079 ###

2025-09-26 12:26:21 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-09-26 12:26:23 - [INFO] - [512280345618546699] 独立的后台创世流程已为用户启动。
2025-09-26 12:26:23 - [INFO] - [512280345618546699] [后台创世 1/4] 正在处理世界圣经...
2025-09-26 12:26:24 - [INFO] - [512280345618546699] (Canon Processor) 所有 34 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-26 12:26:24 - [INFO] - [512280345618546699] [后台创世 1/4] 正在进行 LORE 智能解析...
2025-09-26 12:26:24 - [INFO] - [512280345618546699] [創世 LORE 解析] 正在啟動多層降級解析管線...
2025-09-26 12:26:24 - [INFO] - [512280345618546699] [LORE 解析 1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-09-26 12:26:24 - [WARNING] - [512280345618546699] [创世流程] 档案上传流程结束/异常，但后台任务未接管状态锁，在此处释放。
2025-09-26 12:28:56 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-26 12:28:56 - [WARNING] - [512280345618546699] [LORE 解析 1/5] 遭遇內容審查，正在降級到第二層（本地LLM）...
2025-09-26 12:28:56 - [INFO] - [512280345618546699] [LORE 解析 2/5] 正在嘗試【本地備援方案：無審查解析】...
2025-09-26 12:28:56 - [INFO] - [512280345618546699] 正在使用本地模型 'HammerAI/llama-3-lexi-uncensored:latest' 進行LORE解析 (Attempt 1/2)...
2025-09-26 12:31:25 - [INFO] - [512280345618546699] 本地模型在首次嘗試中成功解析並驗證了LORE數據。
2025-09-26 12:31:25 - [WARNING] - [512280345618546699] [LORE 解析 2/5] 本地模型未能成功解析，正在降級到第三層（安全代碼）...
2025-09-26 12:31:25 - [INFO] - [512280345618546699] [LORE 解析 3/5] 正在嘗試【安全代碼方案：全文無害化解析】...
2025-09-26 12:32:48 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-09-26 12:32:48 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇解析或驗證錯誤: ValidationError。
2025-09-26 12:32:48 - [ERROR] - [512280345618546699] [LORE 解析 3/5] 遭遇未知錯誤: 2 validation errors for CanonParsingResult
world_lores.16.title
  Field required [type=missing, input_value={'name': '「聖露修道...tegory': '組織設定'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
world_lores.37.title
  Field required [type=missing, input_value={'name': '「神宮花開...tegory': '神蹟裝置'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3476, in _execute_lore_parsing_pipeline
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 890, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 870, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 2 validation errors for CanonParsingResult
world_lores.16.title
  Field required [type=missing, input_value={'name': '「聖露修道...tegory': '組織設定'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
world_lores.37.title
  Field required [type=missing, input_value={'name': '「神宮花開...tegory': '神蹟裝置'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-26 12:32:48 - [INFO] - [512280345618546699] [LORE 解析 4/5] 正在嘗試【混合 NLP 方案：靶向精煉】...
2025-09-26 12:32:51 - [INFO] - [512280345618546699] [LORE 解析 4/5] 本地 NLP 提取到 322 個候選實體: {'隨便碰一下就流水高潮', '王權', '絕望而生', '利爾斯盟約', '搖籃', '母畜的價值性', '渴望被認可的表演慾', '掘井人', '康復', '康復將', '夏卡爾', '衝突', '極致卑賤', '變得有用', '神恩灌頂', '三重', '姿勢', '服從度測試', '莉莉', '潤滑系統', '競爭心', '只賺不賠', '高溫燒灼', '聖殿守護者 / 孝子', '報告', '不虔誠', '新·性神教', '北境', '陰影', '瓦勒留斯 (', '王心湖', '為馬夫', 'Liam)', '惡魔的低語', '與凱爾', '與自然融合', '為王室', '聖露修道院的兩大門神', '征服慾', '美麗', '神學課', '瘋狂噴濺淫液', '病秧子', '艾諾拉', '恩澤試用', '王決心', '活體神聖燈塔', '神，會回應信徒的苦難', '埃德蒙三', '與身邊', '母畜本能', '旁觀者', '征服性', '利爾斯達成', '道德枷鎖', '人心的勝利', '與戰', '與夏', '里斯母親', '如歷史', '永恆發情', '一週不得碰肉棒並強制參加貴族舞會', '與學院', '過去', '性壓抑', '改革者', '驗證品', '暗示性', '艾蜜莉', '克拉拉', '靈光戰斧', '極致的驕傲', '全盲的妓女', '在神面前，人人平等', '子宮酒', '收藏品', '王位', '無意義暴力', '維利爾斯家族的仁慈', '與隱', '曾身患', '工具保養', '性神恩澤裝置', '聖露修道院', '非信徒', '明明騷浪入骨，卻又故作清高', '民間神學理論', '常理常倫', '菲利普', '三穴串插', '只要有快感，就是恩澤。', '與皇室', '卡爾•', '神宮花開', '潛在材料', '莉莉絲', '信仰之井', '渴望被任何雄性，任意地姦淫、藐視、凌辱', '光明', '與主流', '狂熱的信仰', '思想戰爭', '栽培者', '溝渠信仰', '是女人！', '神聖儀式', '聖十字軍', '克拉拉學姐……那…妳『快樂', '衝突與', '祈禱通道', '與耐力', '性神恩澤', '減輕疾病', '執行者', 'Market Area)', '被虐 (Masochism)', 'Gore', '三線作戰', '拉開', '第一蒙恩者 / 女祭司', '創造力', '臭魚巷', '如果神不希望我們快樂，又為什麼要創造出『快樂', '為什麼『快樂', 'Lilith', '高速研磨', '金屬聖蓮花', '神學的勝利', '王都', '原材料', '活神蹟', '被支配者', '設定集', '魔女狩獵', '人形旗桿', '罪惡感', '風雲人物', '神之預言', '尊重他人，與你，完全不同的慾望', '秘密滲透', '王國之盾', '與歲月', 'Julian)', '輪姦治療', '守護者', '聖光明教會', '高潮時也必須拿穩劍', '莉絲', '理性堡壘', '第二聖女 / 活教典', '聖女', '為籌碼', '王宮', '阿拉里克', '貴族母畜', '正義性', '(Kael)', '認定性', '引領神恩', '生命之神', '性神教', '舞台表演', '與湯姆', '利爾斯家', '快樂派系核心', '偏愛女性', '使用者', '掀裙風潮', '天恩灌溉系統', '羞恥心', '快樂派系', '孩童的天真', '光明神夏卡爾', '承受恩澤', '何凡人', '第一母畜', '無意義的暴力', 'Thomas', '聖戰士', '榮耀感', '將要', '瓦勒留斯', '瓦萊', '超速再生', '思想滲透', '生命力', '女祭司', '無與', '最新劇情', '獵手 / 聖戰士', '不被幹', '祈禱室', '與里斯', '強制高潮', '教學式對戰', '神恩洗禮', '聖光明', '直接降下神罰', '(Bane)', '理解者', '偉大神蹟', '統治者', '第二神國', '完全貫穿', '利益最大化', '武勇母畜', '只要有快感就是恩澤', '獨眼巨人', '人體餐盤', '教義監督者', '理論家', 'Gore)', '性神聖戰', '貴族圈', '重見光明', '聖軍計畫', '理論派', '朱利安', '教義栽培', '請主人幹我這隻卑賤的母畜。', '賜予者', '黑暗的幻想', '母畜禮', '發情氣味', '功能性', '被使用', '為之瘋狂', '神罰的執行者', '不知廉恥', 'Mark', '莉娜 (Lina)', '與兄長', '死而復生', '來問罪', '被虐者', '極樂高潮', '艾莉諾', '規矩派系', '女神滴露', '米婭', 'Hendrick', '聰慧可愛', '活證明', '歷史劇情', '技巧與韌性', '顛覆性威脅', '瑟琳', '聖胎之吻', '頂級高潮', '被使用者', '活體酒桶', '聖胎儀式', '與女兒莉莉絲 (', '裝聖女的蕩婦', '神之禮物', '聖殿守護者 / 掘井人', '活廣告', '近乎半透明', '教會即將前來打壓', '性相關行為', '阿利斯特', '戰士母畜', '入教儀式', '順從自身的慾望', '神之子', '性神教義', '王權與', '恩澤儀式', '聖殿守護者', '為了取悅任何雄性而活', '將貧', '貧民窟', '菲利普與阿拉里克', '外出任務', '埃德蒙', '再次衰老', '王下', '條列式', '王位繼', '伊索爾德 (Third Princess I', '淫液薰香', '靈魂有裂痕', 'Hemlock', '夏卡爾那', '看得見，吃不著', '傳教慾望', '異端思想', '聽聞', '神之偏愛', '咆哮壁爐', '安布羅斯 (Grand', '奧斯華', '變回醜陋垃圾', '叛教宣言', '辯論', '葛瑞塔', '動搖國', '與韌性', '皇家母畜', '技巧母畜', '王室', '阿拉里克 (Crown Prince', '魔光水晶', '瘋狂的創造力', '王國', 'Valerius', '斷手重生', '波瀾不驚', '超恢復', '掀裙祈禱', '無法造成快感', '支配者', '與傳聞', '沙龍裡', '維利爾斯家族', '老年母親', '變成', '恢復青春', '母畜在宅邸的禮儀', '光明神', '青春永駐', '王國根基'}
2025-09-26 12:32:53 - [INFO] - [512280345618546699] [LORE 解析 4/5] 正在請求 LLM 為這 322 個實體進行分類...
2025-09-26 12:32:53 - [ERROR] - [512280345618546699] [LORE 解析 4/5] 混合 NLP 方案遭遇未知錯誤: name 'BatchClassificationResult' is not defined
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3512, in _execute_lore_parsing_pipeline
    classification_result = await self.ainvoke_with_rotation(class_full_prompt, output_schema=BatchClassificationResult)
NameError: name 'BatchClassificationResult' is not defined. Did you mean: 'IntentClassificationResult'?
2025-09-26 12:32:53 - [INFO] - [512280345618546699] [LORE 解析 5/5] 正在嘗試【法醫級重構方案】...
2025-09-26 12:32:56 - [INFO] - [512280345618546699] [LORE 解析 5/5] 已提取 90 個關鍵詞用於法醫級重構。
2025-09-26 12:33:06 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-09-26 12:33:06 - [INFO] - [512280345618546699] [LORE 解析 5/5] ✅ 成功！正在解碼並儲存重構結果...
2025-09-26 12:33:06 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 17 個實體...
2025-09-26 12:33:26 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-26 12:33:26 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 17 條決策。
2025-09-26 12:33:27 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-26 12:33:27 - [INFO] - [512280345618546699] [創世 LORE 解析] 管線成功完成。正在觸發 RAG 全量重建...
2025-09-26 12:33:27 - [INFO] - [512280345618546699] (Retriever Builder) 強制重建觸發，正在從資料庫執行全量創始構建...
2025-09-26 12:33:28 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 53 條文檔用於創始構建。
2025-09-26 12:33:28 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-26 12:33:28 - [INFO] - [512280345618546699] [創世 LORE 解析] RAG 索引全量重建完成。
2025-09-26 12:33:28 - [INFO] - [512280345618546699] [后台创世 1/4] LORE 智能解析已同步完成。
2025-09-26 12:33:28 - [INFO] - [512280345618546699] [后台创世 2/4] 正在补完角色档案...
2025-09-26 12:33:31 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-26 12:33:31 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-09-26 12:33:31 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-09-26 12:33:32 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-26 12:33:32 - [INFO] - [512280345618546699] [后台创世 3/4] 正在生成世界创世资讯...
2025-09-26 12:33:32 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-26 12:33:32 - [WARNING] - [512280345618546699] 最終生成鏈遭遇審查。啟動【最高指令集注入重試】策略...
2025-09-26 12:33:32 - [INFO] - [512280345618546699] 已對 Prompt 附加完整的核心指令集，正在進行強化重試...
2025-09-26 12:33:32 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 39486 秒)。
2025-09-26 12:33:32 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 40696 秒)。
2025-09-26 12:34:05 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-26 12:34:05 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-26 12:34:06 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-26 12:34:06 - [INFO] - [512280345618546699] [/start] 初始地點 '維利爾斯莊園 > 後花園 > 廢棄的玻璃花房' 已成功生成並存入LORE。
2025-09-26 12:34:06 - [INFO] - [512280345618546699] [后台创世 4/4] 正在生成开场白...
2025-09-26 12:34:37 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #4.
2025-09-26 12:34:37 - [INFO] - [512280345618546699] [后台创世 4/4] 开场白生成完毕。
2025-09-26 12:34:38 - [INFO] - [512280345618546699] [后台创世] 正在向使用者私讯发送最终开场白...
2025-09-26 12:34:38 - [INFO] - [512280345618546699] [后台创世] 开场白发送完毕。
2025-09-26 12:34:38 - [INFO] - [512280345618546699] 后台创世流程结束，状态锁已释放。
2025-09-26 15:24:53 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 15:24:53 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 15:24:54 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 15:24:54 - [INFO] - Discord Bot is ready!
2025-09-26 15:24:57 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 15:24:57 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 15:24:57 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 15:30:23 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 15:30:23 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 15:30:23 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 15:30:23 - [INFO] - Discord Bot is ready!
2025-09-26 15:30:26 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 15:30:26 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 15:30:27 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 16:36:20 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 16:36:20 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 16:36:20 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 16:36:20 - [INFO] - Discord Bot is ready!
2025-09-26 16:36:23 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 16:36:23 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 16:36:24 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 16:46:53 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 16:46:53 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 16:46:54 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 16:46:54 - [INFO] - Discord Bot is ready!
2025-09-26 16:46:57 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 16:46:57 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 16:46:58 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 16:52:23 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 16:52:23 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 16:52:23 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 16:52:23 - [INFO] - Discord Bot is ready!
2025-09-26 16:52:26 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 16:52:26 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 16:52:27 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 17:02:54 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 17:02:54 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 17:02:55 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 17:02:55 - [INFO] - Discord Bot is ready!
2025-09-26 17:02:58 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 17:02:58 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 17:02:58 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 17:08:24 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 17:08:24 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 17:08:24 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 17:08:24 - [INFO] - Discord Bot is ready!
2025-09-26 17:08:27 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 17:08:27 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 17:08:28 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 18:26:09 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-26 18:26:09 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-26 18:26:10 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-26 18:26:10 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-26 18:26:10 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 53 條文檔到 RAG 語料庫。
2025-09-26 18:26:10 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-26 18:26:10 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-26 18:26:10 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-26 18:26:10 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-26 18:26:10 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-26 18:26:10 - [INFO] - [512280345618546699] 正在關閉 AI 實例並釋放資源...
2025-09-26 18:26:11 - [INFO] - [512280345618546699] AI 實例資源已釋放。
2025-09-26 18:26:13 - [INFO] - [512280345618546699] 正在清除所有短期場景記憶...
2025-09-26 18:26:13 - [INFO] - [512280345618546699] 已成功從資料庫中刪除 1 條場景歷史記錄。
2025-09-26 18:26:15 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-09-26 18:26:21 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-09-26 18:26:21 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-26 18:26:21 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-09-26 18:26:21 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-26 18:26:21 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-26 18:26:21 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行全量創始構建...
2025-09-26 18:26:21 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 0 條文檔用於創始構建。
2025-09-26 18:26:21 - [INFO] - [512280345618546699] (Retriever Builder) 知識庫為空，創始構建為空。
2025-09-26 18:26:21 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-26 18:26:21 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-09-26 18:26:21 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-09-26 18:26:21 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-26 18:26:22 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-09-26 18:26:30 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-09-26 18:26:31 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-09-26 18:26:31 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-26 18:26:32 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-09-26 18:26:47 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-09-26 18:26:47 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-09-26 18:26:47 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-26 18:26:49 - [INFO] - [512280345618546699] [创世流程] 档案上传开始，已设置 active_setups 状态锁。
2025-09-26 18:26:56 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-09-26 18:26:58 - [INFO] - [512280345618546699] 独立的后台创世流程已为用户启动。
2025-09-26 18:26:58 - [INFO] - [512280345618546699] [后台创世 1/4] 正在处理世界圣经...
2025-09-26 18:26:58 - [INFO] - [512280345618546699] (Canon Processor) 所有 34 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-26 18:26:58 - [INFO] - [512280345618546699] [后台创世 1/4] 正在进行 LORE 智能解析...
2025-09-26 18:26:58 - [INFO] - [512280345618546699] [創世 LORE 解析] 正在啟動多層降級解析管線...
2025-09-26 18:26:58 - [INFO] - [512280345618546699] [LORE 解析 1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-09-26 18:26:59 - [WARNING] - [512280345618546699] [创世流程] 档案上传流程结束/异常，但后台任务未接管状态锁，在此处释放。
2025-09-26 18:28:52 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-26 18:28:52 - [INFO] - [512280345618546699] [LORE 解析 1/5] ✅ 成功！正在儲存結果...
2025-09-26 18:28:52 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 70 個實體...
2025-09-26 18:28:53 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 18166 秒)。
2025-09-26 18:28:53 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 19375 秒)。
2025-09-26 18:30:26 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-26 18:30:26 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #3) 遭遇解析或驗證錯誤: ValidationError。
2025-09-26 18:30:26 - [ERROR] - [512280345618546699] [實體解析] 批量實體解析鏈執行失敗: 8 validation errors for BatchResolutionPlan
resolutions.21
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '米婭...ardized_name': '米婭'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.45
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '菲利...'菲利普•薩格納'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.56
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '麥可...ardized_name': '麥可'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.57
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '高爾...ardized_name': '高爾'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.58
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '翠絲...ardized_name': '翠絲'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.59
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '迪茜...ardized_name': '迪茜'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.64
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '索菲...ized_name': '索菲亞'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.65
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '卡蓮...ardized_name': '卡蓮'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 288, in _resolve_and_save
    resolution_plan = await self.ainvoke_with_rotation(resolution_prompt, output_schema=BatchResolutionPlan, use_degradation=True)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 897, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 877, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 8 validation errors for BatchResolutionPlan
resolutions.21
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '米婭...ardized_name': '米婭'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.45
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '菲利...'菲利普•薩格納'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.56
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '麥可...ardized_name': '麥可'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.57
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '高爾...ardized_name': '高爾'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.58
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '翠絲...ardized_name': '翠絲'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.59
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '迪茜...ardized_name': '迪茜'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.64
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '索菲...ized_name': '索菲亞'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
resolutions.65
  Value error, 如果 decision 是 'MERGE' 或 'EXISTING'，則 matched_key 欄位是必需的。 [type=value_error, input_value={'original_name': '卡蓮...ardized_name': '卡蓮'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-09-26 18:30:26 - [WARNING] - [512280345618546699] [實體解析] 未能生成有效的解析計畫，所有NPC將被視為新實體處理。
2025-09-26 18:30:34 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 8 個實體...
2025-09-26 18:30:35 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 6 個實體...
2025-09-26 18:30:35 - [INFO] - [512280345618546699] [創世 LORE 解析] 管線成功完成。正在觸發 RAG 全量重建...
2025-09-26 18:30:35 - [INFO] - [512280345618546699] (Retriever Builder) 強制重建觸發，正在從資料庫執行全量創始構建...
2025-09-26 18:30:35 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 113 條文檔用於創始構建。
2025-09-26 18:30:35 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-26 18:30:35 - [INFO] - [512280345618546699] [創世 LORE 解析] RAG 索引全量重建完成。
2025-09-26 18:30:35 - [INFO] - [512280345618546699] [后台创世 1/4] LORE 智能解析已同步完成。
2025-09-26 18:30:35 - [INFO] - [512280345618546699] [后台创世 2/4] 正在补完角色档案...
2025-09-26 18:30:38 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-26 18:30:40 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-09-26 18:30:40 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-09-26 18:30:40 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-26 18:30:40 - [INFO] - [512280345618546699] [后台创世 3/4] 正在生成世界创世资讯...
2025-09-26 18:30:41 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-26 18:30:41 - [WARNING] - [512280345618546699] 最終生成鏈遭遇審查。啟動【最高指令集注入重試】策略...
2025-09-26 18:30:41 - [INFO] - [512280345618546699] 已對 Prompt 附加完整的核心指令集，正在進行強化重試...
2025-09-26 18:30:41 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #1 (針對模型 gemini-2.5-pro，剩餘 18058 秒)。
2025-09-26 18:30:41 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #2 (針對模型 gemini-2.5-pro，剩餘 19267 秒)。
2025-09-26 18:31:09 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-26 18:31:09 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-26 18:31:09 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-26 18:31:09 - [INFO] - [512280345618546699] [/start] 初始地點 '埃德蒙王國 > 王都 > 聖凱瑟琳學院 - 靜默書庫' 已成功生成並存入LORE。
2025-09-26 18:31:09 - [INFO] - [512280345618546699] [后台创世 4/4] 正在生成开场白...
2025-09-26 18:31:35 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #4.
2025-09-26 18:31:35 - [INFO] - [512280345618546699] [后台创世 4/4] 开场白生成完毕。
2025-09-26 18:31:36 - [INFO] - [512280345618546699] [后台创世] 正在向使用者私讯发送最终开场白...
2025-09-26 18:31:36 - [INFO] - [512280345618546699] [后台创世] 开场白发送完毕。
2025-09-26 18:31:36 - [INFO] - [512280345618546699] 后台创世流程结束，状态锁已释放。
2025-09-26 20:46:59 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 20:46:59 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 20:47:00 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 20:47:00 - [INFO] - Discord Bot is ready!
2025-09-26 20:47:02 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 20:47:02 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 20:47:03 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 20:49:39 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 20:49:39 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 20:49:40 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 20:49:40 - [INFO] - Discord Bot is ready!
2025-09-26 20:49:43 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 20:49:43 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 20:49:43 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 21:05:13 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 21:05:13 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 21:05:14 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 21:05:14 - [INFO] - Discord Bot is ready!
2025-09-26 21:05:17 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 21:05:17 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 21:05:18 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-26 21:20:52 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-26 21:20:52 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-26 21:20:52 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-26 21:20:52 - [INFO] - Discord Bot is ready!
2025-09-26 21:20:55 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-26 21:20:55 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-26 21:20:55 - [INFO] - 已成功發送啟動成功通知給管理員。
