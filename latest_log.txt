### AI Lover Log - Last updated at 2025-09-17T00:19:29.938484 ###

2025-09-17 00:15:02 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 3 条旧 'canon' 记录。
2025-09-17 00:15:03 - [INFO] - [512280345618546699] (Canon Processor) 所有 3 个世界圣经文本块均已成功处理并存入 SQL 记忆库 (BM25 備援方案)。
2025-09-17 00:15:03 - [WARNING] - [512280345618546699] (Canon Processor) [優雅降級] 主記憶系統 (Embedding) 在處理世界聖經時失敗。程式將自動使用備援記憶系統 (BM25)。錯誤類型: GoogleGenerativeAIError
2025-09-17 00:15:03 - [INFO] - [512280345618546699] [/start] 聖經文本已存入 RAG 資料庫。
2025-09-17 00:15:03 - [INFO] - [512280345618546699] [/start] 正在進行 LORE 智能解析...
2025-09-17 00:15:03 - [INFO] - [512280345618546699] 開始智能解析世界聖經文本...
2025-09-17 00:15:03 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 2)
2025-09-17 00:15:03 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:03 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 3)
2025-09-17 00:15:12 - [ERROR] - [512280345618546699] 在 ainvoke 期間發生未知錯誤 (模型: gemini-2.5-flash-lite): 1 validation error for CanonParsingResult
npc_profiles.0.name
  Field required [type=missing, input_value={'description': '性神...': ['慾望', '恩澤']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3861, in ainvoke_with_rotation
    result = await asyncio.wait_for(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 445, in wait_for
    return fut.result()
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\base.py", line 5447, in ainvoke
    return await self.bound.ainvoke(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\base.py", line 3088, in ainvoke
    input_ = await coro_with_context(part(), context, create_task=True)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\base.py", line 219, in ainvoke
    return await self._acall_with_config(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\base.py", line 1990, in _acall_with_config
    output: Output = await coro_with_context(coro, context)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\base.py", line 280, in aparse_result
    return await run_in_executor(None, self.parse_result, result, partial=partial)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\config.py", line 617, in run_in_executor
    return await asyncio.get_running_loop().run_in_executor(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\config.py", line 608, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\openai_tools.py", line 336, in parse_result
    pydantic_objects.append(name_dict[res["type"]](**res["args"]))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for CanonParsingResult
npc_profiles.0.name
  Field required [type=missing, input_value={'description': '性神...': ['慾望', '恩澤']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-17 00:15:13 - [ERROR] - [512280345618546699] [Final Failure] 所有模型 (gemini-2.5-flash-lite) 和所有可用 API 金鑰均嘗試失敗。
2025-09-17 00:15:13 - [ERROR] - [512280345618546699] 所有標準嘗試均失敗。啟動最終備援策略: 'euphemize'
2025-09-17 00:15:13 - [WARNING] - [512280345618546699] 內部鏈意外遭遇審查。啟動【文學評論家委婉化】策略...
2025-09-17 00:15:13 - [INFO] - [512280345618546699] (Euphemizer) 正在將 '天空龍的名字是"歐西里斯"


好的，這是一份關於「性神教」、「性神城」以及其信徒的詳細解說資訊，整...' 清洗為安全的文學概述...
2025-09-17 00:15:13 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 4)
2025-09-17 00:15:13 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:13 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 5)
2025-09-17 00:15:15 - [INFO] - [512280345618546699] (Euphemizer) 清洗成功，生成安全文本: '這段手稿描繪了一個名為「性神教」的宗教體系及其核心據點「性神城」。該教派崇拜一個無形、無性別的原始神...'
2025-09-17 00:15:18 - [INFO] - [512280345618546699] 正在處理 'location_info' 類別的 1 個實體...
2025-09-17 00:15:18 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 0)
2025-09-17 00:15:22 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:22 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 1)
2025-09-17 00:15:23 - [INFO] - [512280345618546699] 已為新實體 '性神城' (標準名: 性神城) 創建了 LORE 條目，主鍵為 '性神城'。
2025-09-17 00:15:23 - [INFO] - [512280345618546699] 正在處理 'world_lore' 類別的 2 個實體...
2025-09-17 00:15:27 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:27 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 2)
2025-09-17 00:15:28 - [INFO] - [512280345618546699] 已為新實體 '性神教' (標準名: 性神教) 創建了 LORE 條目，主鍵為 '性神教'。
2025-09-17 00:15:32 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:32 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 3)
2025-09-17 00:15:33 - [INFO] - [512280345618546699] 已為新實體 '性神城社會結構' (標準名: 性神城社會結構) 創建了 LORE 條目，主鍵為 '性神城社會結構'。
2025-09-17 00:15:33 - [INFO] - [512280345618546699] 世界聖經智能解析與 LORE 創建完成。
2025-09-17 00:15:33 - [INFO] - [512280345618546699] [/start] LORE 智能解析完成。
2025-09-17 00:15:33 - [INFO] - [512280345618546699] [/start 流程 1/4] 世界聖經處理完畢。
2025-09-17 00:15:35 - [INFO] - [512280345618546699] [/start 流程 2/4] 正在補完角色檔案...
2025-09-17 00:15:37 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:37 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 4)
2025-09-17 00:15:38 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:38 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 5)
2025-09-17 00:15:40 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-09-17 00:15:40 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-17 00:15:40 - [INFO] - [512280345618546699] [/start 流程 2/4] 角色檔案補完畢。
2025-09-17 00:15:42 - [INFO] - [512280345618546699] [/start 流程 3/4] 正在生成世界創世資訊...
2025-09-17 00:15:42 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 0)
2025-09-17 00:15:42 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:42 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 1)
2025-09-17 00:15:46 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-17 00:15:46 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-17 00:15:47 - [INFO] - [512280345618546699] [/start 流程 3/4] 世界創世資訊生成完畢。
2025-09-17 00:15:49 - [INFO] - [512280345618546699] [/start 流程 4/4] 正在生成開場白...
2025-09-17 00:15:49 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-flash-lite' (優先級 1/1) ---
2025-09-17 00:15:49 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-flash-lite' 實例 (API Key index: 2)
2025-09-17 00:15:52 - [INFO] - [512280345618546699] [/start 流程 4/4] 開場白生成完畢。
2025-09-17 00:15:52 - [INFO] - [512280345618546699] /start 流程：正在向使用者私訊發送開場白...
2025-09-17 00:15:52 - [INFO] - [512280345618546699] /start 流程：開場白發送完畢。設定流程成功結束。
2025-09-17 00:18:27 - [INFO] - [512280345618546699] 啟動「極簡直連」對話流程...
2025-09-17 00:18:27 - [INFO] - [512280345618546699] [預處理-終極條件化模式] 正在準備上下文...
2025-09-17 00:18:27 - [INFO] - [512280345618546699] [導演視角] 檢測到本地互動指令。視角切換為 'local'。
2025-09-17 00:18:27 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-17 00:18:27 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-17 00:18:27 - [INFO] - [512280345618546699] 正在使用【本地互動】Prompt 模板。
2025-09-17 00:18:27 - [INFO] - [512280345618546699] [生成] 正在執行直接生成...
2025-09-17 00:18:27 - [INFO] - [512280345618546699] --- 開始嘗試模型: 'gemini-2.5-pro' (優先級 1/3) ---
2025-09-17 00:18:27 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-pro' 實例 (API Key index: 3)
2025-09-17 00:18:35 - [INFO] - [512280345618546699] [淨化] 成功基於雙標記提取到純淨輸出。
2025-09-17 00:18:35 - [INFO] - [512280345618546699] [生成] 直接生成成功。互動已存入場景 '512280345618546699_local_艾瑟利亞大陸_靜謐海岸_海邊小屋'。
