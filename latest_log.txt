### AI Lover Log - Last updated at 2025-09-09T20:39:20.455669 ###

2025-09-09 20:34:08 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #4 創建。下一次將使用 Key #5。
2025-09-09 20:34:09 - [INFO] - [512280345618546699] 已成功將 RAG 上下文提煉為事實要點。
2025-09-09 20:34:09 - [INFO] - [512280345618546699] (Graph) Node: perceive_and_set_view -> 正在基於意圖 'nsfw_descriptive' 统一处理感知与视角...
2025-09-09 20:34:09 - [INFO] - [512280345618546699] (View Mode) 检测到描述性意图，准备进入/更新远程视角。
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (Perception Hub) GameState 无需更新。
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (Graph|3) Node: query_lore -> 正在基於【安全查詢文本】 '【情節概述】:

該片段描繪了一場極端情境下的角色互動，其中...' 執行LORE查詢...
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (LORE Querier) 已鎖定有效場景: 性神城 > 瀆神者市集
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (LORE Querier) 在有效場景中找到 4 位常駐NPC。
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (LORE Querier) 提取到以下關鍵實體: ['艾瑟利亞大陸', '瑪琳娜', '迷霧森林深處']
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (LORE Querier) 查詢到 2 條唯一的LORE記錄。
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (LORE Querier) 從安全查詢文本中提取並查詢到 2 條相關LORE。
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (LORE Querier) 經過上下文優先合併與過濾後，共鎖定 5 條LORE作為本回合上下文。
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (Graph) Node: assemble_context -> 正在将 5 条 LORE 记录组装为最终上下文...
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (Context Assembler) 上下文簡報組裝完畢。
2025-09-09 20:34:10 - [INFO] - [512280345618546699] (Graph|5) Node: expansion_decision -> 正在基於【安全查詢文本】 '【情節概述】:

該片段描繪了一場極端情境下的角色互動，其中...' 判斷是否擴展...
2025-09-09 20:34:11 - [INFO] - [512280345618546699] (Graph|5) LORE擴展決策: False。理由: 劇本描述了瑪琳娜經歷一系列強制性身體接觸的情節，並未要求新的角色類型或職責。現有的角色名單中已有瑪琳娜，她可以作為該情節的核心人物。因此，不需要擴展LORE。
2025-09-09 20:34:11 - [INFO] - [512280345618546699] (Graph) Node: prepare_existing_subjects -> 已将 4 个现有NPC打包为规划主体。
2025-09-09 20:34:11 - [INFO] - [512280345618546699] (Router) Routing to planner. Intent: 'nsfw_descriptive', Final Viewing Mode: 'remote'
2025-09-09 20:34:11 - [INFO] - [512280345618546699] (Graph|NSFW Chain) Node: nsfw_breakthrough_node -> 正在執行【指令轟炸】...
2025-09-09 20:34:11 - [INFO] - [512280345618546699] (NSFW Node) 檢測到新指令，正在準備摘要歷史以鼓勵創新...
2025-09-09 20:34:11 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #5 創建。下一次將使用 Key #6。
2025-09-09 20:34:11 - [INFO] - [512280345618546699] (History Summarizer) 正在樂觀嘗試直接摘要原始歷史文本...
2025-09-09 20:34:13 - [INFO] - [512280345618546699] (History Summarizer) 直接摘要成功。
2025-09-09 20:34:18 - [INFO] - [512280345618546699] (Graph|NSFW Outline Pt.2) Node: nsfw_refinement -> 正在润色NSFW故事大纲...
2025-09-09 20:34:27 - [INFO] - [512280345618546699] (Graph|Final Rendering) Node: final_rendering -> 正在将故事大纲渲染为最终小说...
2025-09-09 20:34:27 - [INFO] - [512280345618546699] (Rendering Prep) 已成功將導演視角指令從世界快照中分離。
2025-09-09 20:34:52 - [INFO] - [512280345618546699] (Graph|10) Node: validate_and_rewrite -> 正在對 LLM 原始輸出進行內容保全式淨化...
2025-09-09 20:34:52 - [INFO] - [512280345618546699] (Graph|11) Node: persist_state -> 正在持久化狀態與記憶...
2025-09-09 20:34:52 - [INFO] - [512280345618546699] (Persist) 正在將 LORE 提取任務分派到背景執行...
2025-09-09 20:34:57 - [INFO] - [512280345618546699] 背景任務：LORE 提取器已啟動...
2025-09-09 20:35:25 - [ERROR] - [512280345618546699] 在 ainvoke 期間發生未知但非安全相關的錯誤: 1 validation error for ToolCallPlan
plan.0.parameters
  Input should be a valid dictionary [type=dict_type, input_value='# === 【【【核心分... 擴展計畫 JSON。\n', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/dict_type
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3453, in ainvoke_with_rotation
    result = await asyncio.wait_for(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 445, in wait_for
    return fut.result()
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\base.py", line 3088, in ainvoke
    input_ = await coro_with_context(part(), context, create_task=True)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\base.py", line 219, in ainvoke
    return await self._acall_with_config(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\base.py", line 1990, in _acall_with_config
    output: Output = await coro_with_context(coro, context)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\base.py", line 280, in aparse_result
    return await run_in_executor(None, self.parse_result, result, partial=partial)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\config.py", line 617, in run_in_executor
    return await asyncio.get_running_loop().run_in_executor(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\config.py", line 608, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\openai_tools.py", line 336, in parse_result
    pydantic_objects.append(name_dict[res["type"]](**res["args"]))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ToolCallPlan
plan.0.parameters
  Input should be a valid dictionary [type=dict_type, input_value='# === 【【【核心分... 擴展計畫 JSON。\n', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/dict_type
2025-09-09 20:35:25 - [ERROR] - [512280345618546699] 背景LORE提取與擴展任務執行時發生未預期的異常: 1 validation error for ToolCallPlan
plan.0.parameters
  Input should be a valid dictionary [type=dict_type, input_value='# === 【【【核心分... 擴展計畫 JSON。\n', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/dict_type
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1203, in _background_lore_extraction
    extraction_plan = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3496, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3453, in ainvoke_with_rotation
    result = await asyncio.wait_for(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 445, in wait_for
    return fut.result()
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\base.py", line 3088, in ainvoke
    input_ = await coro_with_context(part(), context, create_task=True)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\base.py", line 219, in ainvoke
    return await self._acall_with_config(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\base.py", line 1990, in _acall_with_config
    output: Output = await coro_with_context(coro, context)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\base.py", line 280, in aparse_result
    return await run_in_executor(None, self.parse_result, result, partial=partial)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\config.py", line 617, in run_in_executor
    return await asyncio.get_running_loop().run_in_executor(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\config.py", line 608, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\openai_tools.py", line 336, in parse_result
    pydantic_objects.append(name_dict[res["type"]](**res["args"]))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ToolCallPlan
plan.0.parameters
  Input should be a valid dictionary [type=dict_type, input_value='# === 【【【核心分... 擴展計畫 JSON。\n', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/dict_type
