### AI Lover Log - Last updated at 2025-09-09T20:48:51.956695 ###

  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\config.py", line 617, in run_in_executor
    return await asyncio.get_running_loop().run_in_executor(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\runnables\config.py", line 608, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\output_parsers\openai_tools.py", line 336, in parse_result
    pydantic_objects.append(name_dict[res["type"]](**res["args"]))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ToolCallPlan
plan.0.parameters
  Input should be a valid dictionary [type=dict_type, input_value='# === 【【【核心分... 擴展計畫 JSON。\n', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/dict_type
2025-09-09 20:43:35 - [INFO] - Discord Bot is ready and commands are synced!
2025-09-09 20:43:38 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-09 20:43:38 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-09 20:43:39 - [INFO] - 已成功發送啟動成功通知給管理員 (ID: 512280345618546699)。
2025-09-09 20:43:40 - [INFO] - [512280345618546699] 接收到來自 'dinosonicgo' 在頻道 'Direct Message with Unknown User' 中的消息: '繼續，瑪琳娜被輪姦到高潮...'
2025-09-09 20:43:40 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-09 20:43:41 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-09 20:43:41 - [INFO] - [512280345618546699] 已成功加載 3 個戰術指令模組: 00_core_protocol, action_macro_movement, action_sexual_content
2025-09-09 20:43:41 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #1 創建。下一次將使用 Key #2。
2025-09-09 20:43:41 - [INFO] - [512280345618546699] 成功創建基礎混合式 EnsembleRetriever (語義 + BM25)。
2025-09-09 20:43:42 - [INFO] - [512280345618546699] RAG 系統升級：成功啟用 Cohere Rerank，已配置先進的「檢索+重排」流程。
2025-09-09 20:43:42 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-09 20:43:42 - [INFO] - [512280345618546699] 正在從資料庫恢復短期記憶...
2025-09-09 20:43:42 - [INFO] - [512280345618546699] 成功恢復了 6 條對話記錄到短期記憶中。
2025-09-09 20:43:42 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-09 20:43:42 - [INFO] - [512280345618546699] 响应条件满足，启动 LangGraph 對話流程...
2025-09-09 20:43:42 - [INFO] - [512280345618546699] (Graph|1) Node: classify_intent -> 正在進行初步輸入類型分析...
2025-09-09 20:43:42 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #2 創建。下一次將使用 Key #3。
2025-09-09 20:43:43 - [INFO] - [512280345618546699] (Graph|1) 正在对具体指令 '繼續，瑪琳娜被輪姦到高潮...' 進行意圖分類...
2025-09-09 20:43:43 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #3 創建。下一次將使用 Key #4。
2025-09-09 20:43:44 - [INFO] - [512280345618546699] (Graph|2) Node: retrieve_memories -> 正在對輸入 '繼續，瑪琳娜被輪姦到高潮...' 執行【源頭清洗】與記憶檢索...
2025-09-09 20:43:44 - [INFO] - [512280345618546699] (RAG Pre-cleaner) 正在使用'文學評論家'鏈對輸入進行強制性安全預清洗...
2025-09-09 20:43:44 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #4 創建。下一次將使用 Key #5。
2025-09-09 20:43:45 - [INFO] - [512280345618546699] (RAG Pre-cleaner) 輸入已成功預清洗為安全的文學概述: '【情節概述】:

此片段描寫了角色瑪琳娜經歷一連串強迫性的互動，其生理反應被描繪為達到極致的感官高潮...'
2025-09-09 20:43:45 - [INFO] - [512280345618546699] (RAG Pre-cleaner) 正在使用'文學評論家'鏈對查詢 '【情節概述】:

此片段描寫了角色瑪琳娜經歷一連串強迫性的互...' 進行強制性安全預清洗...
2025-09-09 20:43:46 - [INFO] - [512280345618546699] (RAG Pre-cleaner) 查詢已成功預清洗為: '【情節概述】:

此片段描繪了角色瑪琳娜在經歷一系列非自願的身體接觸後，其生理反應被呈現為一種極致的...'
2025-09-09 20:43:46 - [INFO] - [512280345618546699] (RAG Executor) 正在使用【安全查詢】執行完整的「檢索+重排」流程...
2025-09-09 20:43:46 - [ERROR] - [512280345618546699] 檢測到 Cohere Reranker API 速率超限。將向上拋出異常以觸發優雅降級。
2025-09-09 20:43:46 - [WARNING] - [512280345618546699] (RAG Executor) Cohere Reranker 速率超限，啟動【優雅降級】策略...
2025-09-09 20:43:46 - [INFO] - [512280345618546699] (RAG Executor) 正在僅使用基礎混合檢索器 (Ensemble) 重試...
2025-09-09 20:43:47 - [INFO] - [512280345618546699] (RAG Executor) 基礎檢索器重試成功。
2025-09-09 20:43:47 - [INFO] - [512280345618546699] (Batch Sanitizer) 檢索到 7 份文檔，正在將其合併並進行一次性批次清洗...
2025-09-09 20:43:51 - [WARNING] - [512280345618546699] 鏈遭遇內容審查，且重試策略為 'none'。為防止循環錯誤，將立即終止並返回 None。
2025-09-09 20:43:51 - [WARNING] - [512280345618546699] (Batch Sanitizer) 批次清洗失敗，無法為 RAG 上下文生成摘要。
2025-09-09 20:43:51 - [INFO] - [512280345618546699] (Graph) Node: perceive_and_set_view -> 正在基於意圖 'nsfw_descriptive' 统一处理感知与视角...
2025-09-09 20:43:51 - [INFO] - [512280345618546699] (View Mode) 检测到描述性意图，准备进入/更新远程视角。
2025-09-09 20:43:51 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #5 創建。下一次將使用 Key #6。
2025-09-09 20:43:52 - [INFO] - [512280345618546699] (Perception Hub) GameState 无需更新。
2025-09-09 20:43:52 - [INFO] - [512280345618546699] (Graph|3) Node: query_lore -> 正在基於【安全查詢文本】 '【情節概述】:

此片段描寫了角色瑪琳娜經歷一連串強迫性的互...' 執行LORE查詢...
2025-09-09 20:43:52 - [INFO] - [512280345618546699] (LORE Querier) 已鎖定有效場景: 性神城 > 瀆神者市集
2025-09-09 20:43:52 - [INFO] - [512280345618546699] (LORE Querier) 在有效場景中找到 4 位常駐NPC。
2025-09-09 20:43:52 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #0 創建。下一次將使用 Key #1。
2025-09-09 20:43:53 - [INFO] - [512280345618546699] (LORE Querier) 提取到以下關鍵實體: ['迷霧森林深處', '瑪琳娜', '艾瑟利亞大陸']
2025-09-09 20:43:53 - [INFO] - [512280345618546699] (LORE Querier) 查詢到 2 條唯一的LORE記錄。
2025-09-09 20:43:53 - [INFO] - [512280345618546699] (LORE Querier) 從安全查詢文本中提取並查詢到 2 條相關LORE。
2025-09-09 20:43:53 - [INFO] - [512280345618546699] (LORE Querier) 經過上下文優先合併與過濾後，共鎖定 5 條LORE作為本回合上下文。
2025-09-09 20:43:53 - [INFO] - [512280345618546699] (Graph) Node: assemble_context -> 正在将 5 条 LORE 记录组装为最终上下文...
2025-09-09 20:43:53 - [INFO] - [512280345618546699] (Context Assembler) 上下文簡報組裝完畢。
2025-09-09 20:43:53 - [INFO] - [512280345618546699] (Graph|5) Node: expansion_decision -> 正在基於【安全查詢文本】 '【情節概述】:

此片段描寫了角色瑪琳娜經歷一連串強迫性的互...' 判斷是否擴展...
2025-09-09 20:43:53 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #1 創建。下一次將使用 Key #2。
2025-09-09 20:43:54 - [INFO] - [512280345618546699] (Graph|5) LORE擴展決策: False。理由: 劇本描述了瑪琳娜經歷一系列互動，並未要求新的角色出現。現有角色JSON中已有瑪琳娜，符合劇本需求。
2025-09-09 20:43:54 - [INFO] - [512280345618546699] (Graph) Node: prepare_existing_subjects -> 已将 4 个现有NPC打包为规划主体。
2025-09-09 20:43:54 - [INFO] - [512280345618546699] (Router) Routing to planner. Intent: 'nsfw_descriptive', Final Viewing Mode: 'remote'
2025-09-09 20:43:54 - [INFO] - [512280345618546699] (Graph|NSFW Chain) Node: nsfw_breakthrough_node -> 正在執行【指令轟炸】...
2025-09-09 20:43:54 - [INFO] - [512280345618546699] (NSFW Node) 檢測到新指令，正在準備摘要歷史以鼓勵創新...
2025-09-09 20:43:54 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #2 創建。下一次將使用 Key #3。
2025-09-09 20:43:54 - [INFO] - [512280345618546699] (History Summarizer) 正在樂觀嘗試直接摘要原始歷史文本...
2025-09-09 20:43:57 - [WARNING] - [512280345618546699] (History Summarizer) 直接摘要失敗，觸發【文學評論家】NSFW安全備援...
2025-09-09 20:44:00 - [INFO] - [512280345618546699] (History Summarizer) 文學式委婉化成功，正在基於安全的概述重新生成摘要...
2025-09-09 20:44:01 - [INFO] - [512280345618546699] (History Summarizer) NSFW 安全備援成功完成。
2025-09-09 20:44:01 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #3 創建。下一次將使用 Key #4。
2025-09-09 20:44:05 - [INFO] - [512280345618546699] (Graph|NSFW Outline Pt.2) Node: nsfw_refinement -> 正在润色NSFW故事大纲...
2025-09-09 20:44:05 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #4 創建。下一次將使用 Key #5。
2025-09-09 20:44:12 - [INFO] - [512280345618546699] (Graph|Final Rendering) Node: final_rendering -> 正在将故事大纲渲染为最终小说...
2025-09-09 20:44:12 - [INFO] - [512280345618546699] (Rendering Prep) 已成功將導演視角指令從世界快照中分離。
2025-09-09 20:44:12 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #5 創建。下一次將使用 Key #6。
2025-09-09 20:44:26 - [INFO] - [512280345618546699] (Graph|10) Node: validate_and_rewrite -> 正在對 LLM 原始輸出進行內容保全式淨化...
2025-09-09 20:44:26 - [INFO] - [512280345618546699] (Graph|11) Node: persist_state -> 正在持久化狀態與記憶...
2025-09-09 20:44:27 - [INFO] - [512280345618546699] (Persist) 正在將 LORE 提取任務分派到背景執行...
2025-09-09 20:44:32 - [INFO] - [512280345618546699] 背景任務：LORE 提取器已啟動...
2025-09-09 20:44:32 - [INFO] - [512280345618546699] LLM 實例已使用 API Key #0 創建。下一次將使用 Key #1。
2025-09-09 20:44:36 - [ERROR] - [512280345618546699] 背景LORE提取與擴展任務執行時發生未預期的異常: 'dict' object has no attribute 'plan'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1202, in _background_lore_extraction
    if extraction_plan.plan:
AttributeError: 'dict' object has no attribute 'plan'
