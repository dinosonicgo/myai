### AI Lover Log - Last updated at 2025-09-28T18:57:19.336761 ###

2025-09-28 16:25:58 - [WARNING] - [512280345618546699] Key #5 (模型: HammerAI/llama-3-lexi-uncensored:latest) 遭遇臨時性 API 錯誤 (InvalidArgument)。將在 2.46 秒後進行第 3 次嘗試...
2025-09-28 16:26:00 - [ERROR] - [512280345618546699] Key #5 (模型: HammerAI/llama-3-lexi-uncensored:latest) 在 3 次內部重試後仍然失敗 (InvalidArgument)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-28 16:26:00 - [WARNING] - [512280345618546699] Key #0 (模型: HammerAI/llama-3-lexi-uncensored:latest) 遭遇臨時性 API 錯誤 (InvalidArgument)。將在 1.30 秒後進行第 2 次嘗試...
2025-09-28 16:26:03 - [WARNING] - [512280345618546699] Key #0 (模型: HammerAI/llama-3-lexi-uncensored:latest) 遭遇臨時性 API 錯誤 (InvalidArgument)。將在 2.23 秒後進行第 3 次嘗試...
2025-09-28 16:26:05 - [ERROR] - [512280345618546699] Key #0 (模型: HammerAI/llama-3-lexi-uncensored:latest) 在 3 次內部重試後仍然失敗 (InvalidArgument)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-28 16:26:05 - [WARNING] - [512280345618546699] Key #1 (模型: HammerAI/llama-3-lexi-uncensored:latest) 遭遇臨時性 API 錯誤 (InvalidArgument)。將在 1.17 秒後進行第 2 次嘗試...
2025-09-28 16:26:06 - [WARNING] - [512280345618546699] Key #1 (模型: HammerAI/llama-3-lexi-uncensored:latest) 遭遇臨時性 API 錯誤 (InvalidArgument)。將在 2.36 秒後進行第 3 次嘗試...
2025-09-28 16:26:09 - [ERROR] - [512280345618546699] Key #1 (模型: HammerAI/llama-3-lexi-uncensored:latest) 在 3 次內部重試後仍然失敗 (InvalidArgument)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-28 16:26:09 - [WARNING] - [512280345618546699] Key #2 (模型: HammerAI/llama-3-lexi-uncensored:latest) 遭遇臨時性 API 錯誤 (InvalidArgument)。將在 1.29 秒後進行第 2 次嘗試...
2025-09-28 16:26:11 - [WARNING] - [512280345618546699] Key #2 (模型: HammerAI/llama-3-lexi-uncensored:latest) 遭遇臨時性 API 錯誤 (InvalidArgument)。將在 2.46 秒後進行第 3 次嘗試...
2025-09-28 16:26:13 - [ERROR] - [512280345618546699] Key #2 (模型: HammerAI/llama-3-lexi-uncensored:latest) 在 3 次內部重試後仍然失敗 (InvalidArgument)。將輪換到下一個金鑰並觸發持久化冷卻。
2025-09-28 16:26:13 - [ERROR] - [512280345618546699] [Final Failure] 所有模型和金鑰均最終失敗。最後的錯誤是: 400 * GenerateContentRequest.model: unexpected model name format

2025-09-28 16:26:13 - [ERROR] - 處理使用者 512280345618546699 的「純粹生成」流程時發生異常: 400 * GenerateContentRequest.model: unexpected model name format
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1507, in on_message
    final_response = await ai_instance.preprocess_and_generate(input_data)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2868, in preprocess_and_generate
    structured_rag_context = await self.retrieve_and_summarize_memories(user_input, relevant_characters, relevant_characters)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4981, in retrieve_and_summarize_memories
    fact_sheet = await self.ainvoke_with_rotation(local_prompt, output_schema=RagFactSheet, models_to_try_override=[self.ollama_model_name])
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 836, in ainvoke_with_rotation
    raise last_exception if last_exception else Exception("ainvoke_with_rotation failed without a specific exception.")
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 753, in ainvoke_with_rotation
    response = await asyncio.wait_for(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 445, in wait_for
    return fut.result()
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\generative_models.py", line 385, in generate_content_async
    response = await self._async_client.generate_content(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\ai\generativelanguage_v1beta\services\generative_service\async_client.py", line 440, in generate_content
    response = await rpc(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\api_core\retry\retry_unary_async.py", line 231, in retry_wrapped_func
    return await retry_target(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\api_core\retry\retry_unary_async.py", line 163, in retry_target
    next_sleep = _retry_error_helper(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\api_core\retry\retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\api_core\retry\retry_unary_async.py", line 158, in retry_target
    return await target()
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\api_core\grpc_helpers_async.py", line 88, in __await__
    raise exceptions.from_grpc_error(rpc_error) from rpc_error
google.api_core.exceptions.InvalidArgument: 400 * GenerateContentRequest.model: unexpected model name format

2025-09-28 16:31:15 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-28 16:31:15 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-28 16:31:15 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-28 16:31:15 - [INFO] - Discord Bot is ready!
2025-09-28 16:31:18 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-28 16:31:18 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-28 16:31:19 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-28 16:31:27 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-28 16:31:27 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-28 16:31:27 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-28 16:31:27 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 126 條文檔到 RAG 語料庫。
2025-09-28 16:31:27 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-28 16:31:27 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-28 16:31:27 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-28 16:31:27 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-28 16:31:27 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-28 16:31:27 - [INFO] - [512280345618546699] 啟動「純粹生成」對話流程...
2025-09-28 16:31:27 - [INFO] - [512280345618546699] [純粹生成流程] 正在準備上下文...
2025-09-28 16:31:27 - [INFO] - [512280345618546699] [指令實體提取] 通過 LORE 字典找到實體: {'米婭'}
2025-09-28 16:31:29 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-28 16:31:29 - [INFO] - [512280345618546699] [上下文篩選 in 'local' mode] 核心目標: ['米婭'], 背景角色: []
2025-09-28 16:31:29 - [INFO] - [512280345618546699] [RAG查詢強化] 查詢已擴展為: '描述米婭在宅邸散步遇到維利爾斯勛爵 Mia 蒙恩者 活神蹟 聖女 母畜 米婭'
2025-09-28 16:31:29 - [INFO] - [512280345618546699] [RAG事實提取-1] 嘗試使用雲端模型處理原始文本...
2025-09-28 16:31:29 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-09-28 16:31:29 - [WARNING] - [512280345618546699] [RAG事實提取-1] 雲端模型審查了原始文本。降級到層級 2 (雲端+代碼化)...
2025-09-28 16:31:30 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #2) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-09-28 16:31:30 - [ERROR] - [512280345618546699] [RAG事實提取-2] 🔥 代碼化備援失敗: Prompt blocked due to PROHIBITED_CONTENT
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4973, in retrieve_and_summarize_memories
    fact_sheet = await self.ainvoke_with_rotation(full_prompt, output_schema=RagFactSheet, retry_strategy='none')
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 791, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 762, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4981, in retrieve_and_summarize_memories
    fact_sheet = await self.ainvoke_with_rotation(full_prompt, output_schema=RagFactSheet, retry_strategy='none')
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 791, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 762, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
2025-09-28 16:31:30 - [WARNING] - [512280345618546699] [RAG事實提取] 所有雲端策略均失敗。降級到層級 3 (本地模型)...
2025-09-28 16:31:30 - [INFO] - [512280345618546699] [RAG事實提取-3] 正在使用本地模型 'HammerAI/llama-3-lexi-uncensored:latest' 進行事實提取...
2025-09-28 16:33:49 - [ERROR] - [512280345618546699] [RAG事實提取-3] 呼叫本地模型進行事實提取時發生未知錯誤: 12 validation errors for RagFactSheet
involved_characters.0
  Input should be a valid string [type=string_type, input_value={'name': '米婭', 'descr...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.1
  Input should be a valid string [type=string_type, input_value={'name': '莉莉絲', 'de...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.2
  Input should be a valid string [type=string_type, input_value={'name': '絲月', 'descr...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.3
  Input should be a valid string [type=string_type, input_value={'name': '卡萊兒', 'de...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.4
  Input should be a valid string [type=string_type, input_value={'name': '莉娜', 'descr...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.5
  Input should be a valid string [type=string_type, input_value={'name': '安娜', 'descr...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
key_locations.0
  Input should be a valid string [type=string_type, input_value={'name': '維利爾斯家...邸', 'description': ''}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
key_locations.1
  Input should be a valid string [type=string_type, input_value={'name': '貧民窟', 'description': ''}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
key_locations.2
  Input should be a valid string [type=string_type, input_value={'name': '聖露修道院', 'description': ''}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
core_events.0
  Input should be a valid string [type=string_type, input_value={'event_name': '', 'descr...聖女與活神蹟。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
core_events.1
  Input should be a valid string [type=string_type, input_value={'event_name': '', 'descr...澤的完美容器。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
core_events.2
  Input should be a valid string [type=string_type, input_value={'event_name': '', 'descr...誕下聖女米婭。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4773, in _invoke_local_ollama_summarizer
    validated_result = RagFactSheet.model_validate(parsed_json)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 12 validation errors for RagFactSheet
involved_characters.0
  Input should be a valid string [type=string_type, input_value={'name': '米婭', 'descr...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.1
  Input should be a valid string [type=string_type, input_value={'name': '莉莉絲', 'de...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.2
  Input should be a valid string [type=string_type, input_value={'name': '絲月', 'descr...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.3
  Input should be a valid string [type=string_type, input_value={'name': '卡萊兒', 'de...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.4
  Input should be a valid string [type=string_type, input_value={'name': '莉娜', 'descr...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
involved_characters.5
  Input should be a valid string [type=string_type, input_value={'name': '安娜', 'descr...性', 'race': '人類'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
key_locations.0
  Input should be a valid string [type=string_type, input_value={'name': '維利爾斯家...邸', 'description': ''}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
key_locations.1
  Input should be a valid string [type=string_type, input_value={'name': '貧民窟', 'description': ''}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
key_locations.2
  Input should be a valid string [type=string_type, input_value={'name': '聖露修道院', 'description': ''}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
core_events.0
  Input should be a valid string [type=string_type, input_value={'event_name': '', 'descr...聖女與活神蹟。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
core_events.1
  Input should be a valid string [type=string_type, input_value={'event_name': '', 'descr...澤的完美容器。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
core_events.2
  Input should be a valid string [type=string_type, input_value={'event_name': '', 'descr...誕下聖女米婭。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-09-28 16:33:49 - [ERROR] - [512280345618546699] [RAG事實提取-4] 所有提取層級均失敗！
2025-09-28 16:33:49 - [INFO] - [512280345618546699] [AI導演] 正在啟動導演決策模組...
2025-09-28 16:33:51 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #3.
2025-09-28 16:33:51 - [INFO] - [512280345618546699] [AI導演] 決策完成。最終劇本大綱: '米婭在埃德蒙王國王都的「咆哮壁爐酒館」平民區的昏暗光線中，空氣中混雜著廉價麥酒、煙燻木材和汗水的味道。她正在酒館中觀察著工匠、學徒和小市民們的互動，傾聽著他們關於貧民窟那位能創造奇蹟的「生命之神」的傳聞，這些傳聞正被不斷扭曲、放大，成為酒客們熱衷的談資。突然，她被一個聲音打斷了，是卡爾•維利爾斯勳爵。他帶著一抹玩味的笑容，目光在米婭身上遊移，似乎對她出現在這樣一個地方感到些許意外，又似乎早已預料到。勳爵開口，聲音帶著他特有的、令人難以捉摸的磁性，他問米婭為何會出現在這裡，語氣中帶著一絲不容置疑的權威，但同時也隱藏著一絲探究的意味。米婭需要回應勳爵的詢問，同時要保持她聖女和蒙恩者的身份，並對勳爵的出現做出反應。請描寫米婭的反應以及她與勳爵的對話，展現出兩人之間微妙的權力關係和各自的立場。'
2025-09-28 16:33:51 - [INFO] - [512280345618546699] [純粹生成流程] 正在執行小說生成...
2025-09-28 16:34:30 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #4.
2025-09-28 16:34:31 - [INFO] - [512280345618546699] [純粹生成流程] 小說文本生成成功，並已為事後分析創建詳細上下文快照。
2025-09-28 16:34:31 - [INFO] - [512280345618546699] 回應已發送。正在啟動統一的「事後分析」任務...
2025-09-28 16:34:33 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析任務...
2025-09-28 16:34:35 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-09-28 16:34:35 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #5) 遭遇解析或驗證錯誤: ValidationError。
2025-09-28 16:34:35 - [ERROR] - [512280345618546699] [事後分析] 任務主體發生未預期的異常: 3 validation errors for PostGenerationAnalysisResult
lore_updates.0.tool_name
  Field required [type=missing, input_value={'tool_code': 'update_npc...是為了勳爵。'}]}}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
lore_updates.1.tool_name
  Field required [type=missing, input_value={'tool_code': 'update_npc...眾人的注意。'}]}}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
lore_updates.2.tool_name
  Field required [type=missing, input_value={'tool_code': 'update_wor...婭的行為相關。'}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1355, in _background_lore_extraction
    analysis_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 802, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 783, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 3 validation errors for PostGenerationAnalysisResult
lore_updates.0.tool_name
  Field required [type=missing, input_value={'tool_code': 'update_npc...是為了勳爵。'}]}}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
lore_updates.1.tool_name
  Field required [type=missing, input_value={'tool_code': 'update_npc...眾人的注意。'}]}}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
lore_updates.2.tool_name
  Field required [type=missing, input_value={'tool_code': 'update_wor...婭的行為相關。'}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-28 16:34:55 - [INFO] - [512280345618546699] [撤銷] 已成功從場景 '512280345618546699_local_埃德蒙王國_王都_咆哮壁爐酒館' 的短期記憶中撤銷上一回合。
2025-09-28 16:34:55 - [INFO] - [512280345618546699] [撤銷-後端] 正在嘗試從資料庫刪除最新一條長期記憶...
2025-09-28 16:34:56 - [INFO] - [512280345618546699] [撤銷-後端] ✅ 成功刪除 ID 為 1 的長期記憶。
2025-09-28 16:34:56 - [INFO] - [512280345618546699] [撤銷] 處於DM頻道，跳過刪除使用者訊息的步驟。
2025-09-28 16:39:03 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-28 16:39:03 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-28 16:39:03 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-28 16:39:03 - [INFO] - Discord Bot is ready!
2025-09-28 16:39:06 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-28 16:39:06 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-28 16:39:07 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-28 16:39:14 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-28 16:39:14 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-28 16:39:14 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-28 16:39:14 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 126 條文檔到 RAG 語料庫。
2025-09-28 16:39:14 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-28 16:39:14 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-28 16:39:14 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-28 16:39:14 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-28 16:39:14 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 3 條訊息。
2025-09-28 16:39:16 - [INFO] - [512280345618546699] 啟動「純粹生成」對話流程...
2025-09-28 16:39:16 - [INFO] - [512280345618546699] [純粹生成流程] 正在準備上下文...
2025-09-28 16:39:16 - [INFO] - [512280345618546699] [指令實體提取] 通過 LORE 字典找到實體: {'米婭'}
2025-09-28 16:39:17 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-28 16:39:17 - [INFO] - [512280345618546699] [上下文篩選 in 'local' mode] 核心目標: ['米婭'], 背景角色: []
2025-09-28 16:39:17 - [INFO] - [512280345618546699] [RAG查詢強化] 查詢已擴展為: '描述米婭在宅邸散步遇到維利爾斯勛爵 Mia 蒙恩者 活神蹟 聖女 米婭 母畜'
2025-09-28 16:39:17 - [INFO] - [512280345618546699] [RAG事實提取-1] 快速嘗試：雲端模型...
2025-09-28 16:39:18 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-09-28 16:39:18 - [WARNING] - [512280345618546699] [RAG事實提取-1] 雲端模型因內容審查快速失敗。立即轉向層級 2 (本地無審查核心)...
2025-09-28 16:39:18 - [INFO] - [512280345618546699] [RAG事實提取-3] 正在使用本地模型 'HammerAI/llama-3-lexi-uncensored:latest' 進行事實提取...
2025-09-28 16:39:53 - [INFO] - [512280345618546699] [RAG事實提取-3] ✅ 本地模型事實清單提取成功。
2025-09-28 16:39:53 - [INFO] - [512280345618546699] [RAG事實提取] ✅ 成功提取事實清單。
2025-09-28 16:39:53 - [INFO] - [512280345618546699] [AI導演] 正在啟動導演決策模組...
2025-09-28 16:39:54 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-09-28 16:39:54 - [INFO] - [512280345618546699] [AI導演] 決策完成。最終劇本大綱: '故事的核心場景發生在埃德蒙王國王都的咆哮壁爐酒館。米婭，一位被稱為「聖女」、「母畜」、「蒙恩者」、「活神蹟」的角色，出現在這間充滿市井氣息、空氣混雜著廉價麥酒、煙燻木材和汗水的酒館中。酒館光線昏暗，僅靠中央的石製壁爐和油燈照明。這裡是工匠、學徒和小市民的聚集地，關於貧民窟那位能創造奇蹟的「生命之神」的傳聞正在酒館中被熱烈討論。米婭在酒館中散步，預計將遇到卡萊兒。'
2025-09-28 16:39:54 - [INFO] - [512280345618546699] [純粹生成流程] 正在執行小說生成...
2025-09-28 16:40:37 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-28 16:40:39 - [INFO] - [512280345618546699] [純粹生成流程] 小說文本生成成功，並已為事後分析創建詳細上下文快照。
2025-09-28 16:40:39 - [INFO] - [512280345618546699] 回應已發送。正在啟動統一的「事後分析」任務...
2025-09-28 16:40:41 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析任務...
2025-09-28 16:40:44 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-28 16:40:44 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-28 16:40:44 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-09-28 16:40:44 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-28 16:40:44 - [INFO] - [512280345618546699] [事後分析] 背景分析與處理任務完成。
2025-09-28 16:45:28 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-28 16:45:28 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-28 16:45:29 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-28 16:45:29 - [INFO] - Discord Bot is ready!
2025-09-28 16:45:31 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-28 16:45:31 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-28 16:45:32 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-28 16:45:39 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-28 16:45:39 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-28 16:45:39 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-28 16:45:39 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 126 條文檔到 RAG 語料庫。
2025-09-28 16:45:39 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-28 16:45:39 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-28 16:45:39 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-28 16:45:39 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-28 16:45:39 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 5 條訊息。
2025-09-28 16:45:39 - [INFO] - [512280345618546699] [撤銷] 已成功從場景 '512280345618546699_local_埃德蒙王國_王都_咆哮壁爐酒館' 的短期記憶中撤銷上一回合。
2025-09-28 16:45:39 - [INFO] - [512280345618546699] [撤銷-後端] 正在嘗試從資料庫刪除最新一條長期記憶...
2025-09-28 16:45:39 - [INFO] - [512280345618546699] [撤銷-後端] ✅ 成功刪除 ID 為 32 的長期記憶。
2025-09-28 16:45:40 - [INFO] - [512280345618546699] [撤銷] 處於DM頻道，跳過刪除使用者訊息的步驟。
2025-09-28 16:45:46 - [INFO] - [512280345618546699] 啟動「純粹生成」對話流程...
2025-09-28 16:45:46 - [INFO] - [512280345618546699] [純粹生成流程] 正在準備上下文...
2025-09-28 16:45:46 - [INFO] - [512280345618546699] [指令實體提取] 通過 LORE 字典找到實體: {'米婭'}
2025-09-28 16:45:47 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-28 16:45:47 - [INFO] - [512280345618546699] [上下文篩選 in 'local' mode] 核心目標: ['米婭'], 背景角色: []
2025-09-28 16:45:47 - [INFO] - [512280345618546699] [RAG查詢強化] 查詢已擴展為: '描述米婭在宅邸散步遇到維利爾斯勛爵 Mia 蒙恩者 活神蹟 米婭 母畜 聖女'
2025-09-28 16:45:47 - [INFO] - [512280345618546699] [RAG事實提取-1] 快速嘗試：雲端模型...
2025-09-28 16:45:48 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-09-28 16:45:48 - [WARNING] - [512280345618546699] [RAG事實提取-1] 雲端模型因內容審查快速失敗。立即轉向層級 2 (本地無審查核心)...
2025-09-28 16:45:48 - [INFO] - [512280345618546699] [RAG事實提取-3] 正在使用本地模型 'HammerAI/llama-3-lexi-uncensored:latest' 進行事實提取...
2025-09-28 16:47:28 - [INFO] - [512280345618546699] [RAG事實提取-3] ✅ 本地模型事實清單提取成功。
2025-09-28 16:47:28 - [INFO] - [512280345618546699] [RAG事實提取] ✅ 成功提取事實清單。
2025-09-28 16:47:28 - [INFO] - [512280345618546699] [AI導演] 正在啟動導演決策模組...
2025-09-28 16:47:34 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-09-28 16:47:34 - [INFO] - [512280345618546699] [AI導演] 決策完成。最終劇本大綱: '故事的核心場景嚴格設定在維利爾斯家宅邸。以米婭在宅邸內散步時，突然與卡爾•維利爾斯勳爵相遇為開端。根據她作為『母畜』的身份和必須遵守的『母畜的禮儀』（此處無特殊規則，但基於其身份，應有相應的服從姿態），她必須向她的主人展現順從。在擴寫此場景時，應詳細描寫宅邸的環境，並可以適當融入她對過去事件的回憶，例如在貧民窟或聖露修道院的經歷，但故事地點絕不能偏離宅邸。長期記憶中關於『咆哮壁爐酒館』的提及，由於與使用者指令設定的『宅邸』地點衝突，應被忽略。'
2025-09-28 16:47:34 - [INFO] - [512280345618546699] [純粹生成流程] 正在執行小說生成...
2025-09-28 16:48:17 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-28 16:48:18 - [INFO] - [512280345618546699] [純粹生成流程] 小說文本生成成功，並已為事後分析創建詳細上下文快照。
2025-09-28 16:48:19 - [INFO] - [512280345618546699] 回應已發送。正在啟動統一的「事後分析」任務...
2025-09-28 16:48:21 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析任務...
2025-09-28 16:48:24 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-28 16:48:24 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-09-28 16:48:24 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-09-28 16:48:24 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-09-28 16:48:24 - [INFO] - [512280345618546699] [事後分析] 背景分析與處理任務完成。
