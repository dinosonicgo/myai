### AI Lover Log - Last updated at 2025-10-03T19:47:25.832879 ###

  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\urllib3\connectionpool.py", line 488, in _make_request
    raise new_e
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\urllib3\connectionpool.py", line 466, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=conn.timeout)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\urllib3\connectionpool.py", line 367, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPSConnectionPool(host='hf-mirror.com', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4233, in _create_embeddings_instance
    embeddings = HuggingFaceEmbeddings(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_core\_api\deprecation.py", line 215, in warn_if_direct_instance
    return wrapped(self, *args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\langchain_community\embeddings\huggingface.py", line 79, in __init__
    self.client = sentence_transformers.SentenceTransformer(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sentence_transformers\SentenceTransformer.py", line 205, in __init__
    modules = self._load_auto_model(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sentence_transformers\SentenceTransformer.py", line 1197, in _load_auto_model
    transformer_model = Transformer(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sentence_transformers\models\Transformer.py", line 36, in __init__
    self._load_model(model_name_or_path, config, cache_dir, **model_args)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sentence_transformers\models\Transformer.py", line 65, in _load_model
    self.auto_model = AutoModel.from_pretrained(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\transformers\models\auto\auto_factory.py", line 563, in from_pretrained
    return model_class.from_pretrained(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\transformers\modeling_utils.py", line 3415, in from_pretrained
    if not has_file(pretrained_model_name_or_path, safe_weights_name, **has_file_kwargs):
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\transformers\utils\hub.py", line 629, in has_file
    r = requests.head(url, headers=headers, allow_redirects=False, proxies=proxies, timeout=10)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\requests\api.py", line 100, in head
    return request("head", url, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\requests\adapters.py", line 713, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPSConnectionPool(host='hf-mirror.com', port=443): Read timed out. (read timeout=10)
2025-10-03 19:15:58 - [ERROR] -    -> 請確保 `torch`, `transformers` 和 `sentence-transformers` 已正確安裝。
2025-10-03 19:15:58 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-03 19:15:58 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-03 19:15:58 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-03 19:15:59 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 19:19:29 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-03 19:19:36 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-03 19:19:43 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-03 19:19:44 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-03 19:19:44 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 19:19:47 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-03 19:20:50 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 19:20:50 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 19:20:50 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 19:20:50 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 19:20:50 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 19:20:50 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 19:20:50 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 19:20:50 - [INFO] - Discord Bot is ready!
2025-10-03 19:20:53 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 19:20:53 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 19:20:53 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 19:22:04 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 19:22:04 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 19:22:04 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 19:22:04 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 19:22:04 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 19:22:04 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 19:22:04 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 19:22:04 - [INFO] - Discord Bot is ready!
2025-10-03 19:22:07 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 19:22:07 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 19:22:07 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 19:22:19 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-03 19:22:19 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-03 19:22:19 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-03 19:22:19 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-03 19:22:19 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-03 19:22:19 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-03 19:22:20 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-03 19:22:24 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-03 19:22:25 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-03 19:22:25 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-03 19:22:25 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-03 19:22:25 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-03 19:22:25 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-03 19:22:26 - [WARNING] - ⚠️ [Embedding Loader] 從本地路徑 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載模型失敗: SentenceTransformer.__init__() got an unexpected keyword argument 'requests_kwargs'
2025-10-03 19:22:26 - [WARNING] -    -> 將回退到從網路下載的備援方案。
2025-10-03 19:22:26 - [ERROR] - [512280345618546699] 為臨時實例配置前置資源時失敗: name 'os' is not defined
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1213, in get_or_create_ai_instance
    await ai_instance._configure_pre_requisites()
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4149, in _configure_pre_requisites
    self.embeddings = self._create_embeddings_instance()
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4254, in _create_embeddings_instance
    logger.info(f"⏳ [Embedding Loader] 正在嘗試從網路 ({os.environ.get('HF_ENDPOINT', 'Hugging Face Hub')}) 下載模型 '{model_name_on_hub}'...")
NameError: name 'os' is not defined
2025-10-03 19:22:26 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-03 19:22:26 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-03 19:22:26 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 19:25:16 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 19:25:16 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 19:25:16 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 19:25:16 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 19:25:16 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 19:25:16 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 19:25:17 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 19:25:17 - [INFO] - Discord Bot is ready!
2025-10-03 19:25:19 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 19:25:19 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 19:25:20 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 19:25:30 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-03 19:25:30 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-03 19:25:30 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-03 19:25:31 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-03 19:25:31 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-03 19:25:31 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-03 19:25:33 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-03 19:25:38 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-03 19:25:39 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-03 19:25:39 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-03 19:25:39 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-03 19:25:39 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-03 19:25:39 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-03 19:25:47 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-03 19:25:47 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-03 19:25:47 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-03 19:25:47 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-03 19:25:47 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 19:27:40 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-03 19:27:49 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-03 19:27:50 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-03 19:27:50 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 19:27:56 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-03 19:28:09 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-10-03 19:28:09 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-10-03 19:28:09 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 19:28:11 - [INFO] - [512280345618546699] [創世流程] 檔案上傳開始，已設定 active_setups 狀態鎖。
2025-10-03 19:28:27 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-03 19:28:30 - [INFO] - [512280345618546699] [創世流程 v64.0] Graph 驅動的流程已啟動。
2025-10-03 19:28:30 - [INFO] - [512280345618546699] [後台創世] 正在將世界聖經原文分割成文檔...
2025-10-03 19:28:30 - [INFO] - [512280345618546699] [後台創世] 正在觸發 RAG 索引創始構建...
2025-10-03 19:28:30 - [INFO] - [512280345618546699] (Retriever Builder) 進入外部文檔注入模式，將使用 34 條傳入文檔構建純向量索引...
2025-10-03 19:29:09 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 純向量檢索器已成功從外部文檔構建。
2025-10-03 19:29:09 - [INFO] - [512280345618546699] [後台創世] RAG 索引構建完成，準備執行創世圖...
2025-10-03 19:29:09 - [INFO] - [512280345618546699] (Setup Graph|2/4) Node: complete_profiles_node -> 節點已啟動，準備補完角色檔案...
2025-10-03 19:29:11 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-03 19:29:12 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-10-03 19:29:12 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-10-03 19:29:12 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 19:29:12 - [INFO] - [512280345618546699] (Setup Graph|2/4) Node: complete_profiles_node -> 節點執行成功。
2025-10-03 19:29:12 - [INFO] - [512280345618546699] (Setup Graph|3/4) Node: world_genesis -> 節點已啟動...
2025-10-03 19:29:15 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-10-03 19:29:15 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-10-03 19:29:16 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 19:29:16 - [INFO] - [512280345618546699] [/start] 初始地點 '王國 > 王都 > 維利爾斯莊園 > 莊園領地邊緣的森林 > 一座被遺忘的古老神龕' 已成功生成並存入LORE。
2025-10-03 19:29:16 - [INFO] - [512280345618546699] (Setup Graph|3/4) Node: world_genesis -> 節點執行成功。
2025-10-03 19:29:16 - [INFO] - [512280345618546699] (Setup Graph|4/4) Node: generate_opening_scene -> 節點已啟動...
2025-10-03 19:29:16 - [INFO] - [512280345618546699] [/start] 正在使用 RAG 智能選擇開場場景...
2025-10-03 19:29:16 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 19:29:16 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 19:29:16 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 19:29:16 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 19:29:16 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 19:29:16 - [INFO] -   [最終 summary_context 長度]: 19121
2025-10-03 19:29:16 - [INFO] - --- RAG 流程結束 ---
2025-10-03 19:29:44 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-10-03 19:29:44 - [INFO] - [512280345618546699] (Setup Graph|4/4) Node: generate_opening_scene -> 節點執行成功。
2025-10-03 19:29:45 - [INFO] - [512280345618546699] [後台創世] 正在向使用者私訊發送最終開場白...
2025-10-03 19:29:46 - [INFO] - [512280345618546699] [後台創世] 開場白發送完畢。
2025-10-03 19:29:46 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-03 19:30:15 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-03 19:30:15 - [INFO] - [512280345618546699] [Direct RAG] 啟動純粹 RAG 直通生成流程...
2025-10-03 19:30:15 - [INFO] - [512280345618546699] [Direct RAG] 正在執行 RAG 檢索...
2025-10-03 19:30:16 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 19:30:16 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 19:30:16 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 19:30:16 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 19:30:16 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 19:30:16 - [INFO] -   [最終 summary_context 長度]: 18899
2025-10-03 19:30:16 - [INFO] - --- RAG 流程結束 ---
2025-10-03 19:30:16 - [ERROR] - 處理使用者 512280345618546699 的 RAG 直通流程時發生異常: name '_get_summarized_chat_history' is not defined
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1354, in on_message
    final_response = await ai_instance.direct_rag_generate(user_input)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 287, in direct_rag_generate
    historical_context = await _get_summarized_chat_history(self, user_id)
NameError: name '_get_summarized_chat_history' is not defined
2025-10-03 19:32:51 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 19:32:51 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 19:32:51 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 19:32:51 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 19:32:51 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 19:32:51 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 19:32:52 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 19:32:52 - [INFO] - Discord Bot is ready!
2025-10-03 19:32:54 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 19:32:54 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 19:32:55 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 19:32:58 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-03 19:32:58 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-10-03 19:32:58 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-03 19:32:58 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-03 19:32:58 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-03 19:33:00 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-03 19:33:00 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-03 19:33:00 - [INFO] - [512280345618546699] (Retriever Builder) 檢測到現有 RAG 索引，正在加載...
2025-10-03 19:33:00 - [WARNING] - [512280345618546699] (Retriever Builder) BM25 持久化檔案不存在或加載失敗，將從 ChromaDB 中恢復 BM25 專用語料庫。
2025-10-03 19:33:00 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 混合檢索器已成功從持久化索引加載。
2025-10-03 19:33:00 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-10-03 19:33:00 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-10-03 19:33:00 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-03 19:33:00 - [INFO] - [512280345618546699] [Direct RAG] 啟動純粹 RAG 直通生成流程...
2025-10-03 19:33:00 - [INFO] - [512280345618546699] [Direct RAG] 正在執行 RAG 檢索...
2025-10-03 19:33:01 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 21 條文檔 ---
2025-10-03 19:33:01 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 21 條原始文檔 ---
2025-10-03 19:33:01 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 21 條原始文檔作為 summary_context。
2025-10-03 19:33:01 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 19:33:01 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 19:33:01 - [INFO] -   [最終 summary_context 長度]: 19935
2025-10-03 19:33:01 - [INFO] - --- RAG 流程結束 ---
2025-10-03 19:33:03 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-03 19:33:03 - [INFO] - [512280345618546699] [Direct RAG] Prompt 組裝完畢，正在調用 LLM 生成...
2025-10-03 19:33:46 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #1.
2025-10-03 19:33:46 - [INFO] - [512280345618546699] [Direct RAG] 生成流程完成。
2025-10-03 19:33:48 - [ERROR] - [512280345618546699] [事後分析] 接收到的上下文快照不完整，缺少關鍵數據。
2025-10-03 19:33:48 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
2025-10-03 19:36:58 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-03 19:36:58 - [INFO] - [512280345618546699] [Direct RAG] 啟動純粹 RAG 直通生成流程...
2025-10-03 19:36:58 - [INFO] - [512280345618546699] [Direct RAG] 正在執行 RAG 檢索...
2025-10-03 19:36:58 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 19:36:58 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 19:36:58 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 19:36:58 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 19:36:58 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 19:36:58 - [INFO] -   [最終 summary_context 長度]: 18897
2025-10-03 19:36:58 - [INFO] - --- RAG 流程結束 ---
2025-10-03 19:37:01 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-10-03 19:37:01 - [INFO] - [512280345618546699] [Direct RAG] Prompt 組裝完畢，正在調用 LLM 生成...
2025-10-03 19:37:37 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-10-03 19:37:37 - [INFO] - [512280345618546699] [Direct RAG] 生成流程完成。
2025-10-03 19:37:37 - [ERROR] - [512280345618546699] [事後分析] 接收到的上下文快照不完整，缺少關鍵數據。
2025-10-03 19:37:38 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
2025-10-03 19:42:08 - [INFO] - 正在編譯主對話圖 (main_graph)...
2025-10-03 19:42:08 - [INFO] - ✅ 主對話圖編譯成功。
2025-10-03 19:42:08 - [INFO] - 正在編譯創世流程圖 (setup_graph)...
2025-10-03 19:42:08 - [INFO] - ✅ 創世流程圖編譯成功。
2025-10-03 19:42:08 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 19:42:08 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 19:42:09 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 19:42:09 - [INFO] - Discord Bot is ready!
2025-10-03 19:42:11 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 19:42:11 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 19:42:12 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 19:44:21 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-03 19:44:21 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-10-03 19:44:21 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-03 19:44:21 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-03 19:44:21 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-03 19:44:28 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-03 19:44:28 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-03 19:44:28 - [INFO] - [512280345618546699] (Retriever Builder) 檢測到現有 RAG 索引，正在加載...
2025-10-03 19:44:28 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 34 條文檔到 RAG 語料庫。
2025-10-03 19:44:28 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 混合檢索器已成功從持久化索引加載。
2025-10-03 19:44:28 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-10-03 19:44:28 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 5 條訊息。
2025-10-03 19:44:28 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-03 19:44:28 - [INFO] - [512280345618546699] [Direct RAG] 啟動純粹 RAG 直通生成流程...
2025-10-03 19:44:28 - [INFO] - [512280345618546699] [Direct RAG] 正在執行 RAG 檢索...
2025-10-03 19:44:30 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 19 條文檔 ---
2025-10-03 19:44:30 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 19 條原始文檔 ---
2025-10-03 19:44:30 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 19 條原始文檔作為 summary_context。
2025-10-03 19:44:30 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 19:44:30 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 19:44:30 - [INFO] -   [最終 summary_context 長度]: 17897
2025-10-03 19:44:30 - [INFO] - --- RAG 流程結束 ---
2025-10-03 19:44:32 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-03 19:44:32 - [INFO] - [512280345618546699] [Direct RAG] Prompt 組裝完畢，正在調用 LLM 生成...
2025-10-03 19:45:08 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #1.
2025-10-03 19:45:08 - [INFO] - [512280345618546699] [Direct RAG] 生成流程完成。
2025-10-03 19:45:08 - [ERROR] - [512280345618546699] [事後分析] 接收到的上下文快照不完整，缺少關鍵數據。
2025-10-03 19:45:09 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
2025-10-03 19:46:14 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-03 19:46:14 - [INFO] - [512280345618546699] [Direct RAG] 啟動純粹 RAG 直通生成流程...
2025-10-03 19:46:14 - [INFO] - [512280345618546699] [Direct RAG] 正在執行 RAG 檢索...
2025-10-03 19:46:14 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 19 條文檔 ---
2025-10-03 19:46:14 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 19 條原始文檔 ---
2025-10-03 19:46:14 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 19 條原始文檔作為 summary_context。
2025-10-03 19:46:14 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 19:46:14 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 19:46:14 - [INFO] -   [最終 summary_context 長度]: 18156
2025-10-03 19:46:14 - [INFO] - --- RAG 流程結束 ---
2025-10-03 19:46:16 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-10-03 19:46:16 - [INFO] - [512280345618546699] [Direct RAG] Prompt 組裝完畢，正在調用 LLM 生成...
2025-10-03 19:46:44 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-10-03 19:46:44 - [INFO] - [512280345618546699] [Direct RAG] 生成流程完成。
2025-10-03 19:46:44 - [ERROR] - [512280345618546699] [事後分析] 接收到的上下文快照不完整，缺少關鍵數據。
2025-10-03 19:46:45 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
