### AI Lover Log - Last updated at 2025-10-05T00:15:30.848694 ###

2025-10-04 23:25:44 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '抓著碧，深喉嚨口交...' 中分析實體...
2025-10-04 23:25:44 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-04 23:25:45 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:25:45 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['碧']
2025-10-04 23:25:45 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-04 23:25:45 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '抓著碧，深喉嚨口交...' 中分析實體...
2025-10-04 23:25:45 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-04 23:25:46 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:25:46 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['碧']
2025-10-04 23:25:46 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-04 23:25:46 - [INFO] - [512280345618546699] [RAG 原文直通] 查詢已擴展為: '抓著碧，深喉嚨口交 DINO 碧'
2025-10-04 23:25:47 - [INFO] - [512280345618546699] [RAG 原文直通] 粗略檢索成功，獲得 18 份候選文檔。
2025-10-04 23:25:47 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 18 條原始文檔作為 summary_context。
2025-10-04 23:25:47 - [ERROR] - 處理使用者 512280345618546699 的 RAG 直通流程時發生異常: 'AILover' object has no attribute 'DECODING_MAP'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\cogs\core_cog.py", line 698, in on_message
    final_response = await ai_instance.direct_rag_generate(user_input)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 482, in direct_rag_generate
    rag_context_dict = await self.retrieve_and_summarize_memories(user_input)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 5917, in retrieve_and_summarize_memories
    final_summary = self._decode_lore_content(summary_context, self.DECODING_MAP)
AttributeError: 'AILover' object has no attribute 'DECODING_MAP'
2025-10-04 23:28:47 - [INFO] - 正在加載核心 Cog (core_cog)...
2025-10-04 23:28:50 - [INFO] - ✅ 核心 Cog (core_cog) 已加載，並且所有持久化視圖已成功註冊。
2025-10-04 23:28:50 - [INFO] - ✅ 核心 Cog 加載成功。
2025-10-04 23:28:50 - [INFO] - 正在全域同步應用程式指令...
2025-10-04 23:28:50 - [INFO] - ✅ 指令已全域同步！
2025-10-04 23:28:50 - [INFO] - Discord Bot setup hook finished!
2025-10-04 23:28:53 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-04 23:28:53 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-04 23:30:43 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-04 23:30:43 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-10-04 23:30:43 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-04 23:30:43 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-04 23:30:43 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-04 23:30:45 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-04 23:30:45 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-04 23:30:45 - [INFO] - [512280345618546699] (Retriever Builder) 檢測到現有 RAG 索引，正在加載...
2025-10-04 23:30:45 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 34 條文檔到 RAG 語料庫。
2025-10-04 23:30:45 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 混合檢索器已成功從持久化索引加載。
2025-10-04 23:30:45 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-10-04 23:30:45 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 3 條訊息。
2025-10-04 23:30:46 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-04 23:30:46 - [INFO] - [512280345618546699] [Direct RAG] 啟動 LORE 優先的 RAG 直通生成流程...
2025-10-04 23:30:46 - [INFO] - [512280345618546699] [LORE 擴展] 正在檢查是否需要擴展 LORE...
2025-10-04 23:30:47 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:30:48 - [INFO] - [512280345618546699] [LORE 擴展] 無需擴展新的 LORE。
2025-10-04 23:30:48 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '抓著碧，深喉嚨口交...' 中分析實體...
2025-10-04 23:30:48 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-04 23:30:48 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:30:48 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['碧']
2025-10-04 23:30:48 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-04 23:30:48 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '抓著碧，深喉嚨口交...' 中分析實體...
2025-10-04 23:30:48 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-04 23:30:49 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:30:49 - [INFO] - [512280345618546699] [輸入分析-L1] ✅ LLM 分析成功。提取實體: ['碧']
2025-10-04 23:30:49 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-04 23:30:49 - [INFO] - [512280345618546699] [RAG 原文直通] 查詢已擴展為: '抓著碧，深喉嚨口交 DINO 碧'
2025-10-04 23:30:50 - [INFO] - [512280345618546699] [RAG 原文直通] 粗略檢索成功，獲得 18 份候選文檔。
2025-10-04 23:30:50 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 18 條原始文檔作為 summary_context。
2025-10-04 23:30:52 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:31:26 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #0.
2025-10-04 23:31:27 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
2025-10-04 23:31:28 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析與分流任務...
2025-10-04 23:31:30 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:31:30 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-10-04 23:31:31 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-10-04 23:31:31 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-10-04 23:31:33 - [INFO] - [512280345618546699] 背景任務：檢測到 1 條預生成LORE，準備執行...
2025-10-04 23:31:33 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 1 個修正後的LORE任务 ---
2025-10-04 23:31:33 - [WARNING] - [512280345618546699] [抗幻覺] 檢測到對不存在實體 '未知實體' 的更新。啟動事實查核...
2025-10-04 23:31:34 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:31:34 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇解析或驗證錯誤: JSONDecodeError。啟動【自我修正】流程...
2025-10-04 23:31:34 - [WARNING] - [512280345618546699] 導致解析錯誤的原始 LLM 輸出: 
--- START RAW ---
```json
{
  "decision": "IGNORE",
  "reasoning": "對話上下文為空，且現有實體數據庫為空。無法從任何來源找到關於'未知實體'的資訊，因此不滿足創建、合併或忽略的任何條件。",
  "matched_key": null
}
```
--- END RAW ---
2025-10-04 23:31:34 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-04 23:31:34 - [INFO] - [512280345618546699] [自我修正] ✅ 修正流程成功，正在重新驗證...
2025-10-04 23:31:34 - [WARNING] - [512280345618546699] [抗幻覺] 事實查核裁定為 IGNORE。已跳過操作。理由: 對話上下文為空，且現有實體數據庫為空。無法從任何來源找到關於'未知實體'的資訊，因此不滿足創建、合併或忽略的任何條件。
2025-10-04 23:31:34 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-10-04 23:31:34 - [INFO] - [512280345618546699] 背景任務：LORE更新執行完畢。摘要: LORE 扩展已执行。
2025-10-04 23:31:34 - [INFO] - [512280345618546699] [事後分析] 背景分析與分流任務完成。
2025-10-04 23:49:41 - [INFO] - 正在加載核心 Cog (core_cog)...
2025-10-04 23:49:44 - [INFO] - ✅ 核心 Cog (core_cog) 已加載，並且所有持久化視圖已成功註冊。
2025-10-04 23:49:44 - [INFO] - ✅ 核心 Cog 加載成功。
2025-10-04 23:49:44 - [INFO] - 正在全域同步應用程式指令...
2025-10-04 23:49:45 - [INFO] - ✅ 指令已全域同步！
2025-10-04 23:49:45 - [INFO] - Discord Bot setup hook finished!
2025-10-04 23:49:48 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-04 23:49:48 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-05 00:00:50 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-05 00:00:50 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-10-05 00:00:50 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-05 00:00:50 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-05 00:00:50 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-05 00:00:52 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-05 00:00:52 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-05 00:00:52 - [INFO] - [512280345618546699] (Retriever Builder) 檢測到現有 RAG 索引，正在加載...
2025-10-05 00:00:52 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 34 條文檔到 RAG 語料庫。
2025-10-05 00:00:52 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 混合檢索器已成功從持久化索引加載。
2025-10-05 00:00:52 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-10-05 00:00:52 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 5 條訊息。
2025-10-05 00:02:50 - [INFO] - 正在加載核心 Cog (core_cog)...
2025-10-05 00:02:53 - [INFO] - ✅ 核心 Cog (core_cog) 已加載，並且所有持久化視圖已成功註冊。
2025-10-05 00:02:53 - [INFO] - ✅ 核心 Cog 加載成功。
2025-10-05 00:02:53 - [INFO] - 正在全域同步應用程式指令...
2025-10-05 00:02:53 - [INFO] - ✅ 指令已全域同步！
2025-10-05 00:02:53 - [INFO] - Discord Bot setup hook finished!
2025-10-05 00:02:56 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-05 00:02:57 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-05 00:03:35 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-05 00:03:35 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-10-05 00:03:35 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-05 00:03:35 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-05 00:03:35 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-05 00:03:37 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-05 00:03:37 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-05 00:03:37 - [INFO] - [512280345618546699] (Retriever Builder) 檢測到現有 RAG 索引，正在加載...
2025-10-05 00:03:37 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 34 條文檔到 RAG 語料庫。
2025-10-05 00:03:37 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 混合檢索器已成功從持久化索引加載。
2025-10-05 00:03:37 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-10-05 00:03:37 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 5 條訊息。
2025-10-05 00:03:41 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['response_style_prompt']
2025-10-05 00:03:41 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-05 00:08:45 - [INFO] - 正在加載核心 Cog (core_cog)...
2025-10-05 00:08:48 - [INFO] - ✅ 核心 Cog (core_cog) 已加載，並且所有持久化視圖已成功註冊。
2025-10-05 00:08:48 - [INFO] - ✅ 核心 Cog 加載成功。
2025-10-05 00:08:48 - [INFO] - 正在全域同步應用程式指令...
2025-10-05 00:08:49 - [INFO] - ✅ 指令已全域同步！
2025-10-05 00:08:49 - [INFO] - Discord Bot setup hook finished!
2025-10-05 00:08:51 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-05 00:08:52 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-05 00:09:19 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-05 00:09:19 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-10-05 00:09:19 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-05 00:09:19 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-05 00:09:19 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-05 00:09:21 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-05 00:09:21 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-05 00:09:21 - [INFO] - [512280345618546699] (Retriever Builder) 檢測到現有 RAG 索引，正在加載...
2025-10-05 00:09:21 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 34 條文檔到 RAG 語料庫。
2025-10-05 00:09:21 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 混合檢索器已成功從持久化索引加載。
2025-10-05 00:09:21 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-10-05 00:09:21 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 5 條訊息。
2025-10-05 00:09:21 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-05 00:09:21 - [INFO] - [512280345618546699] [Direct RAG] 啟動 LORE 優先的 RAG 直通生成流程...
2025-10-05 00:09:21 - [INFO] - [512280345618546699] [LORE 擴展] 正在檢查是否需要擴展 LORE...
2025-10-05 00:09:23 - [ERROR] - [512280345618546699] 在 ainvoke 期間發生未知錯誤 (模型: gemini-2.5-flash-lite): 'RepeatedComposite' object has no attribute 'finish_reason'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:09:23 - [ERROR] - [512280345618546699] [LORE 擴展] 在前置 LORE 擴展管線中發生錯誤: 'RepeatedComposite' object has no attribute 'finish_reason'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 415, in direct_rag_generate
    expansion_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1499, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:09:23 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '描述米婭在宅邸遇到勛爵...' 中分析實體...
2025-10-05 00:09:23 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-05 00:09:23 - [ERROR] - [512280345618546699] 在 ainvoke 期間發生未知錯誤 (模型: gemini-2.5-flash-lite): 'RepeatedComposite' object has no attribute 'finish_reason'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:09:23 - [WARNING] - [512280345618546699] [輸入分析-L1] 🔥 LLM 分析失敗 (AttributeError)。降級至 L2 (雙引擎程式化備援)...
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2459, in _analyze_user_input
    analysis_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1499, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:09:25 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-05 00:09:25 - [INFO] - [512280345618546699] [實體名稱提取] 正在從查詢 '描述米婭在宅邸遇到勛爵...' 中分析實體...
2025-10-05 00:09:25 - [INFO] - [512280345618546699] [輸入分析-L1] 正在嘗試使用 LLM 進行語義分析...
2025-10-05 00:09:26 - [ERROR] - [512280345618546699] 在 ainvoke 期間發生未知錯誤 (模型: gemini-2.5-flash-lite): 'RepeatedComposite' object has no attribute 'finish_reason'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:09:26 - [WARNING] - [512280345618546699] [輸入分析-L1] 🔥 LLM 分析失敗 (AttributeError)。降級至 L2 (雙引擎程式化備援)...
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2459, in _analyze_user_input
    analysis_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1499, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:09:27 - [INFO] - [512280345618546699] [實體名稱提取] 查詢分析完成，共識別出 2 個核心實體: ['DINO', '碧']。
2025-10-05 00:09:27 - [INFO] - [512280345618546699] [RAG 原文直通] 查詢已擴展為: '描述米婭在宅邸遇到勛爵 DINO 碧'
2025-10-05 00:09:28 - [INFO] - [512280345618546699] [RAG 原文直通] 粗略檢索成功，獲得 21 份候選文檔。
2025-10-05 00:09:28 - [INFO] - [512280345618546699] [RAG 原文直通] ✅ 成功拼接全部 21 條原始文檔作為 summary_context。
2025-10-05 00:09:30 - [ERROR] - [512280345618546699] 在 ainvoke 期間發生未知錯誤 (模型: gemini-2.5-flash-lite): 'RepeatedComposite' object has no attribute 'finish_reason'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:09:30 - [ERROR] - [512280345618546699] (History Summarizer) 生成摘要時發生錯誤: 'RepeatedComposite' object has no attribute 'finish_reason'。返回中性提示。
2025-10-05 00:09:31 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #0) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-05 00:09:31 - [WARNING] - [512280345618546699] 最終生成鏈遭遇審查。啟動【最高指令集注入 & 強制 Key 輪換重試】策略...
2025-10-05 00:09:31 - [INFO] - [512280345618546699] [強制重試] 已準備 3 個備用 API Keys 進行重試。
2025-10-05 00:09:31 - [INFO] - [512280345618546699] [強制重試 1/3] 使用 API Key #0 進行嘗試...
2025-10-05 00:09:33 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #0) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-05 00:09:33 - [WARNING] - [512280345618546699] [強制重試 1/3] 使用 Key #0 的嘗試失敗: Prompt blocked due to 4
2025-10-05 00:09:33 - [INFO] -    -> 將在 0.5 秒後使用下一個 Key 進行嘗試...
2025-10-05 00:09:34 - [INFO] - [512280345618546699] [強制重試 2/3] 使用 API Key #1 進行嘗試...
2025-10-05 00:09:36 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #1) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-05 00:09:36 - [WARNING] - [512280345618546699] [強制重試 2/3] 使用 Key #1 的嘗試失敗: Prompt blocked due to 4
2025-10-05 00:09:36 - [INFO] -    -> 將在 1.0 秒後使用下一個 Key 進行嘗試...
2025-10-05 00:09:37 - [INFO] - [512280345618546699] [強制重試 3/3] 使用 API Key #2 進行嘗試...
2025-10-05 00:09:39 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #2) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-05 00:09:39 - [WARNING] - [512280345618546699] [強制重試 3/3] 使用 Key #2 的嘗試失敗: Prompt blocked due to 4
2025-10-05 00:09:39 - [ERROR] - [512280345618546699] 【強制 Key 輪換重試】策略在 3 次嘗試後最終失敗。
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1371, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {reason_str}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to 4

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3042, in _force_and_retry
    return await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1428, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1371, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {reason_str}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to 4
2025-10-05 00:09:39 - [CRITICAL] - [512280345618546699] [Direct RAG] 核心生成链在所有策略之後最終失敗！
2025-10-05 00:09:40 - [INFO] - [512280345618546699] RAG 直通流程執行完畢，回應已發送。事後學習任務已在背景啟動。
2025-10-05 00:09:41 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析與分流任務...
2025-10-05 00:09:43 - [ERROR] - [512280345618546699] 在 ainvoke 期間發生未知錯誤 (模型: gemini-2.5-flash-lite): 'RepeatedComposite' object has no attribute 'finish_reason'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:09:43 - [ERROR] - [512280345618546699] [事後分析] 任務主體發生未預期的異常: 'RepeatedComposite' object has no attribute 'finish_reason'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2067, in _background_lore_extraction
    analysis_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1499, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1374, in ainvoke_with_rotation
    finish_reason = response.candidates.finish_reason
AttributeError: 'RepeatedComposite' object has no attribute 'finish_reason'
2025-10-05 00:14:37 - [INFO] - 正在加載核心 Cog (core_cog)...
2025-10-05 00:14:40 - [INFO] - ✅ 核心 Cog (core_cog) 已加載，並且所有持久化視圖已成功註冊。
2025-10-05 00:14:40 - [INFO] - ✅ 核心 Cog 加載成功。
2025-10-05 00:14:40 - [INFO] - 正在全域同步應用程式指令...
2025-10-05 00:14:41 - [INFO] - ✅ 指令已全域同步！
2025-10-05 00:14:41 - [INFO] - Discord Bot setup hook finished!
2025-10-05 00:14:43 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-05 00:14:44 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-05 00:15:16 - [INFO] - 正在加載核心 Cog (core_cog)...
2025-10-05 00:15:19 - [INFO] - ✅ 核心 Cog (core_cog) 已加載，並且所有持久化視圖已成功註冊。
2025-10-05 00:15:19 - [INFO] - ✅ 核心 Cog 加載成功。
2025-10-05 00:15:19 - [INFO] - 正在全域同步應用程式指令...
2025-10-05 00:15:20 - [INFO] - ✅ 指令已全域同步！
2025-10-05 00:15:20 - [INFO] - Discord Bot setup hook finished!
2025-10-05 00:15:22 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-05 00:15:23 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-05 00:15:25 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-05 00:15:25 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-10-05 00:15:25 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-05 00:15:25 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-05 00:15:26 - [INFO] - ✅ [Embedding Loader] 檢測到本地模型路徑，正在嘗試從 'D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\models\stella-base-zh-v2' 加載...
2025-10-05 00:15:27 - [INFO] - ✅ [Embedding Loader] 本地 Embedding 模型實例創建成功。
2025-10-05 00:15:27 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-05 00:15:27 - [INFO] - [512280345618546699] (Retriever Builder) 檢測到現有 RAG 索引，正在加載...
2025-10-05 00:15:28 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 34 條文檔到 RAG 語料庫。
2025-10-05 00:15:28 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 混合檢索器已成功從持久化索引加載。
2025-10-05 00:15:28 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-10-05 00:15:28 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 7 條訊息。
2025-10-05 00:15:29 - [INFO] - [512280345618546699] 啟動 RAG 直通對話流程...
2025-10-05 00:15:29 - [INFO] - [512280345618546699] [Direct RAG] 啟動 LORE 優先的 RAG 直通生成流程...
2025-10-05 00:15:29 - [INFO] - [512280345618546699] [LORE 擴展] 正在檢查是否需要擴展 LORE...
2025-10-05 00:15:30 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-05 00:15:30 - [INFO] - [512280345618546699] [LORE 擴展] ✅ 檢測到新實體，正在創建骨架檔案...
2025-10-05 00:15:30 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 2 個實體...
2025-10-05 00:15:30 - [ERROR] - [512280345618546699] [實體解析] 批量實體解析鏈執行時發生未知嚴重錯誤: 'AILover' object has no attribute 'batch_entity_resolution_chain'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 589, in _resolve_and_save
    resolution_prompt_template = self.get_batch_entity_resolution_prompt()
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2606, in get_batch_entity_resolution_prompt
    if self.batch_entity_resolution_chain is None:
AttributeError: 'AILover' object has no attribute 'batch_entity_resolution_chain'. Did you mean: 'get_batch_entity_resolution_prompt'?
2025-10-05 00:15:30 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 1 個實體...
