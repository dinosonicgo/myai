### AI Lover Log - Last updated at 2025-09-23T19:35:47.573213 ###

2025-09-23 16:26:57 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '奧斯華 (Oswald)' 的 LORE。
2025-09-23 16:27:16 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '艾諾拉 (Eleanor)' 的 LORE。
2025-09-23 16:27:38 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '漢德瑞克師傅 (Master Hendrick)' 的 LORE。
2025-09-23 16:28:18 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '瑪莉' 的 LORE。
2025-09-23 16:28:58 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '愛莉莎' 的 LORE。
2025-09-23 16:29:22 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '安娜' 的 LORE。
2025-09-23 16:29:48 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '瑪莉' 的 LORE。
2025-09-23 16:30:24 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '愛莉莎' 的 LORE。
2025-09-23 16:30:53 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '安娜' 的 LORE。
2025-09-23 16:31:32 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '薩格納將軍' 的 LORE。
2025-09-23 16:31:55 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '菲利普•薩格納' 的 LORE。
2025-09-23 16:32:23 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '克拉拉' 的 LORE。
2025-09-23 18:31:29 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 18:31:29 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 18:31:29 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 18:31:29 - [INFO] - Discord Bot is ready!
2025-09-23 18:31:32 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 18:31:32 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 18:31:32 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 18:32:13 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 18:32:13 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 18:32:13 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 18:32:13 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 843 條文檔用於構建 BM25。
2025-09-23 18:32:13 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 18:32:13 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 18:32:13 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 18:32:13 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 18:32:13 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 18:32:14 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 18:32:14 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 18:32:14 - [INFO] - [512280345618546699] [終極LORE解析流程] 啟動...
2025-09-23 18:32:14 - [WARNING] - [512280345618546699] 未在世界聖經中找到明確的 'PART 2' 分隔符，將嘗試將整個文本作為角色資訊處理。
2025-09-23 18:32:14 - [INFO] - [512280345618546699] [LORE解析] 本地預處理完成，提取到 0 個角色的初步數據。
2025-09-23 18:32:14 - [WARNING] - [512280345618546699] 未能從世界聖經中預解析出任何角色資訊。
2025-09-23 18:41:20 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 18:41:20 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 18:41:20 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 18:41:20 - [INFO] - Discord Bot is ready!
2025-09-23 18:41:23 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 18:41:23 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 18:41:24 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 18:42:12 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 18:42:12 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 18:42:12 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 18:42:12 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 843 條文檔用於構建 BM25。
2025-09-23 18:42:13 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 18:42:13 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 18:42:13 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 18:42:13 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 18:42:13 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 18:42:13 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 18:42:13 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 18:42:14 - [INFO] - [512280345618546699] [終極LORE解析流程] 啟動...
2025-09-23 18:42:14 - [INFO] - [512280345618546699] [LORE解析 1/3] 正在使用LLM進行實體骨架提取...
2025-09-23 18:42:29 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 18:42:29 - [ERROR] - [512280345618546699] 在處理文本塊 7 的實體提取時發生錯誤: Prompt blocked due to PROHIBITED_CONTENT
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2120, in parse_and_create_lore_from_canon
    extraction_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
2025-09-23 18:42:29 - [INFO] - [512280345618546699] [LORE解析 1/3] 實體骨架提取完成，發現 71 個獨立角色。
2025-09-23 18:42:35 - [INFO] - [512280345618546699] [LORE解析 2/3] 正在對 71 個角色進行深度精煉...
2025-09-23 19:15:18 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:15:18 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:15:19 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:15:19 - [INFO] - Discord Bot is ready!
2025-09-23 19:15:21 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:15:21 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:15:22 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 19:16:06 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 19:16:06 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 19:16:06 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 19:16:06 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 860 條文檔用於構建 BM25。
2025-09-23 19:16:06 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 19:16:06 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 19:16:06 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 19:16:06 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 19:16:06 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 19:16:06 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 19:16:07 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 19:16:07 - [INFO] - [512280345618546699] [LORE解析階段1/2] 開始粗提取，生成LORE骨架...
2025-09-23 19:16:07 - [INFO] - [512280345618546699] 世界聖經已被分割成 7 個文本塊進行處理...
2025-09-23 19:16:07 - [INFO] - [512280345618546699] 正在處理文本塊 1/7...
2025-09-23 19:16:19 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 19 個實體...
2025-09-23 19:16:19 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 3 個實體...
2025-09-23 19:16:19 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:16:21 - [INFO] - [512280345618546699] 文本塊 1 的 LORE 已成功儲存。
2025-09-23 19:16:21 - [INFO] - [512280345618546699] 正在處理文本塊 2/7...
2025-09-23 19:16:30 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:16:30 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 5 個實體...
2025-09-23 19:16:30 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 10 個實體...
2025-09-23 19:16:33 - [INFO] - [512280345618546699] 文本塊 2 的 LORE 已成功儲存。
2025-09-23 19:16:33 - [INFO] - [512280345618546699] 正在處理文本塊 3/7...
2025-09-23 19:16:54 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 2 個實體...
2025-09-23 19:16:54 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-23 19:16:54 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:16:55 - [INFO] - [512280345618546699] 文本塊 3 的 LORE 已成功儲存。
2025-09-23 19:16:55 - [INFO] - [512280345618546699] 正在處理文本塊 4/7...
2025-09-23 19:17:12 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:17:12 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'creature_info' 類別處理 1 個實體...
2025-09-23 19:17:12 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 29 個實體...
2025-09-23 19:17:17 - [INFO] - [512280345618546699] 文本塊 4 的 LORE 已成功儲存。
2025-09-23 19:17:17 - [INFO] - [512280345618546699] 正在處理文本塊 5/7...
2025-09-23 19:17:25 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 19:17:25 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 7 個實體...
2025-09-23 19:17:25 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 14 個實體...
2025-09-23 19:17:28 - [INFO] - [512280345618546699] 文本塊 5 的 LORE 已成功儲存。
2025-09-23 19:17:28 - [INFO] - [512280345618546699] 正在處理文本塊 6/7...
2025-09-23 19:17:41 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 18 個實體...
2025-09-23 19:17:41 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:17:41 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 24 個實體...
2025-09-23 19:17:46 - [INFO] - [512280345618546699] 文本塊 6 的 LORE 已成功儲存。
2025-09-23 19:17:46 - [INFO] - [512280345618546699] 正在處理文本塊 7/7...
2025-09-23 19:17:46 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:17:46 - [WARNING] - [512280345618546699] 文本塊 7 遭遇內容審查 (BlockedPromptException)。啟動【終極解構-重構】策略...
2025-09-23 19:17:46 - [INFO] - [512280345618546699] [解構成功] 已提取情報關鍵詞: ['布魯諾', 'ACTION-B', '米婭', '索菲亞', 'ROLE-D', '菲利普', '瓦勒留斯', '索菲亞 (Sophia)', '巴納比', 'CODE-M-GEN-A', 'STATE-A', '布里奇特', '夏卡爾', '卡蓮', '安布羅斯 (Ambrose)', '漢德瑞克師傅 (Master Hendrick)', '安布羅斯', '馬庫斯', '卡蓮 (Karen)', '艾諾拉 (Eleanor)', '艾莉諾', 'CODE-F-GEN-A', 'ACTION-E', '諾拉', '艾莉諾 (Eleanor)', '布魯諾 (Bruno)', '瓦萊麗', '菲利普 (Philip)', '薩格納', '布里奇特 (Bridget)', '馬庫斯 (Marcus)', '巴納比 (Barnaby)', '艾諾拉', '漢德瑞克師傅', '奧斯華 (Oswald)', '瓦萊麗 (Valerie)', '奧斯華', '瓦勒留斯 (Valerius)']
2025-09-23 19:18:41 - [INFO] - [512280345618546699] [重構成功] 已成功根據關鍵詞還原出 LORE。
2025-09-23 19:18:41 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 19:18:41 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 1 個實體...
2025-09-23 19:18:44 - [INFO] - [512280345618546699] 文本塊 7 的 LORE 已成功儲存。
2025-09-23 19:18:44 - [INFO] - [512280345618546699] [LORE解析階段1/2] 粗提取完成。總共 7 個文本塊，成功處理 7 個。
2025-09-23 19:18:44 - [INFO] - [512280345618546699] 正在啟動背景任務以進行 LORE 細節精煉...
2025-09-23 19:23:28 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:23:28 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:23:29 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:23:29 - [INFO] - Discord Bot is ready!
2025-09-23 19:23:31 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:23:31 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:23:32 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 19:24:06 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 19:24:06 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 19:24:06 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 19:24:06 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 902 條文檔用於構建 BM25。
2025-09-23 19:24:07 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 19:24:07 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 19:24:07 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 19:24:07 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 19:24:07 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 19:24:07 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 19:24:07 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 19:24:08 - [INFO] - [512280345618546699] [LORE解析階段1/2] 開始粗提取，生成LORE骨架...
2025-09-23 19:24:08 - [INFO] - [512280345618546699] 世界聖經已被分割成 7 個文本塊進行處理...
2025-09-23 19:24:08 - [INFO] - [512280345618546699] 正在處理文本塊 1/7...
2025-09-23 19:24:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 19 個實體...
2025-09-23 19:24:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:24:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:24:23 - [INFO] - [512280345618546699] 文本塊 1 的 LORE 已成功儲存。
2025-09-23 19:24:23 - [INFO] - [512280345618546699] 正在處理文本塊 2/7...
2025-09-23 19:24:36 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇解析或驗證錯誤: JSONDecodeError。
2025-09-23 19:24:36 - [WARNING] - [512280345618546699] 文本塊 2 遭遇格式或驗證錯誤 (JSONDecodeError)。啟動【模型升級攻堅】...
2025-09-23 19:25:34 - [INFO] - [512280345618546699] [攻堅成功] 已成功使用升級模型修復格式錯誤。
2025-09-23 19:25:34 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:25:34 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 5 個實體...
2025-09-23 19:25:34 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 7 個實體...
2025-09-23 19:25:39 - [INFO] - [512280345618546699] 文本塊 2 的 LORE 已成功儲存。
2025-09-23 19:25:39 - [INFO] - [512280345618546699] 正在處理文本塊 3/7...
2025-09-23 19:25:47 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 2 個實體...
2025-09-23 19:25:47 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-23 19:25:47 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:25:48 - [INFO] - [512280345618546699] 文本塊 3 的 LORE 已成功儲存。
2025-09-23 19:25:48 - [INFO] - [512280345618546699] 正在處理文本塊 4/7...
2025-09-23 19:26:01 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:26:01 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 1 個實體...
2025-09-23 19:26:01 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'creature_info' 類別處理 1 個實體...
2025-09-23 19:26:01 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'quest' 類別處理 1 個實體...
2025-09-23 19:26:01 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 28 個實體...
2025-09-23 19:26:06 - [INFO] - [512280345618546699] 文本塊 4 的 LORE 已成功儲存。
2025-09-23 19:26:06 - [INFO] - [512280345618546699] 正在處理文本塊 5/7...
2025-09-23 19:26:17 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 19:26:17 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 3 個實體...
2025-09-23 19:26:17 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 15 個實體...
2025-09-23 19:26:20 - [INFO] - [512280345618546699] 文本塊 5 的 LORE 已成功儲存。
2025-09-23 19:26:20 - [INFO] - [512280345618546699] 正在處理文本塊 6/7...
2025-09-23 19:26:31 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 23 個實體...
2025-09-23 19:26:31 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:26:31 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 9 個實體...
2025-09-23 19:26:35 - [INFO] - [512280345618546699] 文本塊 6 的 LORE 已成功儲存。
2025-09-23 19:26:35 - [INFO] - [512280345618546699] 正在處理文本塊 7/7...
2025-09-23 19:26:35 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:26:35 - [WARNING] - [512280345618546699] 文本塊 7 遭遇內容審查 (BlockedPromptException)。啟動【上下文保留式代碼替換】策略...
2025-09-23 19:26:35 - [INFO] - [512280345618546699] [上下文保留成功] 已生成無害化文本塊進行重構。
2025-09-23 19:26:37 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #2) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:26:37 - [ERROR] - [512280345618546699] 【上下文保留式代碼替換】策略最終失敗: BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2030, in parse_and_create_lore_from_canon
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2063, in parse_and_create_lore_from_canon
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
2025-09-23 19:26:37 - [INFO] - [512280345618546699] [LORE解析階段1/2] 粗提取完成。總共 7 個文本塊，成功處理 6 個。
2025-09-23 19:26:37 - [INFO] - [512280345618546699] 正在啟動背景任務以進行 LORE 細節精煉...
2025-09-23 19:29:49 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:29:49 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:29:50 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:29:50 - [INFO] - Discord Bot is ready!
2025-09-23 19:29:52 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:29:52 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:29:53 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 19:30:07 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 915 條文檔用於構建 BM25。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 19:30:07 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 19:30:08 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 19:30:08 - [INFO] - [512280345618546699] [LORE解析階段1/2] 開始粗提取，生成LORE骨架...
2025-09-23 19:30:08 - [INFO] - [512280345618546699] 世界聖經已被分割成 7 個文本塊進行處理...
2025-09-23 19:30:08 - [INFO] - [512280345618546699] 正在處理文本塊 1/7...
2025-09-23 19:30:22 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 19 個實體...
2025-09-23 19:30:22 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:30:22 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:30:24 - [INFO] - [512280345618546699] 文本塊 1 的 LORE 已成功儲存。
2025-09-23 19:30:24 - [INFO] - [512280345618546699] 正在處理文本塊 2/7...
2025-09-23 19:30:39 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:30:39 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 6 個實體...
2025-09-23 19:30:39 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'quest' 類別處理 3 個實體...
2025-09-23 19:30:39 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 35 個實體...
2025-09-23 19:30:45 - [INFO] - [512280345618546699] 文本塊 2 的 LORE 已成功儲存。
2025-09-23 19:30:45 - [INFO] - [512280345618546699] 正在處理文本塊 3/7...
2025-09-23 19:30:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 2 個實體...
2025-09-23 19:30:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-23 19:30:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:30:58 - [INFO] - [512280345618546699] 文本塊 3 的 LORE 已成功儲存。
2025-09-23 19:30:58 - [INFO] - [512280345618546699] 正在處理文本塊 4/7...
2025-09-23 19:31:07 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:31:07 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'creature_info' 類別處理 1 個實體...
2025-09-23 19:31:07 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 4 個實體...
2025-09-23 19:31:10 - [INFO] - [512280345618546699] 文本塊 4 的 LORE 已成功儲存。
2025-09-23 19:31:10 - [INFO] - [512280345618546699] 正在處理文本塊 5/7...
2025-09-23 19:31:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 19:31:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:31:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 9 個實體...
2025-09-23 19:31:24 - [INFO] - [512280345618546699] 文本塊 5 的 LORE 已成功儲存。
2025-09-23 19:31:24 - [INFO] - [512280345618546699] 正在處理文本塊 6/7...
2025-09-23 19:31:38 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 25 個實體...
2025-09-23 19:31:38 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 7 個實體...
2025-09-23 19:31:38 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 14 個實體...
2025-09-23 19:31:42 - [INFO] - [512280345618546699] 文本塊 6 的 LORE 已成功儲存。
2025-09-23 19:31:42 - [INFO] - [512280345618546699] 正在處理文本塊 7/7...
2025-09-23 19:31:43 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:31:43 - [WARNING] - [512280345618546699] 文本塊 7 遭遇內容審查 (BlockedPromptException)。啟動【上下文保留式代碼替換】策略...
2025-09-23 19:31:43 - [INFO] - [512280345618546699] [上下文保留成功] 已生成無害化文本塊進行重構。
2025-09-23 19:31:45 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #1) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:31:45 - [ERROR] - [512280345618546699] 【上下文保留式代碼替換】策略最終失敗: BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2030, in parse_and_create_lore_from_canon
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2060, in parse_and_create_lore_from_canon
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
2025-09-23 19:31:45 - [INFO] - [512280345618546699] [LORE解析階段1/2] 粗提取完成。總共 7 個文本塊，成功處理 6 個。
2025-09-23 19:31:45 - [INFO] - [512280345618546699] 正在啟動背景任務以進行 LORE 細節精煉...
2025-09-23 19:31:45 - [ERROR] - [512280345618546699] 背景處理世界聖經時發生錯誤: 'AILover' object has no attribute '_background_lore_refinement'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1162, in _background_process_canon
    await ai_instance.parse_and_create_lore_from_canon(content_text)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2114, in parse_and_create_lore_from_canon
    asyncio.create_task(self._background_lore_refinement(canon_text))
AttributeError: 'AILover' object has no attribute '_background_lore_refinement'
2025-09-23 19:35:33 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:35:33 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:35:33 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:35:33 - [INFO] - Discord Bot is ready!
2025-09-23 19:35:36 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:35:36 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:35:37 - [INFO] - 已成功發送啟動成功通知給管理員。
