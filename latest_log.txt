### AI Lover Log - Last updated at 2025-10-03T14:07:45.415573 ###

2025-10-03 07:32:37 - [INFO] -   [最終 summary_context 長度]: 19078
2025-10-03 07:32:37 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:32:37 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:32:38 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:32:38 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:32:38 - [INFO] -   [最終 summary_context 長度]: 19029
2025-10-03 07:32:38 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:32:38 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:32:38 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:32:38 - [INFO] -   [最終 summary_context 長度]: 19152
2025-10-03 07:32:38 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:32:38 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:32:38 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:32:38 - [INFO] -   [最終 summary_context 長度]: 19104
2025-10-03 07:32:38 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:32:38 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:32:38 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:32:38 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:32:38 - [INFO] -   [最終 summary_context 長度]: 19129
2025-10-03 07:32:38 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:32:38 - [INFO] - [512280345618546699] [LORE精煉-L1] 正在嘗試使用雲端模型 (gemini-2.5-flash-lite) 進行完整精煉...
2025-10-03 07:32:38 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #3) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-03 07:32:38 - [WARNING] - [512280345618546699] [LORE精煉-L1] 雲端完整精煉被審查 (Prompt blocked due to 4)。降級至 L2 (本地模型)。
2025-10-03 07:32:38 - [INFO] - [512280345618546699] [LORE精煉-本地] 正在使用本地模型 'HammerAI/llama-3-lexi-uncensored:latest' 為角色 '勳爵' 進行精煉...
2025-10-03 07:33:07 - [ERROR] - [512280345618546699] [LORE精煉-本地] 🔥 呼叫本地Ollama進行精煉時發生未知錯誤: 1 validation error for CharacterProfile
age
  Input should be a valid string [type=string_type, input_value=35, input_type=int]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2977, in _invoke_local_ollama_refiner
    validated_result = CharacterProfile.model_validate(parsed_json)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 568, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for CharacterProfile
age
  Input should be a valid string [type=string_type, input_value=35, input_type=int]
    For further information visit https://errors.pydantic.dev/2.8/v/string_type
2025-10-03 07:33:07 - [WARNING] - [512280345618546699] [LORE精煉-L3] L1和L2均失敗。啟動雲端『分治法』數據搶救...
2025-10-03 07:33:07 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #4) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-03 07:33:07 - [WARNING] - [512280345618546699] 內部鏈意外遭遇審查。啟動【通用化解構-重構】策略...
2025-10-03 07:33:07 - [ERROR] - [512280345618546699] (Euphemizer) 在失敗的 Prompt 中找不到任何可供消毒的已知內容標記，無法執行委婉化。
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [LORE精煉-L3] ✅ 成功搶救 'description' 數據。
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [單體精煉] ✅ 驗證通過，成功為角色 '勳爵' 生成精煉檔案。
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [數據一致性] 正在重新加載 LORE 數據以確保獲取最新版本...
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [前置解析] 完成。已為 3 個核心角色準備好高質量 LORE。
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [上下文篩選] 觸發「指令優先原則」，將指令中提及的角色設為核心目標。
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [上下文篩選 in 'local' mode] 核心目標: ['米婭', '宅邸', '勳爵'], 背景角色: []
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [RAG查詢強化] 查詢已擴展為: 'Lord Karl Veriers 描述米婭在宅邸遇到勳爵 卡爾•維利爾斯勳爵 維利爾斯家宅邸 Jasper Bane Leo Tom 賈斯伯 瑪琳娜 米婭 湯姆 班恩 勳爵 宅邸 里奧'
2025-10-03 07:33:10 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:33:10 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:33:10 - [INFO] - --- [RAG 透明度日誌 Step 3/4] 根據核心角色篩選後剩餘 17 條文檔 ---
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 17 條原始文檔作為 summary_context。
2025-10-03 07:33:10 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:33:10 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:33:10 - [INFO] -   [最終 summary_context 長度]: 15927
2025-10-03 07:33:10 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [動態注入] ✅ 已將 3 條即時解析的 LORE 注入 RAG 上下文。
2025-10-03 07:33:10 - [INFO] - [512280345618546699] [API Key Cooling] 跳過冷卻中的 API Key #0 (針對模型 gemini-2.5-pro，剩餘 53887 秒)。
2025-10-03 07:33:45 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #1.
2025-10-03 07:33:45 - [INFO] - [512280345618546699] [純粹生成流程] 小說文本生成成功，並已為事後分析創建包含 3 條完整LORE的上下文快照。
2025-10-03 07:33:46 - [INFO] - [512280345618546699] 回應已發送。正在啟動統一的「事後分析」任務...
2025-10-03 07:33:48 - [INFO] - [512280345618546699] [事後分析] 正在啟動背景分析任務...
2025-10-03 07:33:51 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-10-03 07:33:51 - [INFO] - [512280345618546699] [長期記憶寫入] 正在保存預生成的安全摘要...
2025-10-03 07:33:51 - [INFO] - [512280345618546699] [長期記憶寫入] 互動記錄已成功保存到 SQL 資料庫。
2025-10-03 07:33:51 - [INFO] - [512280345618546699] [長期記憶寫入] 安全摘要保存完畢。
2025-10-03 07:33:53 - [INFO] - [512280345618546699] 背景任務：檢測到 3 條預生成LORE，準備執行...
2025-10-03 07:33:53 - [INFO] - --- [512280345618546699] (LORE Executor) 開始串行執行 3 個修正後的LORE任务 ---
2025-10-03 07:33:53 - [WARNING] - [512280345618546699] [抗幻覺] 檢測到對不存在實體 '米婭' 的更新。啟動事實查核...
2025-10-03 07:33:54 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #3.
2025-10-03 07:33:54 - [INFO] - [512280345618546699] [抗幻覺] 事實查核裁定為 CREATE。正在創建新的 LORE...
2025-10-03 07:33:54 - [WARNING] - [512280345618546699] [抗幻覺] 檢測到對不存在實體 '卡爾•維利爾斯勳爵' 的更新。啟動事實查核...
2025-10-03 07:33:56 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-10-03 07:33:56 - [INFO] - [512280345618546699] [抗幻覺] 事實查核裁定為 CREATE。正在創建新的 LORE...
2025-10-03 07:33:56 - [ERROR] - [512280345618546699] (LORE Executor) 任務失敗: for update_lore_template_keys: 1 validation error for UpdateLoreTemplateKeysArgs
lore_category
  Field required [type=missing, input_value={'lore_key': '宅邸 > ...s': ['宅邸 > 米婭']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2738, in _execute_tool_call_plan
    validated_args = tool_to_execute.args_schema.model_validate(call.parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 568, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for UpdateLoreTemplateKeysArgs
lore_category
  Field required [type=missing, input_value={'lore_key': '宅邸 > ...s': ['宅邸 > 米婭']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
2025-10-03 07:33:56 - [INFO] - --- [512280345618546699] (LORE Executor) LORE 扩展計畫执行完毕 ---
2025-10-03 07:33:56 - [INFO] - [512280345618546699] 背景任務：LORE更新執行完畢。摘要: 任務成功 (修正後創建): 已為新實體 '米婭' 創建檔案。
任務成功 (修正後創建): 已為新實體 '卡爾•維利爾斯勳爵' 創建檔案。
任務失敗: for update_lore_template_keys: 1 validation error for UpdateLoreTemplateKeysArgs
lore_category
  Field required [type=missing, input_value={'lore_key': '宅邸 > ...s': ['宅邸 > 米婭']}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
2025-10-03 07:33:56 - [INFO] - [512280345618546699] [精煉觸發器] 檢測到 2 條新/陳舊 LORE，正在異步觸發背景精煉服務...
2025-10-03 07:33:56 - [INFO] - [512280345618546699] [事後分析] 背景分析與處理任務完成。
2025-10-03 07:33:59 - [INFO] - [512280345618546699] [LORE精煉 v7.1] 背景精煉服務已啟動，收到 2 個精煉任務。
2025-10-03 07:33:59 - [INFO] - [512280345618546699] [單體精煉 v11.0] 正在為角色 '米婭' 啟動三層降級精煉流程...
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:33:59 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:33:59 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:33:59 - [INFO] -   [最終 summary_context 長度]: 19128
2025-10-03 07:33:59 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:33:59 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:33:59 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:33:59 - [INFO] -   [最終 summary_context 長度]: 19001
2025-10-03 07:33:59 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:33:59 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:33:59 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:33:59 - [INFO] -   [最終 summary_context 長度]: 19010
2025-10-03 07:33:59 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:33:59 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:33:59 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:33:59 - [INFO] -   [最終 summary_context 長度]: 19041
2025-10-03 07:33:59 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:33:59 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:33:59 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:33:59 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:33:59 - [INFO] -   [最終 summary_context 長度]: 19071
2025-10-03 07:33:59 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:33:59 - [INFO] - [512280345618546699] [LORE精煉-L1] 正在嘗試使用雲端模型 (gemini-2.5-flash-lite) 進行完整精煉...
2025-10-03 07:34:00 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #5) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-03 07:34:00 - [WARNING] - [512280345618546699] [LORE精煉-L1] 雲端完整精煉被審查 (Prompt blocked due to 4)。降級至 L2 (本地模型)。
2025-10-03 07:34:00 - [INFO] - [512280345618546699] [LORE精煉-本地] 正在使用本地模型 'HammerAI/llama-3-lexi-uncensored:latest' 為角色 '米婭' 進行精煉...
2025-10-03 07:36:23 - [ERROR] - [512280345618546699] [LORE精煉-本地] 🔥 呼叫本地Ollama進行精煉時發生未知錯誤: 1 validation error for CharacterProfile
name
  Field required [type=missing, input_value={'title': '城鎮區與...的分裂與混亂。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2977, in _invoke_local_ollama_refiner
    validated_result = CharacterProfile.model_validate(parsed_json)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 568, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for CharacterProfile
name
  Field required [type=missing, input_value={'title': '城鎮區與...的分裂與混亂。'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.8/v/missing
2025-10-03 07:36:23 - [WARNING] - [512280345618546699] [LORE精煉-L3] L1和L2均失敗。啟動雲端『分治法』數據搶救...
2025-10-03 07:36:23 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-10-03 07:36:23 - [WARNING] - [512280345618546699] 內部鏈意外遭遇審查。啟動【通用化解構-重構】策略...
2025-10-03 07:36:23 - [ERROR] - [512280345618546699] (Euphemizer) 在失敗的 Prompt 中找不到任何可供消毒的已知內容標記，無法執行委婉化。
2025-10-03 07:36:26 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-10-03 07:36:26 - [INFO] - [512280345618546699] [LORE精煉-L3] ✅ 成功搶救 'description' 數據。
2025-10-03 07:36:26 - [INFO] - [512280345618546699] [單體精煉] ✅ 驗證通過，成功為角色 '米婭' 生成精煉檔案。
2025-10-03 07:36:27 - [INFO] - [512280345618546699] [LORE精煉-背景] ✅ 已成功在後台精煉並更新角色 '米婭' 的檔案。
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [單體精煉 v11.0] 正在為角色 '卡爾•維利爾斯勳爵' 啟動三層降級精煉流程...
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19193
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19193
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19055
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19233
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 07:36:29 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 07:36:29 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 07:36:29 - [INFO] -   [最終 summary_context 長度]: 19096
2025-10-03 07:36:29 - [INFO] - --- RAG 流程結束 ---
2025-10-03 07:36:29 - [INFO] - [512280345618546699] [LORE精煉-L1] 正在嘗試使用雲端模型 (gemini-2.5-flash-lite) 進行完整精煉...
2025-10-03 07:36:34 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-10-03 07:36:34 - [INFO] - [512280345618546699] [單體精煉] ✅ 驗證通過，成功為角色 '卡爾•維利爾斯勳爵' 生成精煉檔案。
2025-10-03 07:36:34 - [INFO] - [512280345618546699] [LORE精煉-背景] ✅ 已成功在後台精煉並更新角色 '卡爾•維利爾斯勳爵' 的檔案。
2025-10-03 07:36:36 - [INFO] - [512280345618546699] [LORE精煉 v7.1] 所有 2 個背景精煉任務已全部完成。
2025-10-03 09:11:57 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 09:11:57 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 09:11:57 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 09:11:57 - [INFO] - Discord Bot is ready!
2025-10-03 09:12:00 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 09:12:00 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 09:12:00 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 09:12:32 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 09:12:32 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 09:12:32 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 09:12:32 - [INFO] - Discord Bot is ready!
2025-10-03 09:12:35 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 09:12:35 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 09:12:36 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 11:50:19 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 11:50:19 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 11:50:20 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 11:50:20 - [INFO] - Discord Bot is ready!
2025-10-03 11:50:22 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 11:50:22 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 11:50:23 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 12:31:26 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-03 12:31:26 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-03 12:31:26 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-03 12:31:26 - [INFO] - Discord Bot is ready!
2025-10-03 12:31:29 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-03 12:31:29 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-03 12:31:29 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-03 13:56:05 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-03 13:56:05 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-03 13:56:05 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-03 13:56:07 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-03 13:56:07 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-03 13:56:07 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-03 13:56:08 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-03 13:56:13 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-03 13:56:14 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-03 13:56:14 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-03 13:56:14 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-03 13:56:14 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-03 13:56:14 - [INFO] - [512280345618546699] 正在創建本地 Embedding 模型 'infgrad/stella-base-zh-v2' 實例...
2025-10-03 13:56:28 - [INFO] - [512280345618546699] ✅ 本地 Embedding 模型實例創建成功。
2025-10-03 13:56:28 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-03 13:56:28 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-03 13:56:28 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-03 13:56:28 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:56:30 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-03 13:56:40 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-03 13:56:40 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-03 13:56:41 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:56:42 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-03 13:56:52 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-10-03 13:56:52 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-10-03 13:56:52 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:56:54 - [INFO] - [512280345618546699] [創世流程] 檔案上傳開始，已設定 active_setups 狀態鎖。
2025-10-03 13:57:03 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-03 13:57:05 - [INFO] - [512280345618546699] [創世流程 v63.0] 純向量RAG簡化版流程已啟動。
2025-10-03 13:57:05 - [INFO] - [512280345618546699] [後台創世 1/4] 正在補完角色檔案...
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-10-03 13:57:08 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-10-03 13:57:08 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [後台創世 2/4] 正在將世界聖經原文分割成文檔...
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [後台創世 2/4] 世界聖經已分割為 34 個文檔。
2025-10-03 13:57:08 - [INFO] - [512280345618546699] [後台創世 3/4] 正在觸發 RAG 索引純向量創始構建...
2025-10-03 13:57:08 - [INFO] - [512280345618546699] (Retriever Builder) 進入外部文檔注入模式，將使用 34 條傳入文檔構建純向量索引...
2025-10-03 13:57:47 - [INFO] - [512280345618546699] (Retriever Builder) ✅ 純向量檢索器已成功從外部文檔構建。
2025-10-03 13:57:47 - [INFO] - [512280345618546699] [後台創世 3/4] 純向量 RAG 索引構建完成。
2025-10-03 13:57:47 - [INFO] - [512280345618546699] [後台創世 4/4] 正在生成 RAG 驅動的智能開場白...
2025-10-03 13:57:47 - [INFO] - [512280345618546699] [/start] 正在使用 RAG 智能選擇開場場景...
2025-10-03 13:57:47 - [INFO] - --- [RAG 透明度日誌 Step 1/4] 初步檢索到 20 條文檔 ---
2025-10-03 13:57:47 - [INFO] - --- [RAG 透明度日誌 Step 2/4] 去重已禁用，使用全部 20 條原始文檔 ---
2025-10-03 13:57:47 - [INFO] - [512280345618546699] [RAG原文直通] ✅ 成功拼接全部 20 條原始文檔作為 summary_context。
2025-10-03 13:57:47 - [INFO] - --- [RAG 透明度日誌 Step 4/4] 最終輸出 ---
2025-10-03 13:57:47 - [INFO] -   [最終 rules_context 長度]: 20
2025-10-03 13:57:47 - [INFO] -   [最終 summary_context 長度]: 19014
2025-10-03 13:57:47 - [INFO] - --- RAG 流程結束 ---
2025-10-03 13:58:19 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-10-03 13:58:19 - [INFO] - [512280345618546699] [後台創世 4/4] 開場白生成完畢。
2025-10-03 13:58:19 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-10-03 13:58:19 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-03 13:58:19 - [INFO] - [512280345618546699] [後台創世] 正在向使用者私訊發送最終開場白...
2025-10-03 13:58:20 - [INFO] - [512280345618546699] [後台創世] 開場白發送完畢。
2025-10-03 13:58:20 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-03 13:59:03 - [INFO] - [512280345618546699] 啟動 Graph-based 對話流程...
2025-10-03 13:59:03 - [ERROR] - 處理使用者 512280345618546699 的 Graph 流程時發生異常: 'AILoverBot' object has no attribute 'main_graph'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1361, in on_message
    if not self.bot.main_graph:
AttributeError: 'AILoverBot' object has no attribute 'main_graph'
