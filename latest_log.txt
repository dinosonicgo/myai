### AI Lover Log - Last updated at 2025-09-27T15:10:46.428137 ###

2025-09-27 11:27:29 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-27 11:27:30 - [INFO] - [512280345618546699] [對話後 LORE 擴展] ✅ 管線成功完成。擴展了 4 條 LORE: 碧, DINO, 王都, 酒館
2025-09-27 14:12:15 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-27 14:12:15 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-27 14:12:15 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-27 14:12:15 - [INFO] - Discord Bot is ready!
2025-09-27 14:12:18 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-27 14:12:18 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-27 14:12:18 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-27 14:17:46 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-27 14:17:46 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-27 14:17:47 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-27 14:17:47 - [INFO] - Discord Bot is ready!
2025-09-27 14:17:49 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-27 14:17:49 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-27 14:17:50 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-27 14:27:08 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-27 14:27:08 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-27 14:27:08 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-27 14:27:08 - [INFO] - Discord Bot is ready!
2025-09-27 14:27:11 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-27 14:27:11 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-27 14:27:11 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-27 14:27:26 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-27 14:27:26 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-27 14:27:26 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-27 14:27:26 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-27 14:27:26 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 118 條文檔到 RAG 語料庫。
2025-09-27 14:27:26 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-27 14:27:26 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-27 14:27:26 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-27 14:27:26 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-27 14:27:26 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 3 條訊息。
2025-09-27 14:27:26 - [INFO] - [512280345618546699] 正在關閉 AI 實例並釋放資源...
2025-09-27 14:27:27 - [INFO] - [512280345618546699] AI 實例資源已釋放。
2025-09-27 14:27:29 - [INFO] - [512280345618546699] 正在清除所有短期場景記憶...
2025-09-27 14:27:29 - [INFO] - [512280345618546699] 已成功從資料庫中刪除 3 條場景歷史記錄。
2025-09-27 14:27:31 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-09-27 14:27:34 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-09-27 14:27:35 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-27 14:27:35 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-09-27 14:27:35 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-27 14:27:35 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-27 14:27:35 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行全量創始構建...
2025-09-27 14:27:35 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 0 條文檔用於創始構建。
2025-09-27 14:27:35 - [INFO] - [512280345618546699] (Retriever Builder) 知識庫為空，創始構建為空。
2025-09-27 14:27:35 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-27 14:27:35 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-09-27 14:27:35 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-09-27 14:27:35 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:27:36 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-09-27 14:27:44 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-09-27 14:27:44 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-09-27 14:27:44 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:27:46 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-09-27 14:28:00 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-09-27 14:28:00 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-09-27 14:28:00 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:28:02 - [INFO] - [512280345618546699] [创世流程] 档案上传开始，已设置 active_setups 状态锁。
2025-09-27 14:28:07 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-09-27 14:28:10 - [INFO] - [512280345618546699] 独立的后台创世流程已为用户启动。
2025-09-27 14:28:10 - [INFO] - [512280345618546699] [后台创世 1/4] 正在处理世界圣经...
2025-09-27 14:28:10 - [INFO] - [512280345618546699] (Canon Processor) 正在啟動敘事提取安全管線...
2025-09-27 14:28:10 - [INFO] - [512280345618546699] [敘事提取 1/4] 正在嘗試【理想方案：雲端宏觀提取】...
2025-09-27 14:28:11 - [WARNING] - [512280345618546699] [创世流程] 档案上传流程结束/异常，但后台任务未接管状态锁，在此处释放。
2025-09-27 14:28:54 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-27 14:28:54 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇解析或驗證錯誤: ValidationError。
2025-09-27 14:28:54 - [ERROR] - [512280345618546699] [敘事提取 1/4] 遭遇未知錯誤: 1 validation error for NarrativeExtractionResult
narrative_text
  Field required [type=missing, input_value={'narrative_extraction_re...體神聖燈塔」。"}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing，正在降級。
2025-09-27 14:28:54 - [INFO] - [512280345618546699] [敘事提取 2/4] 本地備援方案暫未針對此任務優化，跳過此層級以提高效率。
2025-09-27 14:28:54 - [INFO] - [512280345618546699] [敘事提取 3/4] 正在嘗試【安全代碼方案：全文無害化提取】...
2025-09-27 14:29:35 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-09-27 14:29:35 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇解析或驗證錯誤: ValidationError。
2025-09-27 14:29:35 - [ERROR] - [512280345618546699] [敘事提取 3/4] 遭遇未知錯誤: 1 validation error for NarrativeExtractionResult
narrative_text
  Field required [type=missing, input_value={'narrative_extraction_re...的巨大打擊。\n'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4349, in _execute_narrative_extraction_pipeline
    extraction_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 807, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 787, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for NarrativeExtractionResult
narrative_text
  Field required [type=missing, input_value={'narrative_extraction_re...的巨大打擊。\n'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-27 14:29:35 - [CRITICAL] - [512280345618546699] [敘事提取 4/4] 所有智能提取層級均失敗！觸發最終備援，將整個世界聖經原文視為敘事摘要。
2025-09-27 14:29:35 - [INFO] - [512280345618546699] (Canon Processor) ✅ 智能敘事RAG注入成功！已將 34 個劇情摘要文本塊存入長期記憶。
2025-09-27 14:29:35 - [INFO] - [512280345618546699] [后台创世 1/4] 正在进行 LORE 智能解析...
2025-09-27 14:29:35 - [INFO] - [512280345618546699] [創世 LORE 解析] 正在啟動多層降級解析管線...
2025-09-27 14:29:35 - [INFO] - [512280345618546699] [LORE 解析 1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-09-27 14:30:57 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-09-27 14:30:57 - [INFO] - [512280345618546699] [LORE 解析 1/5] ✅ 成功！正在儲存結果...
2025-09-27 14:30:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 80 個實體...
2025-09-27 14:33:04 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-27 14:33:04 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 80 條決策。
2025-09-27 14:33:13 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 9 個實體...
2025-09-27 14:33:14 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'item_info' 類別處理 3 個實體...
2025-09-27 14:33:15 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 10 個實體...
2025-09-27 14:33:15 - [INFO] - [512280345618546699] [創世 LORE 解析] 管線成功完成。正在觸發 RAG 全量重建...
2025-09-27 14:33:15 - [INFO] - [512280345618546699] (Retriever Builder) 強制重建觸發，正在從資料庫執行全量創始構建...
2025-09-27 14:33:15 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 117 條文檔用於創始構建。
2025-09-27 14:33:15 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-27 14:33:15 - [INFO] - [512280345618546699] [創世 LORE 解析] RAG 索引全量重建完成。
2025-09-27 14:33:15 - [INFO] - [512280345618546699] [后台创世 1/4] LORE 智能解析已同步完成。
2025-09-27 14:33:15 - [INFO] - [512280345618546699] [后台创世 2/4] 正在补完角色档案...
2025-09-27 14:33:20 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-09-27 14:33:21 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-27 14:33:21 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-09-27 14:33:21 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:33:21 - [INFO] - [512280345618546699] [后台创世 3/4] 正在生成世界创世资讯...
2025-09-27 14:33:24 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-27 14:33:24 - [WARNING] - [512280345618546699] 最終生成鏈遭遇審查。啟動【最高指令集注入重試】策略...
2025-09-27 14:33:24 - [INFO] - [512280345618546699] 已對 Prompt 附加完整的核心指令集，正在進行強化重試...
2025-09-27 14:33:55 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #1.
2025-09-27 14:33:55 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-27 14:33:55 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:33:55 - [INFO] - [512280345618546699] [/start] 初始地點 '王都 > 城鎮市集區 > 咆哮壁爐酒館' 已成功生成並存入LORE。
2025-09-27 14:33:55 - [INFO] - [512280345618546699] [后台创世 4/4] 正在生成开场白...
2025-09-27 14:34:26 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-09-27 14:34:26 - [INFO] - [512280345618546699] [后台创世 4/4] 开场白生成完毕。
2025-09-27 14:34:26 - [INFO] - [512280345618546699] [后台创世] 正在向使用者私讯发送最终开场白...
2025-09-27 14:34:26 - [INFO] - [512280345618546699] [后台创世] 开场白发送完毕。
2025-09-27 14:34:26 - [INFO] - [512280345618546699] 后台创世流程结束，状态锁已释放。
2025-09-27 14:35:25 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-27 14:35:25 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-27 14:35:26 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-27 14:35:26 - [INFO] - Discord Bot is ready!
2025-09-27 14:35:28 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-27 14:35:28 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-27 14:35:29 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-27 14:40:38 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-27 14:40:38 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-27 14:40:38 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-27 14:40:38 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-27 14:40:38 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 117 條文檔到 RAG 語料庫。
2025-09-27 14:40:38 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-27 14:40:38 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-27 14:40:38 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-27 14:40:38 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-27 14:40:38 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-27 14:40:38 - [INFO] - [512280345618546699] 正在關閉 AI 實例並釋放資源...
2025-09-27 14:40:39 - [INFO] - [512280345618546699] AI 實例資源已釋放。
2025-09-27 14:40:41 - [INFO] - [512280345618546699] 正在清除所有短期場景記憶...
2025-09-27 14:40:41 - [INFO] - [512280345618546699] 已成功從資料庫中刪除 1 條場景歷史記錄。
2025-09-27 14:40:43 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-09-27 14:40:47 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-09-27 14:40:47 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-27 14:40:47 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-09-27 14:40:47 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-27 14:40:47 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-27 14:40:47 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行全量創始構建...
2025-09-27 14:40:47 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 0 條文檔用於創始構建。
2025-09-27 14:40:47 - [INFO] - [512280345618546699] (Retriever Builder) 知識庫為空，創始構建為空。
2025-09-27 14:40:47 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-27 14:40:47 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-09-27 14:40:47 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-09-27 14:40:48 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:40:49 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-09-27 14:40:57 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-09-27 14:40:57 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-09-27 14:40:57 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:40:58 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-09-27 14:41:08 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-09-27 14:41:08 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-09-27 14:41:09 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:41:10 - [INFO] - [512280345618546699] [创世流程] 档案上传开始，已设置 active_setups 状态锁。
2025-09-27 14:41:15 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-09-27 14:41:18 - [INFO] - [512280345618546699] 独立的后台创世流程已为用户启动。
2025-09-27 14:41:18 - [INFO] - [512280345618546699] [后台创世 1/4] 正在处理世界圣经...
2025-09-27 14:41:18 - [INFO] - [512280345618546699] (Canon Processor) 正在啟動敘事提取安全管線...
2025-09-27 14:41:18 - [INFO] - [512280345618546699] [敘事提取 1/4] 正在嘗試【理想方案：雲端宏觀提取】...
2025-09-27 14:41:19 - [WARNING] - [512280345618546699] [创世流程] 档案上传流程结束/异常，但后台任务未接管状态锁，在此处释放。
2025-09-27 14:42:03 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-27 14:42:03 - [INFO] - [512280345618546699] [敘事提取 1/4] ✅ 成功！
2025-09-27 14:42:04 - [INFO] - [512280345618546699] (Canon Processor) ✅ 智能敘事RAG注入成功！已將 31 個劇情摘要文本塊存入長期記憶。
2025-09-27 14:42:04 - [INFO] - [512280345618546699] [后台创世 1/4] 正在进行 LORE 智能解析...
2025-09-27 14:42:04 - [INFO] - [512280345618546699] [創世 LORE 解析] 正在啟動多層降級解析管線...
2025-09-27 14:42:04 - [INFO] - [512280345618546699] [LORE 解析 1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-09-27 14:44:12 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-27 14:44:12 - [WARNING] - [512280345618546699] [LORE 解析 1/5] 遭遇內容審查，正在降級到第二層（本地LLM）...
2025-09-27 14:44:12 - [INFO] - [512280345618546699] [LORE 解析 2/5] 正在嘗試【本地備援方案：無審查解析】...
2025-09-27 14:44:12 - [INFO] - [512280345618546699] 正在使用本地模型 'HammerAI/llama-3-lexi-uncensored:latest' 進行LORE解析 (Attempt 1/2)...
2025-09-27 14:44:32 - [INFO] - [512280345618546699] 本地模型在首次嘗試中成功解析並驗證了LORE數據。
2025-09-27 14:44:32 - [WARNING] - [512280345618546699] [LORE 解析 2/5] 本地模型未能成功解析，正在降級到第三層（安全代碼）...
2025-09-27 14:44:32 - [INFO] - [512280345618546699] [LORE 解析 3/5] 正在嘗試【安全代碼方案：全文無害化解析】...
2025-09-27 14:47:32 - [WARNING] - [512280345618546699] Key #2 (模型: gemini-2.5-flash-lite) 遭遇臨時性 API 錯誤 (TimeoutError)。將在 1.48 秒後進行第 2 次嘗試...
2025-09-27 14:48:37 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #2.
2025-09-27 14:48:37 - [INFO] - [512280345618546699] [LORE 解析 3/5] ✅ 成功！正在解碼並儲存結果...
2025-09-27 14:48:37 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 62 個實體...
2025-09-27 14:49:33 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #3.
2025-09-27 14:49:33 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 62 條決策。
2025-09-27 14:49:43 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 7 個實體...
2025-09-27 14:49:45 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'item_info' 類別處理 22 個實體...
2025-09-27 14:49:47 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 6 個實體...
2025-09-27 14:49:49 - [INFO] - [512280345618546699] [創世 LORE 解析] 管線成功完成。正在觸發 RAG 全量重建...
2025-09-27 14:49:49 - [INFO] - [512280345618546699] (Retriever Builder) 強制重建觸發，正在從資料庫執行全量創始構建...
2025-09-27 14:49:49 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 128 條文檔用於創始構建。
2025-09-27 14:49:49 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-27 14:49:49 - [INFO] - [512280345618546699] [創世 LORE 解析] RAG 索引全量重建完成。
2025-09-27 14:49:49 - [INFO] - [512280345618546699] [后台创世 1/4] LORE 智能解析已同步完成。
2025-09-27 14:49:49 - [INFO] - [512280345618546699] [后台创世 2/4] 正在补完角色档案...
2025-09-27 14:49:52 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-09-27 14:49:52 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-27 14:49:52 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-09-27 14:49:52 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:49:52 - [INFO] - [512280345618546699] [后台创世 3/4] 正在生成世界创世资讯...
2025-09-27 14:49:53 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-27 14:49:53 - [WARNING] - [512280345618546699] 最終生成鏈遭遇審查。啟動【最高指令集注入重試】策略...
2025-09-27 14:49:53 - [INFO] - [512280345618546699] 已對 Prompt 附加完整的核心指令集，正在進行強化重試...
2025-09-27 14:50:39 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #1.
2025-09-27 14:50:39 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-27 14:50:41 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 14:50:41 - [INFO] - [512280345618546699] [/start] 初始地點 '埃德蒙王國 > 王都城鎮區 > 咆哮壁爐酒館' 已成功生成並存入LORE。
2025-09-27 14:50:41 - [INFO] - [512280345618546699] [后台创世 4/4] 正在生成开场白...
2025-09-27 14:51:39 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-09-27 14:51:39 - [INFO] - [512280345618546699] [后台创世 4/4] 开场白生成完毕。
2025-09-27 14:51:40 - [INFO] - [512280345618546699] [后台创世] 正在向使用者私讯发送最终开场白...
2025-09-27 14:51:41 - [INFO] - [512280345618546699] [后台创世] 开场白发送完毕。
2025-09-27 14:51:41 - [INFO] - [512280345618546699] 后台创世流程结束，状态锁已释放。
2025-09-27 15:05:29 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-27 15:05:29 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-27 15:05:29 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-27 15:05:29 - [INFO] - Discord Bot is ready!
2025-09-27 15:05:32 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-27 15:05:32 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-27 15:05:33 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-27 15:05:57 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-27 15:05:57 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-27 15:05:57 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-27 15:05:57 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-27 15:05:57 - [INFO] - [512280345618546699] [RAG持久化] 成功從磁碟加載了 128 條文檔到 RAG 語料庫。
2025-09-27 15:05:57 - [INFO] - [512280345618546699] (Retriever Builder) 已成功從持久化檔案構建 RAG 檢索器。
2025-09-27 15:05:57 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-27 15:05:57 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-27 15:05:57 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-27 15:05:57 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-27 15:05:57 - [INFO] - [512280345618546699] 正在關閉 AI 實例並釋放資源...
2025-09-27 15:05:59 - [INFO] - [512280345618546699] AI 實例資源已釋放。
2025-09-27 15:06:00 - [INFO] - [512280345618546699] 正在清除所有短期場景記憶...
2025-09-27 15:06:00 - [INFO] - [512280345618546699] 已成功從資料庫中刪除 1 條場景歷史記錄。
2025-09-27 15:06:02 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-09-27 15:06:07 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-09-27 15:06:07 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-27 15:06:07 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-09-27 15:06:07 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-27 15:06:07 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-27 15:06:07 - [INFO] - [512280345618546699] (Retriever Builder) 未找到持久化 RAG 索引，正在從資料庫執行全量創始構建...
2025-09-27 15:06:07 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 0 條文檔用於創始構建。
2025-09-27 15:06:07 - [INFO] - [512280345618546699] (Retriever Builder) 知識庫為空，創始構建為空。
2025-09-27 15:06:07 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-27 15:06:07 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-09-27 15:06:07 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-09-27 15:06:07 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 15:06:08 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-09-27 15:06:17 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-09-27 15:06:17 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-09-27 15:06:17 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 15:06:19 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-09-27 15:06:30 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-09-27 15:06:30 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-09-27 15:06:30 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-27 15:06:32 - [INFO] - [512280345618546699] [创世流程] 档案上传开始，已设置 active_setups 状态锁。
2025-09-27 15:06:37 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-09-27 15:06:39 - [INFO] - [512280345618546699] 独立的后台创世流程已为用户启动。
2025-09-27 15:06:39 - [INFO] - [512280345618546699] [后台创世 1/4] 正在处理世界圣经...
2025-09-27 15:06:39 - [INFO] - [512280345618546699] (Canon Processor) 正在啟動敘事提取安全管線...
2025-09-27 15:06:39 - [INFO] - [512280345618546699] [敘事提取 1/4] 正在嘗試【理想方案：雲端宏觀提取】...
2025-09-27 15:06:40 - [WARNING] - [512280345618546699] [创世流程] 档案上传流程结束/异常，但后台任务未接管状态锁，在此处释放。
2025-09-27 15:07:19 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #0.
2025-09-27 15:07:19 - [INFO] - [512280345618546699] [敘事提取 1/4] ✅ 成功！
2025-09-27 15:07:21 - [INFO] - [512280345618546699] (Canon Processor) ✅ 智能敘事RAG注入成功！已將 31 個劇情摘要文本塊存入長期記憶。
2025-09-27 15:07:21 - [INFO] - [512280345618546699] [后台创世 1/4] 正在进行 LORE 智能解析...
2025-09-27 15:07:21 - [INFO] - [512280345618546699] [創世 LORE 解析] 正在啟動多層降級解析管線...
2025-09-27 15:07:21 - [INFO] - [512280345618546699] [LORE 解析 1/5] 正在嘗試【理想方案：雲端宏觀解析】...
2025-09-27 15:08:08 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #1.
2025-09-27 15:08:08 - [INFO] - [512280345618546699] [LORE 解析 1/5] ✅ 成功！正在儲存結果...
2025-09-27 15:08:08 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 67 個實體...
2025-09-27 15:09:19 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-09-27 15:09:19 - [INFO] - [512280345618546699] [實體解析] 成功生成解析計畫，包含 67 條決策。
2025-09-27 15:09:30 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 9 個實體...
2025-09-27 15:09:31 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'item_info' 類別處理 3 個實體...
2025-09-27 15:09:31 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'creature_info' 類別處理 1 個實體...
2025-09-27 15:09:32 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 11 個實體...
2025-09-27 15:09:32 - [ERROR] - [512280345618546699] 后台创世流程发生严重错误: 'bool' object has no attribute 'npc_profiles'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1207, in _perform_full_setup_flow
    await ai_instance.parse_and_create_lore_from_canon(canon_text)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3447, in parse_and_create_lore_from_canon
    parsing_result = self._programmatic_lore_validator(parsing_result, canon_text)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 3376, in _programmatic_lore_validator
    if not parsing_result.npc_profiles:
AttributeError: 'bool' object has no attribute 'npc_profiles'
2025-09-27 15:09:33 - [INFO] - [512280345618546699] 后台创世流程结束，状态锁已释放。
