### AI Lover Log - Last updated at 2025-09-29T20:12:45.405485 ###

2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 更新反向鏈接: 克拉拉 -> 迪茜 (New Roles: ['擁護者', '擁護'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 更新反向鏈接: 菲利普•薩格納 -> 薩格納將軍 (New Roles: ['父親', '父母'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 更新反向鏈接: 薩格納將軍 -> 菲利普•薩格納 (New Roles: ['兒子', '子女'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 薩格納將軍 -> 布里奇特 (Roles: ['子女', '父母'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 薩格納將軍 -> 瓦萊麗 (Roles: ['子女', '父母'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 菲利普•薩格納 -> 瓦萊麗 (Roles: ['兄弟姐妹'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 薩格納將軍 -> 國王埃德蒙三世 (Roles: ['君臣/盟友'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 國王埃德蒙三世 -> 大皇子阿拉里克 (Roles: ['子女', '父母'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 國王埃德蒙三世 -> 三皇子赫克托 (Roles: ['子女', '父母'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 菲利普•薩格納 -> 三皇子赫克托 (Roles: ['競爭對手'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 國王埃德蒙三世 -> 二公主塞拉菲娜 (Roles: ['子女', '父母'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 國王埃德蒙三世 -> 三皇女伊索爾德 (Roles: ['子女', '父母'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 博林勳爵 -> 三皇女伊索爾德 (Roles: ['引導者/轉化者'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 更新反向鏈接: 三皇女伊索爾德 -> 博林勳爵 (New Roles: ['轉化者', '引導者', '引導者/轉化者'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 米婭 -> 瓦勒留斯神父 (Roles: ['對手'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] [關係圖譜校準] 創建反向鏈接: 莉莉絲 -> 麥可神父 (Roles: ['焦慮對象'])
2025-09-29 12:06:55 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 62 個實體...
2025-09-29 12:08:48 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-09-29 12:08:48 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #2) 首次解析失敗: ValidationError。啟動【JSON自我修正】重試...
2025-09-29 12:08:49 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #3.
2025-09-29 12:08:49 - [INFO] - [512280345618546699] 【JSON自我修正】成功，正在重新驗證修正後的JSON...
2025-09-29 12:08:49 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #2) 在【自我修正】後仍然遭遇解析或驗證錯誤: ValidationError。
2025-09-29 12:08:49 - [ERROR] - [512280345618546699] [實體解析] 批量實體解析鏈執行失敗: 1 validation error for BatchResolutionPlan
resolutions
  Field required [type=missing, input_value={'resolution': {'original...根據上下文推斷'}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 293, in _resolve_and_save
    resolution_plan = await self.ainvoke_with_rotation(resolution_prompt, output_schema=BatchResolutionPlan, use_degradation=True)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 837, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 818, in ainvoke_with_rotation
    return output_schema.model_validate(json.loads(clean_json_str))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
pydantic_core._pydantic_core.ValidationError: 1 validation error for BatchResolutionPlan
resolutions
  Field required [type=missing, input_value={'resolution': {'original...根據上下文推斷'}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-29 12:08:49 - [WARNING] - [512280345618546699] [實體解析] 未能生成有效的解析計畫，所有NPC將被視為新實體處理。
2025-09-29 12:08:56 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 3 個實體...
2025-09-29 12:08:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'item_info' 類別處理 2 個實體...
2025-09-29 12:08:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'quest' 類別處理 1 個實體...
2025-09-29 12:08:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 6 個實體...
2025-09-29 12:08:57 - [INFO] - [512280345618546699] [創世 LORE 解析] 管線成功完成。正在觸發 RAG 全量重建...
2025-09-29 12:08:57 - [INFO] - [512280345618546699] (Retriever Builder) 強制重建觸發，正在從資料庫執行全量創始構建...
2025-09-29 12:08:57 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 104 條文檔用於創始構建。
2025-09-29 12:08:57 - [INFO] - [512280345618546699] (Retriever Builder) 創始構建成功，並已將索引持久化到磁碟。
2025-09-29 12:08:57 - [INFO] - [512280345618546699] [創世 LORE 解析] RAG 索引全量重建完成。
2025-09-29 12:08:57 - [INFO] - [512280345618546699] [后台创世 1/4] LORE 智能解析已同步完成。
2025-09-29 12:08:57 - [INFO] - [512280345618546699] [后台创世 2/4] 正在补完角色档案...
2025-09-29 12:09:00 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #4.
2025-09-29 12:09:00 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-flash-lite' with API Key #5.
2025-09-29 12:09:00 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-09-29 12:09:00 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-29 12:09:00 - [INFO] - [512280345618546699] [后台创世 3/4] 正在生成世界创世资讯...
2025-09-29 12:09:01 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查或安全錯誤: BlockedPromptException。
2025-09-29 12:09:01 - [WARNING] - [512280345618546699] 最終生成鏈遭遇審查。啟動【最高指令集注入重試】策略...
2025-09-29 12:09:01 - [INFO] - [512280345618546699] 已對 Prompt 附加完整的核心指令集，正在進行強化重試...
2025-09-29 12:09:38 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #1.
2025-09-29 12:09:38 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['game_state']
2025-09-29 12:09:39 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-29 12:09:39 - [INFO] - [512280345618546699] [/start] 初始地點 '艾德蒙王國 > 王都 > 聖凱瑟琳學院的偏僻角落' 已成功生成並存入LORE。
2025-09-29 12:09:39 - [INFO] - [512280345618546699] [后台创世 4/4] 正在生成开场白...
2025-09-29 12:10:13 - [INFO] - [512280345618546699] [LLM Success] Generation successful using model 'gemini-2.5-pro' with API Key #2.
2025-09-29 12:10:13 - [INFO] - [512280345618546699] [后台创世 4/4] 开场白生成完毕。
2025-09-29 12:10:14 - [INFO] - [512280345618546699] [后台创世] 正在向使用者私讯发送最终开场白...
2025-09-29 12:10:14 - [INFO] - [512280345618546699] [后台创世] 开场白发送完毕。
2025-09-29 12:10:14 - [INFO] - [512280345618546699] 后台创世流程结束，状态锁已释放。
2025-09-29 18:22:17 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-29 18:22:17 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-29 18:22:17 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-29 18:22:17 - [INFO] - Discord Bot is ready!
2025-09-29 18:22:20 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-29 18:22:20 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-29 18:22:21 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-29 20:05:10 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-29 20:05:10 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-29 20:05:11 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-29 20:05:11 - [INFO] - Discord Bot is ready!
2025-09-29 20:05:14 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-29 20:05:14 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-29 20:05:14 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-29 20:05:24 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-29 20:05:24 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-29 20:05:24 - [ERROR] - [512280345618546699] 後台重置任務失敗: (sqlite3.OperationalError) no such column: users.context_snapshot_json
[SQL: SELECT users.user_id AS users_user_id, users.username AS users_username, users.ai_name AS users_ai_name, users.ai_settings AS users_ai_settings, users.affinity AS users_affinity, users.game_state AS users_game_state, users.one_instruction AS users_one_instruction, users.world_settings AS users_world_settings, users.user_profile AS users_user_profile, users.ai_profile AS users_ai_profile, users.response_style_prompt AS users_response_style_prompt, users.context_snapshot_json AS users_context_snapshot_json 
FROM users 
WHERE users.user_id = ?]
[parameters: ('512280345618546699',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1960, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 146, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 298, in _handle_exception
    raise error
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 128, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 127, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    value = await result
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\cursor.py", line 48, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\cursor.py", line 40, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\core.py", line 133, in _execute
    return await future
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\core.py", line 106, in run
    result = function()
sqlite3.OperationalError: no such column: users.context_snapshot_json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1712, in start_reset_flow
    ai_instance = await self.get_or_create_ai_instance(user_id, is_setup_flow=True)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1367, in get_or_create_ai_instance
    if await ai_instance.initialize():
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2313, in initialize
    result = await session.get(UserData, self.user_id)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 595, in get
    return await greenlet_spawn(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 197, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\session.py", line 3637, in get
    return self._get_impl(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\session.py", line 3817, in _get_impl
    return db_load_fn(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1408, in execute
    return meth(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\sql\elements.py", line 513, in _execute_on_connection
    return connection._execute_clauseelement(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1630, in _execute_clauseelement
    ret = self._execute_context(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1839, in _execute_context
    return self._exec_single_context(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1979, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 2335, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1960, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 146, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 298, in _handle_exception
    raise error
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 128, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 127, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    value = await result
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\cursor.py", line 48, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\cursor.py", line 40, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\core.py", line 133, in _execute
    return await future
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\core.py", line 106, in run
    result = function()
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.context_snapshot_json
[SQL: SELECT users.user_id AS users_user_id, users.username AS users_username, users.ai_name AS users_ai_name, users.ai_settings AS users_ai_settings, users.affinity AS users_affinity, users.game_state AS users_game_state, users.one_instruction AS users_one_instruction, users.world_settings AS users_world_settings, users.user_profile AS users_user_profile, users.ai_profile AS users_ai_profile, users.response_style_prompt AS users_response_style_prompt, users.context_snapshot_json AS users_context_snapshot_json 
FROM users 
WHERE users.user_id = ?]
[parameters: ('512280345618546699',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-29 20:07:49 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-29 20:07:49 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-29 20:07:49 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-29 20:07:49 - [INFO] - Discord Bot is ready!
2025-09-29 20:07:52 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-29 20:07:52 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-29 20:07:53 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-29 20:08:16 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-29 20:08:16 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-29 20:08:16 - [ERROR] - [512280345618546699] 後台重置任務失敗: (sqlite3.OperationalError) no such column: users.context_snapshot_json
[SQL: SELECT users.user_id AS users_user_id, users.username AS users_username, users.ai_name AS users_ai_name, users.ai_settings AS users_ai_settings, users.affinity AS users_affinity, users.game_state AS users_game_state, users.one_instruction AS users_one_instruction, users.world_settings AS users_world_settings, users.user_profile AS users_user_profile, users.ai_profile AS users_ai_profile, users.response_style_prompt AS users_response_style_prompt, users.context_snapshot_json AS users_context_snapshot_json 
FROM users 
WHERE users.user_id = ?]
[parameters: ('512280345618546699',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1960, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 146, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 298, in _handle_exception
    raise error
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 128, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 127, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    value = await result
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\cursor.py", line 48, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\cursor.py", line 40, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\core.py", line 133, in _execute
    return await future
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\core.py", line 106, in run
    result = function()
sqlite3.OperationalError: no such column: users.context_snapshot_json

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1712, in start_reset_flow
    ai_instance = await self.get_or_create_ai_instance(user_id, is_setup_flow=True)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1367, in get_or_create_ai_instance
    if await ai_instance.initialize():
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2313, in initialize
    result = await session.get(UserData, self.user_id)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 595, in get
    return await greenlet_spawn(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 197, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\session.py", line 3637, in get
    return self._get_impl(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\session.py", line 3817, in _get_impl
    return db_load_fn(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\session.py", line 2306, in execute
    return self._execute_internal(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\session.py", line 2191, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1408, in execute
    return meth(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\sql\elements.py", line 513, in _execute_on_connection
    return connection._execute_clauseelement(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1630, in _execute_clauseelement
    ret = self._execute_context(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1839, in _execute_context
    return self._exec_single_context(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1979, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 2335, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\base.py", line 1960, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\engine\default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 146, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 298, in _handle_exception
    raise error
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 128, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 127, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    value = await result
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\cursor.py", line 48, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\cursor.py", line 40, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\core.py", line 133, in _execute
    return await future
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\aiosqlite\core.py", line 106, in run
    result = function()
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.context_snapshot_json
[SQL: SELECT users.user_id AS users_user_id, users.username AS users_username, users.ai_name AS users_ai_name, users.ai_settings AS users_ai_settings, users.affinity AS users_affinity, users.game_state AS users_game_state, users.one_instruction AS users_one_instruction, users.world_settings AS users_world_settings, users.user_profile AS users_user_profile, users.ai_profile AS users_ai_profile, users.response_style_prompt AS users_response_style_prompt, users.context_snapshot_json AS users_context_snapshot_json 
FROM users 
WHERE users.user_id = ?]
[parameters: ('512280345618546699',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-29 20:10:58 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-29 20:10:58 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-29 20:10:58 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-29 20:10:58 - [INFO] - Discord Bot is ready!
2025-09-29 20:11:01 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-29 20:11:01 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-29 20:11:02 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-29 20:12:31 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-29 20:12:31 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-29 20:12:31 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-29 20:12:31 - [INFO] - Discord Bot is ready!
2025-09-29 20:12:34 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-29 20:12:34 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-29 20:12:34 - [INFO] - 已成功發送啟動成功通知給管理員。
