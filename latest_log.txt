### AI Lover Log - Last updated at 2025-09-21T22:47:40.354040 ###

2025-09-21 22:28:44 - [INFO] - [512280345618546699] 核心模型已成功重建。
2025-09-21 22:28:44 - [ERROR] - [512280345618546699] 處理文本塊 1 時發生未知錯誤: 'ChatPromptValue' object has no attribute 'npc_profiles'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2689, in parse_and_create_lore_from_canon
    all_parsing_results.npc_profiles.extend(chunk_result.npc_profiles)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'ChatPromptValue' object has no attribute 'npc_profiles'
2025-09-21 22:28:44 - [INFO] - [512280345618546699] 正在解析文本塊 2/4...
2025-09-21 22:28:49 - [INFO] - [512280345618546699] 正在輕量級重建核心模型 (目標: gemini-2.5-pro) 以應用金鑰策略...
2025-09-21 22:28:49 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-pro' 實例 (API Key index: 4)
2025-09-21 22:28:49 - [INFO] - [512280345618546699] 正在創建 Embedding 模型實例 (API Key index: 5)
2025-09-21 22:28:49 - [INFO] - [512280345618546699] 核心模型已成功重建。
2025-09-21 22:28:49 - [ERROR] - [512280345618546699] 處理文本塊 2 時發生未知錯誤: 'ChatPromptValue' object has no attribute 'npc_profiles'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2689, in parse_and_create_lore_from_canon
    all_parsing_results.npc_profiles.extend(chunk_result.npc_profiles)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'ChatPromptValue' object has no attribute 'npc_profiles'
2025-09-21 22:28:49 - [INFO] - [512280345618546699] 正在解析文本塊 3/4...
2025-09-21 22:28:54 - [INFO] - [512280345618546699] 正在輕量級重建核心模型 (目標: gemini-2.5-pro) 以應用金鑰策略...
2025-09-21 22:28:54 - [INFO] - [512280345618546699] 正在創建模型 'gemini-2.5-pro' 實例 (API Key index: 0)
2025-09-21 22:28:54 - [INFO] - [512280345618546699] 正在創建 Embedding 模型實例 (API Key index: 1)
2025-09-21 22:28:54 - [INFO] - [512280345618546699] 核心模型已成功重建。
2025-09-21 22:28:54 - [ERROR] - [512280345618546699] 處理文本塊 3 時發生未知錯誤: 'ChatPromptValue' object has no attribute 'npc_profiles'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2689, in parse_and_create_lore_from_canon
    all_parsing_results.npc_profiles.extend(chunk_result.npc_profiles)
  File "C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'ChatPromptValue' object has no attribute 'npc_profiles'
2025-09-21 22:28:54 - [INFO] - [512280345618546699] 正在解析文本塊 4/4...
2025-09-21 22:38:43 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-21 22:38:43 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-21 22:38:44 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-21 22:38:44 - [INFO] - Discord Bot is ready!
2025-09-21 22:38:47 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-21 22:38:47 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-21 22:38:47 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-21 22:39:00 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-21 22:39:00 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-21 22:39:00 - [INFO] - [512280345618546699] 核心協議模板 '00_supreme_directive.txt' 已成功加載並設置。
2025-09-21 22:39:00 - [INFO] - [512280345618546699] 正在創建 Embedding 模型實例 (API Key index: 0)
2025-09-21 22:39:00 - [ERROR] - [512280345618546699] 配置前置資源時發生致命錯誤: 'AILover' object has no attribute '_build_retriever'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 428, in initialize
    await self._configure_pre_requisites()
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 867, in _configure_pre_requisites
    self.retriever = await self._build_retriever()
AttributeError: 'AILover' object has no attribute '_build_retriever'. Did you mean: 'bm25_retriever'?
2025-09-21 22:39:00 - [WARNING] - 為使用者 512280345618546699 初始化 AI 實例失敗。
2025-09-21 22:39:08 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-09-21 22:39:10 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-09-21 22:39:15 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-09-21 22:39:16 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-21 22:39:16 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-09-21 22:39:16 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-21 22:39:16 - [INFO] - [512280345618546699] 核心協議模板 '00_supreme_directive.txt' 已成功加載並設置。
2025-09-21 22:39:16 - [INFO] - [512280345618546699] 正在創建 Embedding 模型實例 (API Key index: 0)
2025-09-21 22:39:16 - [ERROR] - [512280345618546699] 為臨時實例配置前置資源時失敗: 'AILover' object has no attribute '_build_retriever'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 902, in get_or_create_ai_instance
    await ai_instance._configure_pre_requisites()
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 867, in _configure_pre_requisites
    self.retriever = await self._build_retriever()
AttributeError: 'AILover' object has no attribute '_build_retriever'. Did you mean: 'bm25_retriever'?
2025-09-21 22:39:16 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-09-21 22:39:16 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-09-21 22:39:16 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-21 22:39:18 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-09-21 22:39:25 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-09-21 22:39:26 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-09-21 22:39:26 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-21 22:39:27 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-09-21 22:39:37 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-09-21 22:39:38 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-09-21 22:39:38 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-09-21 22:39:39 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToCanonSetupView' finalize button clicked.
2025-09-21 22:39:40 - [INFO] - [512280345618546699] (UI Event) finalize_setup 被觸發。Canon provided: False
2025-09-21 22:39:40 - [INFO] - [512280345618546699] [/start 流程 1/4] 正在處理世界聖經...
2025-09-21 22:39:40 - [ERROR] - [512280345618546699] 在手動編排的創世流程中發生嚴重錯誤: 'AILover' object has no attribute 'process_canon_and_extract_lores'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1060, in finalize_setup
    await ai_instance.process_canon_and_extract_lores(canon_text)
AttributeError: 'AILover' object has no attribute 'process_canon_and_extract_lores'
2025-09-21 22:44:10 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-21 22:44:10 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-21 22:44:10 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-21 22:44:10 - [INFO] - Discord Bot is ready!
2025-09-21 22:44:13 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-21 22:44:13 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-21 22:44:14 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-21 22:47:27 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-21 22:47:27 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-21 22:47:27 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-21 22:47:27 - [INFO] - Discord Bot is ready!
2025-09-21 22:47:30 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-21 22:47:30 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-21 22:47:31 - [INFO] - 已成功發送啟動成功通知給管理員。
