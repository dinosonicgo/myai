### AI Lover Log - Last updated at 2025-10-01T23:04:23.504047 ###

2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #3) 執行...
2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #4) 執行...
2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #5) 執行...
2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:22:56 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #0) 執行...
2025-10-01 22:22:57 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:22:57 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #1) 執行...
2025-10-01 22:22:57 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:22:57 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:22:58 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '改革' 時失敗: name 'random' is not defined
2025-10-01 22:22:58 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #3) 執行...
2025-10-01 22:22:59 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '執行者' 時失敗: name 'random' is not defined
2025-10-01 22:22:59 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #4) 執行...
2025-10-01 22:22:59 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '活神蹟' 時失敗: name 'random' is not defined
2025-10-01 22:22:59 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #5) 執行...
2025-10-01 22:22:59 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '神性' 時失敗: name 'random' is not defined
2025-10-01 22:22:59 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #0) 執行...
2025-10-01 22:23:00 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '工具保養' 時失敗: name 'random' is not defined
2025-10-01 22:23:00 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #1) 執行...
2025-10-01 22:23:00 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '同於性' 時失敗: name 'random' is not defined
2025-10-01 22:23:00 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:23:00 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '老年人' 時失敗: name 'random' is not defined
2025-10-01 22:23:00 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #3) 執行...
2025-10-01 22:23:00 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '(Tom' 時失敗: name 'random' is not defined
2025-10-01 22:23:00 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #4) 執行...
2025-10-01 22:23:01 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '聖殿守護者 / 掘井人' 時失敗: name 'random' is not defined
2025-10-01 22:23:01 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #5) 執行...
2025-10-01 22:23:01 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '輪姦治療' 時失敗: name 'random' is not defined
2025-10-01 22:23:01 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #0) 執行...
2025-10-01 22:23:02 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '恢復青春' 時失敗: name 'random' is not defined
2025-10-01 22:23:02 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #1) 執行...
2025-10-01 22:23:02 - [ERROR] - [512280345618546699] [原子化分類] 🔥 分類實體 '墮落' 時失敗: name 'random' is not defined
2025-10-01 22:23:02 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:23:03 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-01 22:32:53 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-01 22:32:53 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-01 22:32:54 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-01 22:32:54 - [INFO] - Discord Bot is ready!
2025-10-01 22:32:57 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-01 22:32:57 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-01 22:32:57 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-01 22:33:09 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-01 22:33:09 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-01 22:33:09 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-01 22:33:09 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-01 22:33:09 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-01 22:33:09 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-01 22:34:17 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-01 22:34:22 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-01 22:34:23 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-01 22:34:23 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-01 22:34:23 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-01 22:34:23 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-01 22:34:23 - [INFO] - [512280345618546699] 正在創建本地 Embedding 模型 'infgrad/stella-base-zh-v2' 實例...
2025-10-01 22:34:26 - [INFO] - [512280345618546699] ✅ 本地 Embedding 模型實例創建成功。
2025-10-01 22:34:26 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-01 22:34:26 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-01 22:34:26 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-01 22:34:27 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:34:28 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-01 22:34:37 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-01 22:34:37 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-01 22:34:37 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:34:39 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-01 22:34:54 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-10-01 22:34:54 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-10-01 22:34:55 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:34:57 - [INFO] - [512280345618546699] [創世流程] 檔案上傳開始，已設定 active_setups 狀態鎖。
2025-10-01 22:35:01 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-01 22:35:04 - [INFO] - [512280345618546699] 獨立的後台創世流程已為用戶啟動。
2025-10-01 22:35:04 - [INFO] - [512280345618546699] [後台創世 1/3] 正在啟動終極 LORE 解析管線...
2025-10-01 22:35:04 - [INFO] - [512280345618546699] [LORE 解析 1/4] 正在使用混合 NLP 在本地快速提取實體骨架...
2025-10-01 22:35:06 - [INFO] - [512280345618546699] [LORE 解析 1/4] ✅ 本地 NLP 成功提取 776 個候選實體。
2025-10-01 22:35:06 - [INFO] - [512280345618546699] [LORE 解析 2/4] 正在對 776 個實體啟動批量並行分類...
2025-10-01 22:35:06 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #0) 執行...
2025-10-01 22:35:06 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #1) 執行...
2025-10-01 22:35:07 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:35:07 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #3) 執行...
2025-10-01 22:35:07 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #4) 執行...
2025-10-01 22:35:11 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:35:11 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #5) 執行...
2025-10-01 22:35:11 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:35:11 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #0) 執行...
2025-10-01 22:35:12 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:35:12 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #1) 執行...
2025-10-01 22:35:12 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:35:12 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:35:15 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:35:15 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #3) 執行...
2025-10-01 22:35:16 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:35:16 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #4) 執行...
2025-10-01 22:35:18 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-01 22:40:46 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-01 22:40:46 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-01 22:40:46 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-01 22:40:46 - [INFO] - Discord Bot is ready!
2025-10-01 22:40:49 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-01 22:40:49 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-01 22:40:50 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-01 22:40:56 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-01 22:40:56 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-01 22:40:56 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-01 22:40:57 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-01 22:40:57 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-01 22:40:57 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-01 22:40:58 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-01 22:41:03 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-01 22:41:03 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-01 22:41:03 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-01 22:41:03 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-01 22:41:03 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-01 22:41:03 - [INFO] - [512280345618546699] 正在創建本地 Embedding 模型 'infgrad/stella-base-zh-v2' 實例...
2025-10-01 22:41:07 - [INFO] - [512280345618546699] ✅ 本地 Embedding 模型實例創建成功。
2025-10-01 22:41:07 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-01 22:41:07 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-01 22:41:07 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-01 22:41:07 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:41:09 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-01 22:41:18 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-01 22:41:18 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-01 22:41:19 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:41:20 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-01 22:41:32 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-10-01 22:41:32 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-10-01 22:41:33 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:41:34 - [INFO] - [512280345618546699] [創世流程] 檔案上傳開始，已設定 active_setups 狀態鎖。
2025-10-01 22:41:43 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-01 22:41:45 - [INFO] - [512280345618546699] 獨立的後台創世流程已為用戶啟動。
2025-10-01 22:41:45 - [INFO] - [512280345618546699] [後台創世 1/3] 正在啟動終極 LORE 解析管線...
2025-10-01 22:41:45 - [INFO] - [512280345618546699] [LORE 解析 1/4] 正在使用混合 NLP 在本地快速提取實體骨架...
2025-10-01 22:41:48 - [INFO] - [512280345618546699] [LORE 解析 1/4] ✅ 本地 NLP 成功提取 776 個候選實體。
2025-10-01 22:41:48 - [INFO] - [512280345618546699] [LORE 解析 2/4] 正在對 776 個實體啟動批量並行分類...
2025-10-01 22:41:48 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #0) 執行...
2025-10-01 22:41:48 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #1) 執行...
2025-10-01 22:41:48 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:41:52 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:41:52 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #3) 執行...
2025-10-01 22:41:53 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:41:53 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #4) 執行...
2025-10-01 22:41:53 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:41:53 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #5) 執行...
2025-10-01 22:42:02 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:02 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #0) 執行...
2025-10-01 22:42:03 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:03 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #1) 執行...
2025-10-01 22:42:04 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:04 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:42:08 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:08 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #3) 執行...
2025-10-01 22:42:10 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:10 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #4) 執行...
2025-10-01 22:42:11 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:11 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #5) 執行...
2025-10-01 22:42:15 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:15 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #0) 執行...
2025-10-01 22:42:16 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:16 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #1) 執行...
2025-10-01 22:42:16 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:16 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #2) 執行...
2025-10-01 22:42:19 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:19 - [INFO] - [512280345618546699] [Tool Calling] 正在使用模型 'gemini-2.5-flash-lite' (Key #3) 執行...
2025-10-01 22:42:20 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:26 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:27 - [INFO] - [512280345618546699] [Tool Calling] ✅ 成功！
2025-10-01 22:42:27 - [ERROR] - [512280345618546699] 後台創世流程發生嚴重錯誤: 'tuple' object has no attribute 'lore_category'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1148, in _perform_full_setup_flow
    success, parsing_result_from_pipeline, _ = await ai_instance._execute_lore_parsing_pipeline(canon_text)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4252, in _execute_lore_parsing_pipeline
    tasks_to_run = [c for c in all_classifications if c.lore_category != 'ignore']
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 4252, in <listcomp>
    tasks_to_run = [c for c in all_classifications if c.lore_category != 'ignore']
AttributeError: 'tuple' object has no attribute 'lore_category'
2025-10-01 22:42:27 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
2025-10-01 22:54:03 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-10-01 22:54:03 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-10-01 22:54:03 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-10-01 22:54:03 - [INFO] - Discord Bot is ready!
2025-10-01 22:54:06 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-10-01 22:54:06 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-10-01 22:54:07 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-10-01 22:55:04 - [INFO] - [512280345618546699] 後台重置任務開始...
2025-10-01 22:55:04 - [INFO] - [512280345618546699] 未檢測到活躍的 AI 實例，直接進行清理。
2025-10-01 22:55:04 - [INFO] - [512280345618546699] 正在清除所有資料庫記錄...
2025-10-01 22:55:06 - [INFO] - [512280345618546699] 所有資料庫記錄已成功清除。
2025-10-01 22:55:06 - [INFO] - [512280345618546699] (Robust Delete) 正在啟動對目錄 data\vector_stores\512280345618546699 的健壯刪除流程...
2025-10-01 22:55:06 - [INFO] - [512280345618546699] (Robust Delete) ✅ 在第 1 次嘗試中成功刪除目錄: data\vector_stores\512280345618546699
2025-10-01 22:55:10 - [INFO] - [512280345618546699] (UI Event) Persistent 'StartSetupView' button clicked.
2025-10-01 22:55:15 - [INFO] - [512280345618546699] (UI Event) WorldSettingsModal submitted. is_setup_flow: True
2025-10-01 22:55:15 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-10-01 22:55:15 - [INFO] - [512280345618546699] 處於設定流程中，即使資料庫無記錄，也創建一個臨時的記憶體實例。
2025-10-01 22:55:15 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-10-01 22:55:15 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-10-01 22:55:15 - [INFO] - [512280345618546699] 正在創建本地 Embedding 模型 'infgrad/stella-base-zh-v2' 實例...
2025-10-01 22:55:19 - [INFO] - [512280345618546699] ✅ 本地 Embedding 模型實例創建成功。
2025-10-01 22:55:19 - [INFO] - [512280345618546699] 所有輕量級前置資源已準備就緒 (RAG 創建已延遲)。
2025-10-01 22:55:19 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['world_settings']
2025-10-01 22:55:19 - [WARNING] - [512280345618546699] 在持久化更新時找不到使用者資料，將創建新記錄。
2025-10-01 22:55:19 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:55:37 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToUserSetupView' button clicked.
2025-10-01 22:55:46 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'user', is_setup_flow: True
2025-10-01 22:55:47 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile']
2025-10-01 22:55:47 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:56:15 - [INFO] - [512280345618546699] (UI Event) Persistent 'ContinueToAiSetupView' button clicked.
2025-10-01 22:56:26 - [INFO] - [512280345618546699] (UI Event) CharacterSettingsModal submitted for profile_type: 'ai', is_setup_flow: True
2025-10-01 22:56:27 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['ai_profile']
2025-10-01 22:56:27 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:56:29 - [INFO] - [512280345618546699] [創世流程] 檔案上傳開始，已設定 active_setups 狀態鎖。
2025-10-01 22:56:35 - [INFO] - [512280345618546699] (on_message) 偵測到用戶處於活躍的創世流程中，已忽略常規訊息 '...' 以防止競爭。
2025-10-01 22:56:38 - [INFO] - [512280345618546699] 獨立的後台創世流程已為用戶啟動。
2025-10-01 22:56:38 - [INFO] - [512280345618546699] [後台創世 1/3] 正在啟動終極 LORE 解析管線...
2025-10-01 22:56:38 - [INFO] - [512280345618546699] [LORE 解析 1/4] 正在使用混合 NLP 在本地快速提取實體骨架...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [LORE 解析 1/4] ✅ 本地 NLP 成功提取 776 個候選實體。
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [LORE 解析 2/4] 正在對 776 個實體啟動批量並行分類...
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [WARNING] - [512280345618546699] [批量分類] 🔥 批次分類時遭遇錯誤: ImportError。啟動審查備援...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [批量分類] 正在使用安全代碼化的上下文重試...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [批量分類] 🔥 審查備援最終失敗: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [LORE 解析 2/4] ✅ 分類完成，確定 0 個有效 LORE 創建任務。
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [LORE 解析 3/4] 正在啟動兩步式靶向精煉器...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [LORE 解析 4/4] 正在進行數據合併...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [LORE 解析] ✅ 終極批量原子工具鏈執行完畢。
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [後台創世 1/3] LORE 解析管線執行完畢。
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [後台創世 2/3] 正在將解析出的 LORE 結果持久化到資料庫...
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [後台創世 2/3] LORE 持久化完成。
2025-10-01 22:56:40 - [INFO] - [512280345618546699] [後台創世 3/3] 正在補完角色檔案、生成世界並創作開場白...
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [/start] 為角色 'DINO' 進行安全補完時發生錯誤: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2465, in _safe_complete_profile
    completed_safe_profile = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1278, in ainvoke_with_rotation
    from google.generativeai.types.generation_types import BlockedPromptException, FinishReason
ImportError: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] [/start] 為角色 '碧' 進行安全補完時發生錯誤: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2465, in _safe_complete_profile
    completed_safe_profile = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1278, in ainvoke_with_rotation
    from google.generativeai.types.generation_types import BlockedPromptException, FinishReason
ImportError: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:40 - [INFO] - [512280345618546699] 接收到 profile 更新請求: ['user_profile', 'ai_profile']
2025-10-01 22:56:40 - [INFO] - [512280345618546699] Profile 更新並持久化成功。
2025-10-01 22:56:40 - [ERROR] - [512280345618546699] 後台創世流程發生嚴重錯誤: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1165, in _perform_full_setup_flow
    await ai_instance.generate_world_genesis(canon_text=canon_text)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2531, in generate_world_genesis
    genesis_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 1278, in ainvoke_with_rotation
    from google.generativeai.types.generation_types import BlockedPromptException, FinishReason
ImportError: cannot import name 'FinishReason' from 'google.generativeai.types.generation_types' (C:\Users\USER\AppData\Local\Programs\Python\Python310\lib\site-packages\google\generativeai\types\generation_types.py)
2025-10-01 22:56:42 - [INFO] - [512280345618546699] 後台創世流程結束，狀態鎖已釋放。
