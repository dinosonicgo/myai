### AI Lover Log - Last updated at 2025-09-23T20:09:15.105533 ###

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2030, in parse_and_create_lore_from_canon
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2063, in parse_and_create_lore_from_canon
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
2025-09-23 19:26:37 - [INFO] - [512280345618546699] [LORE解析階段1/2] 粗提取完成。總共 7 個文本塊，成功處理 6 個。
2025-09-23 19:26:37 - [INFO] - [512280345618546699] 正在啟動背景任務以進行 LORE 細節精煉...
2025-09-23 19:29:49 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:29:49 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:29:50 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:29:50 - [INFO] - Discord Bot is ready!
2025-09-23 19:29:52 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:29:52 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:29:53 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 19:30:07 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 915 條文檔用於構建 BM25。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 19:30:07 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 19:30:07 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 19:30:07 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 19:30:08 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 19:30:08 - [INFO] - [512280345618546699] [LORE解析階段1/2] 開始粗提取，生成LORE骨架...
2025-09-23 19:30:08 - [INFO] - [512280345618546699] 世界聖經已被分割成 7 個文本塊進行處理...
2025-09-23 19:30:08 - [INFO] - [512280345618546699] 正在處理文本塊 1/7...
2025-09-23 19:30:22 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 19 個實體...
2025-09-23 19:30:22 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:30:22 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:30:24 - [INFO] - [512280345618546699] 文本塊 1 的 LORE 已成功儲存。
2025-09-23 19:30:24 - [INFO] - [512280345618546699] 正在處理文本塊 2/7...
2025-09-23 19:30:39 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:30:39 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 6 個實體...
2025-09-23 19:30:39 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'quest' 類別處理 3 個實體...
2025-09-23 19:30:39 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 35 個實體...
2025-09-23 19:30:45 - [INFO] - [512280345618546699] 文本塊 2 的 LORE 已成功儲存。
2025-09-23 19:30:45 - [INFO] - [512280345618546699] 正在處理文本塊 3/7...
2025-09-23 19:30:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 2 個實體...
2025-09-23 19:30:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-23 19:30:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:30:58 - [INFO] - [512280345618546699] 文本塊 3 的 LORE 已成功儲存。
2025-09-23 19:30:58 - [INFO] - [512280345618546699] 正在處理文本塊 4/7...
2025-09-23 19:31:07 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:31:07 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'creature_info' 類別處理 1 個實體...
2025-09-23 19:31:07 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 4 個實體...
2025-09-23 19:31:10 - [INFO] - [512280345618546699] 文本塊 4 的 LORE 已成功儲存。
2025-09-23 19:31:10 - [INFO] - [512280345618546699] 正在處理文本塊 5/7...
2025-09-23 19:31:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 19:31:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:31:21 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 9 個實體...
2025-09-23 19:31:24 - [INFO] - [512280345618546699] 文本塊 5 的 LORE 已成功儲存。
2025-09-23 19:31:24 - [INFO] - [512280345618546699] 正在處理文本塊 6/7...
2025-09-23 19:31:38 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 25 個實體...
2025-09-23 19:31:38 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 7 個實體...
2025-09-23 19:31:38 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 14 個實體...
2025-09-23 19:31:42 - [INFO] - [512280345618546699] 文本塊 6 的 LORE 已成功儲存。
2025-09-23 19:31:42 - [INFO] - [512280345618546699] 正在處理文本塊 7/7...
2025-09-23 19:31:43 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:31:43 - [WARNING] - [512280345618546699] 文本塊 7 遭遇內容審查 (BlockedPromptException)。啟動【上下文保留式代碼替換】策略...
2025-09-23 19:31:43 - [INFO] - [512280345618546699] [上下文保留成功] 已生成無害化文本塊進行重構。
2025-09-23 19:31:45 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-pro' (Key #1) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:31:45 - [ERROR] - [512280345618546699] 【上下文保留式代碼替換】策略最終失敗: BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2030, in parse_and_create_lore_from_canon
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2060, in parse_and_create_lore_from_canon
    parsing_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
2025-09-23 19:31:45 - [INFO] - [512280345618546699] [LORE解析階段1/2] 粗提取完成。總共 7 個文本塊，成功處理 6 個。
2025-09-23 19:31:45 - [INFO] - [512280345618546699] 正在啟動背景任務以進行 LORE 細節精煉...
2025-09-23 19:31:45 - [ERROR] - [512280345618546699] 背景處理世界聖經時發生錯誤: 'AILover' object has no attribute '_background_lore_refinement'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1162, in _background_process_canon
    await ai_instance.parse_and_create_lore_from_canon(content_text)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2114, in parse_and_create_lore_from_canon
    asyncio.create_task(self._background_lore_refinement(canon_text))
AttributeError: 'AILover' object has no attribute '_background_lore_refinement'
2025-09-23 19:35:33 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:35:33 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:35:33 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:35:33 - [INFO] - Discord Bot is ready!
2025-09-23 19:35:36 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:35:36 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:35:37 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 19:35:55 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 19:35:55 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 19:35:55 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 19:35:55 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 943 條文檔用於構建 BM25。
2025-09-23 19:35:55 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 19:35:55 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 19:35:55 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 19:35:55 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 19:35:55 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 19:35:56 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 19:35:56 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 19:35:56 - [INFO] - [512280345618546699] [終極LORE解析流程] 啟動...
2025-09-23 19:35:56 - [INFO] - [512280345618546699] [LORE解析 1/3] 正在使用LLM進行實體骨架提取...
2025-09-23 19:36:13 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:36:13 - [ERROR] - [512280345618546699] 在處理文本塊 7 的實體提取時發生錯誤: Prompt blocked due to PROHIBITED_CONTENT
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2035, in parse_and_create_lore_from_canon
    extraction_result = await self.ainvoke_with_rotation(
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 335, in ainvoke_with_rotation
    raise e
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 307, in ainvoke_with_rotation
    raise BlockedPromptException(f"Prompt blocked due to {response.prompt_feedback.block_reason.name}")
google.generativeai.types.generation_types.BlockedPromptException: Prompt blocked due to PROHIBITED_CONTENT
2025-09-23 19:36:13 - [INFO] - [512280345618546699] [LORE解析 1/3] 實體骨架提取完成，發現 70 個獨立角色。
2025-09-23 19:36:13 - [INFO] - [512280345618546699] [LORE解析 2/3] 正在對 70 個角色進行深度精煉...
2025-09-23 19:36:48 - [INFO] - [512280345618546699] [LORE精煉] 已成功深度解析並精煉 '絲月' 的 LORE。
2025-09-23 19:43:04 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:43:04 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:43:04 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:43:04 - [INFO] - Discord Bot is ready!
2025-09-23 19:43:07 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:43:07 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:43:08 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 19:43:23 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 19:43:23 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 19:43:23 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 19:43:23 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 943 條文檔用於構建 BM25。
2025-09-23 19:43:23 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 19:43:23 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 19:43:23 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 19:43:23 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 19:43:23 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 19:43:24 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 19:43:24 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 19:43:24 - [INFO] - [512280345618546699] [LORE解析階段1/2] 開始粗提取，生成LORE骨架...
2025-09-23 19:43:24 - [INFO] - [512280345618546699] 世界聖經已被分割成 7 個文本塊進行處理...
2025-09-23 19:43:24 - [INFO] - [512280345618546699] 正在處理文本塊 1/7...
2025-09-23 19:43:43 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇解析或驗證錯誤: ValidationError。
2025-09-23 19:43:43 - [WARNING] - [512280345618546699] 文本塊 1 遭遇格式或驗證錯誤 (ValidationError)。啟動【模型升級攻堅】...
2025-09-23 19:44:57 - [INFO] - [512280345618546699] [攻堅成功] 已成功使用升級模型修復格式錯誤。
2025-09-23 19:44:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 19 個實體...
2025-09-23 19:44:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 3 個實體...
2025-09-23 19:44:57 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 10 個實體...
2025-09-23 19:45:02 - [INFO] - [512280345618546699] 文本塊 1 的 LORE 已成功儲存。
2025-09-23 19:45:02 - [INFO] - [512280345618546699] 正在處理文本塊 2/7...
2025-09-23 19:45:27 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 23 個實體...
2025-09-23 19:45:27 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:45:27 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 26 個實體...
2025-09-23 19:45:32 - [INFO] - [512280345618546699] 文本塊 2 的 LORE 已成功儲存。
2025-09-23 19:45:32 - [INFO] - [512280345618546699] 正在處理文本塊 3/7...
2025-09-23 19:45:40 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 2 個實體...
2025-09-23 19:45:40 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-23 19:45:40 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 19:45:40 - [INFO] - [512280345618546699] 文本塊 3 的 LORE 已成功儲存。
2025-09-23 19:45:40 - [INFO] - [512280345618546699] 正在處理文本塊 4/7...
2025-09-23 19:45:53 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 22 個實體...
2025-09-23 19:45:53 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'creature_info' 類別處理 1 個實體...
2025-09-23 19:45:53 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 32 個實體...
2025-09-23 19:45:58 - [INFO] - [512280345618546699] 文本塊 4 的 LORE 已成功儲存。
2025-09-23 19:45:58 - [INFO] - [512280345618546699] 正在處理文本塊 5/7...
2025-09-23 19:46:15 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 19:46:15 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 7 個實體...
2025-09-23 19:46:15 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 12 個實體...
2025-09-23 19:46:18 - [INFO] - [512280345618546699] 文本塊 5 的 LORE 已成功儲存。
2025-09-23 19:46:18 - [INFO] - [512280345618546699] 正在處理文本塊 6/7...
2025-09-23 19:46:29 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 21 個實體...
2025-09-23 19:46:29 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 4 個實體...
2025-09-23 19:46:29 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 5 個實體...
2025-09-23 19:46:32 - [INFO] - [512280345618546699] 文本塊 6 的 LORE 已成功儲存。
2025-09-23 19:46:32 - [INFO] - [512280345618546699] 正在處理文本塊 7/7...
2025-09-23 19:46:33 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #1) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 19:46:33 - [WARNING] - [512280345618546699] 文本塊 7 遭遇內容審查 (BlockedPromptException)。啟動【終極解構-重構】策略...
2025-09-23 19:46:33 - [INFO] - [512280345618546699] [解構成功] 已提取情報關鍵詞: ['布魯諾 (Bruno)', '艾莉諾 (Eleanor)', '諾拉', '漢德瑞克師傅', '瓦萊麗 (Valerie)', '索菲亞 (Sophia)', '瓦勒留斯', '巴納比 (Barnaby)', '菲利普 (Philip)', '索菲亞', '瓦萊麗', '菲利普', '布里奇特 (Bridget)', '奧斯華', '艾諾拉 (Eleanor)', '馬庫斯', '卡蓮 (Karen)', '米婭', '艾莉諾', '奧斯華 (Oswald)', '安布羅斯', 'ACTION-E', '瓦勒留斯 (Valerius)', '馬庫斯 (Marcus)', '布魯諾', '布里奇特', '漢德瑞克師傅 (Master Hendrick)', 'ACTION-B', '卡蓮', 'STATE-A', '夏卡爾', 'ROLE-D', 'CODE-M-GEN-A', '薩格納', 'CODE-F-GEN-A', '安布羅斯 (Ambrose)', '巴納比', '艾諾拉']
2025-09-23 19:47:42 - [INFO] - [512280345618546699] [重構成功] 已成功根據關鍵詞還原出 LORE。
2025-09-23 19:47:42 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 17 個實體...
2025-09-23 19:47:42 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 1 個實體...
2025-09-23 19:47:42 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'item_info' 類別處理 1 個實體...
2025-09-23 19:47:42 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 1 個實體...
2025-09-23 19:47:46 - [INFO] - [512280345618546699] 文本塊 7 的 LORE 已成功儲存。
2025-09-23 19:47:46 - [INFO] - [512280345618546699] [LORE解析階段1/2] 粗提取完成。總共 7 個文本塊，成功處理 7 個。
2025-09-23 19:47:46 - [INFO] - [512280345618546699] 正在啟動背景任務以進行 LORE 細節精煉...
2025-09-23 19:47:46 - [ERROR] - [512280345618546699] 背景處理世界聖經時發生錯誤: 'AILover' object has no attribute '_background_lore_refinement'
Traceback (most recent call last):
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\discord_bot.py", line 1162, in _background_process_canon
    await ai_instance.parse_and_create_lore_from_canon(content_text)
  File "D:\DINO\SD\ComfyUI\personal_server\ai_lover_service\src\ai_core.py", line 2114, in parse_and_create_lore_from_canon
    asyncio.create_task(self._background_lore_refinement(canon_text))
AttributeError: 'AILover' object has no attribute '_background_lore_refinement'
2025-09-23 19:53:44 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:53:44 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:53:44 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:53:44 - [INFO] - Discord Bot is ready!
2025-09-23 19:53:47 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:53:47 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:53:47 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 19:59:15 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 19:59:15 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 19:59:15 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 19:59:15 - [INFO] - Discord Bot is ready!
2025-09-23 19:59:18 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 19:59:18 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 19:59:18 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 20:03:28 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 20:03:28 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 20:03:29 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 20:03:29 - [INFO] - Discord Bot is ready!
2025-09-23 20:03:31 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 20:03:31 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 20:03:32 - [INFO] - 已成功發送啟動成功通知給管理員。
2025-09-23 20:03:55 - [INFO] - 使用者 512280345618546699 沒有活躍的 AI 實例，嘗試創建...
2025-09-23 20:03:55 - [INFO] - [512280345618546699] 核心數據模板 'world_snapshot_template.txt' 已成功加載。
2025-09-23 20:03:55 - [INFO] - [512280345618546699] 核心協議 '00_supreme_directive.txt' 已成功加載。
2025-09-23 20:03:55 - [INFO] - [512280345618546699] (Retriever Builder) 已從 SQL 和 LORE 加載 995 條文檔用於構建 BM25。
2025-09-23 20:03:55 - [INFO] - [512280345618546699] (Retriever Builder) 純 BM25 檢索器構建成功。
2025-09-23 20:03:55 - [INFO] - [512280345618546699] 所有構建鏈的前置資源已準備就緒。
2025-09-23 20:03:55 - [INFO] - 為使用者 512280345618546699 成功創建並初始化 AI 實例。
2025-09-23 20:03:55 - [INFO] - [512280345618546699] 正在從資料庫恢復短期場景記憶...
2025-09-23 20:03:55 - [INFO] - [512280345618546699] 成功恢復了 1 個場景的對話歷史，總計 1 條訊息。
2025-09-23 20:03:56 - [INFO] - [512280345618546699] (Canon Processor) 已从 SQL 记忆库中清理了 33 条旧 'canon' 记录。
2025-09-23 20:03:56 - [INFO] - [512280345618546699] (Canon Processor) 所有 33 个世界圣经文本块均已成功处理并存入 SQL 记忆库。
2025-09-23 20:03:57 - [INFO] - [512280345618546699] [LORE解析階段1/2] 開始粗提取，生成LORE骨架...
2025-09-23 20:03:57 - [INFO] - [512280345618546699] 世界聖經已被分割成 7 個文本塊進行處理...
2025-09-23 20:03:57 - [INFO] - [512280345618546699] 正在處理文本塊 1/7...
2025-09-23 20:04:11 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 19 個實體...
2025-09-23 20:04:11 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 7 個實體...
2025-09-23 20:04:11 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 20:04:14 - [INFO] - [512280345618546699] 文本塊 1 的 LORE 已成功儲存。
2025-09-23 20:04:14 - [INFO] - [512280345618546699] 正在處理文本塊 2/7...
2025-09-23 20:04:29 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 23 個實體...
2025-09-23 20:04:29 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 6 個實體...
2025-09-23 20:04:29 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 10 個實體...
2025-09-23 20:04:33 - [INFO] - [512280345618546699] 文本塊 2 的 LORE 已成功儲存。
2025-09-23 20:04:33 - [INFO] - [512280345618546699] 正在處理文本塊 3/7...
2025-09-23 20:04:40 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 2 個實體...
2025-09-23 20:04:40 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 2 個實體...
2025-09-23 20:04:40 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 6 個實體...
2025-09-23 20:04:40 - [INFO] - [512280345618546699] 文本塊 3 的 LORE 已成功儲存。
2025-09-23 20:04:40 - [INFO] - [512280345618546699] 正在處理文本塊 4/7...
2025-09-23 20:04:41 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #3) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 20:04:41 - [WARNING] - [512280345618546699] 文本塊 4 遭遇內容審查 (BlockedPromptException)。啟動【終極解構-重構】策略...
2025-09-23 20:04:41 - [INFO] - [512280345618546699] [解構成功] 已提取情報關鍵詞: ['菲利普', '艾蜜莉', 'FLUID-A', '卡萊兒', 'Philip', '僕役長', 'ACTION-C', 'ACTION-E', '薩格納將軍', '澤拉', '里奧', '凱薩‧維利爾斯', 'ROLE-D', '賈斯伯', 'CODE-F-GEN-A', '絲月', '艾莉諾', '公豬', 'STATE-A', '安東尼', 'Sagna', '菲利普•薩格納', '薩格納', '愛莉莎', '瑪莉', '貝拉', '米婭', '維利爾斯勳爵', '夏卡爾', '莉莉絲', '瑪莎', 'Mia', '蘇菲', 'ROLE-B', '勳爵', '莉娜', '提姆', '諾拉', '班恩', '安娜', 'CODE-F-GEN-C']
2025-09-23 20:05:19 - [WARNING] - [512280345618546699] Key #4 遭遇臨時性 API 錯誤 (InternalServerError)。將在 1.34 秒後進行第 2 次嘗試...
2025-09-23 20:06:10 - [INFO] - [512280345618546699] [重構成功] 已成功根據關鍵詞還原出 LORE。
2025-09-23 20:06:10 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 9 個實體...
2025-09-23 20:06:10 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 1 個實體...
2025-09-23 20:06:10 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 2 個實體...
2025-09-23 20:06:13 - [INFO] - [512280345618546699] 文本塊 4 的 LORE 已成功儲存。
2025-09-23 20:06:13 - [INFO] - [512280345618546699] 正在處理文本塊 5/7...
2025-09-23 20:06:27 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 20:06:27 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'location_info' 類別處理 7 個實體...
2025-09-23 20:06:27 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 17 個實體...
2025-09-23 20:06:30 - [INFO] - [512280345618546699] 文本塊 5 的 LORE 已成功儲存。
2025-09-23 20:06:30 - [INFO] - [512280345618546699] 正在處理文本塊 6/7...
2025-09-23 20:06:31 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #0) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 20:06:31 - [WARNING] - [512280345618546699] 文本塊 6 遭遇內容審查 (BlockedPromptException)。啟動【終極解構-重構】策略...
2025-09-23 20:06:31 - [INFO] - [512280345618546699] [解構成功] 已提取情報關鍵詞: ['瓦勒留斯神父', '芬恩', '卡蓮 (Karen)', '露比', 'Sophia', '費奇', 'ACTION-E', '老漢姆', '索菲亞', '老羅', 'Karen', 'ROLE-D', '老高', '卡蓮', '愛蓮娜', '凱爾', '米婭', '艾拉', '湯姆', '瑪倫', '泰莎', '湯瑪斯', '馬克', '連恩', 'Mia', '莉莉絲', '勳爵', '葛瑞塔', '里斯', '瓦勒留斯', '提姆', '索菲亞 (Sophia)', '蓋博', '夏卡爾', '舊神夏卡爾']
2025-09-23 20:07:37 - [INFO] - [512280345618546699] [重構成功] 已成功根據關鍵詞還原出 LORE。
2025-09-23 20:07:37 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 25 個實體...
2025-09-23 20:07:37 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 1 個實體...
2025-09-23 20:07:41 - [INFO] - [512280345618546699] 文本塊 6 的 LORE 已成功儲存。
2025-09-23 20:07:41 - [INFO] - [512280345618546699] 正在處理文本塊 7/7...
2025-09-23 20:07:41 - [WARNING] - [512280345618546699] 模型 'gemini-2.5-flash-lite' (Key #2) 遭遇內容審查錯誤: BlockedPromptException。
2025-09-23 20:07:41 - [WARNING] - [512280345618546699] 文本塊 7 遭遇內容審查 (BlockedPromptException)。啟動【終極解構-重構】策略...
2025-09-23 20:07:41 - [INFO] - [512280345618546699] [解構成功] 已提取情報關鍵詞: ['馬庫斯 (Marcus)', '艾諾拉 (Eleanor)', '布魯諾 (Bruno)', '巴納比 (Barnaby)', '菲利普', '布里奇特 (Bridget)', '瓦勒留斯 (Valerius)', '馬庫斯', 'Master Hendrick', '卡蓮 (Karen)', 'Sophia', 'Philip', '艾莉諾 (Eleanor)', 'ACTION-E', 'Oswald', 'Bridget', '索菲亞', '瓦萊麗 (Valerie)', 'Karen', 'ROLE-D', 'CODE-F-GEN-A', '艾莉諾', 'Valerie', '安布羅斯', 'STATE-A', 'Ambrose', 'Sagna', '卡蓮', 'Valerius', '奧斯華', '薩格納', '巴納比', '漢德瑞克師傅', '漢德瑞克師傅 (Master Hendrick)', 'ACTION-B', '布魯諾', 'Bruno', '米婭', '安布羅斯 (Ambrose)', 'Eleanor', 'CODE-M-GEN-A', 'Barnaby', 'Marcus', '奧斯華 (Oswald)', '瓦萊麗', '瓦勒留斯', '索菲亞 (Sophia)', '諾拉', '艾諾拉', '布里奇特', '夏卡爾', '菲利普 (Philip)']
2025-09-23 20:08:36 - [INFO] - [512280345618546699] [重構成功] 已成功根據關鍵詞還原出 LORE。
2025-09-23 20:08:36 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'npc_profile' 類別處理 16 個實體...
2025-09-23 20:08:36 - [INFO] - [512280345618546699] (_resolve_and_save) 正在為 'world_lore' 類別處理 3 個實體...
2025-09-23 20:08:39 - [INFO] - [512280345618546699] 文本塊 7 的 LORE 已成功儲存。
2025-09-23 20:08:39 - [INFO] - [512280345618546699] [LORE解析階段1/2] 粗提取完成。總共 7 個文本塊，成功處理 7 個。
2025-09-23 20:08:39 - [INFO] - [512280345618546699] 正在啟動背景任務以進行 LORE 細節精煉...
2025-09-23 20:09:00 - [INFO] - 所有持久化 UI 視圖已成功註冊。
2025-09-23 20:09:00 - [INFO] - 正在嘗試將應用程式指令 (Slash Commands) 全域同步到 Discord...
2025-09-23 20:09:01 - [INFO] - ✅ 應用程式指令全域同步成功！(注意：全域指令更新可能需要長達一小時才能在所有伺服器生效)
2025-09-23 20:09:01 - [INFO] - Discord Bot is ready!
2025-09-23 20:09:03 - [INFO] - 【健康檢查 & Keep-Alive】背景任務已啟動。
2025-09-23 20:09:03 - [INFO] - Logged in as AI#4450 (ID: 1358417100250808531)
2025-09-23 20:09:04 - [INFO] - 已成功發送啟動成功通知給管理員。
